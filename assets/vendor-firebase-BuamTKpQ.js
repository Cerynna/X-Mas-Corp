import{o as Qc}from"./vendor-CwrXu60c.js";const mf=()=>{};var _l={};const Zc={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const b=function(n,e){if(!n)throw Tn(e)},Tn=function(n){return new Error("Firebase Database ("+Zc.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const eh=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},yf=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],c=n[t++],u=((s&7)<<18|(o&63)<<12|(a&63)<<6|c&63)-65536;e[i++]=String.fromCharCode(55296+(u>>10)),e[i++]=String.fromCharCode(56320+(u&1023))}else{const o=n[t++],a=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},ho={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,c=a?n[s+1]:0,u=s+2<n.length,d=u?n[s+2]:0,m=o>>2,_=(o&3)<<4|c>>4;let v=(c&15)<<2|d>>6,A=d&63;u||(A=64,a||(v=64)),i.push(t[m],t[_],t[v],t[A])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(eh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):yf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const _=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||c==null||d==null||_==null)throw new vf;const v=o<<2|c>>4;if(i.push(v),d!==64){const A=c<<4&240|d>>2;if(i.push(A),_!==64){const R=d<<6&192|_;i.push(R)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class vf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const th=function(n){const e=eh(n);return ho.encodeByteArray(e,!0)},is=function(n){return th(n).replace(/\./g,"")},ss=function(n){try{return ho.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function wf(n){return nh(void 0,n)}function nh(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!If(t)||(n[t]=nh(n[t],e[t]));return n}function If(n){return n!=="__proto__"}function Ef(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Tf=()=>Ef().__FIREBASE_DEFAULTS__,Cf=()=>{if(typeof process>"u"||typeof _l>"u")return;const n=_l.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Sf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ss(n[1]);return e&&JSON.parse(e)},uo=()=>{try{return mf()||Tf()||Cf()||Sf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ih=n=>uo()?.emulatorHosts?.[n],fo=n=>{const e=ih(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},sh=()=>uo()?.config,rh=n=>uo()?.[`_${n}`];class mi{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}function kt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ps(n){return(await fetch(n,{credentials:"include"})).ok}function po(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[is(JSON.stringify(t)),is(JSON.stringify(a)),""].join(".")}const Yn={};function Af(){const n={prod:[],emulator:[]};for(const e of Object.keys(Yn))Yn[e]?n.emulator.push(e):n.prod.push(e);return n}function bf(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ml=!1;function Os(n,e){if(typeof window>"u"||typeof document>"u"||!kt(window.location.host)||Yn[n]===e||Yn[n]||ml)return;Yn[n]=e;function t(v){return`__firebase__banner__${v}`}const i="__firebase__banner",o=Af().prod.length>0;function a(){const v=document.getElementById(i);v&&v.remove()}function c(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function u(v,A){v.setAttribute("width","24"),v.setAttribute("id",A),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{ml=!0,a()},v}function m(v,A){v.setAttribute("id",A),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function _(){const v=bf(i),A=t("text"),R=document.getElementById(A)||document.createElement("span"),N=t("learnmore"),P=document.getElementById(N)||document.createElement("a"),z=t("preprendIcon"),ee=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const Y=v.element;c(Y),m(P,N);const X=d();u(ee,z),Y.append(ee,R,P,X),document.body.appendChild(Y)}o?(R.innerText="Preview backend disconnected.",ee.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ee.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function we(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function go(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(we())}function Rf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function oh(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ah(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function kf(){const n=we();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Nf(){return Zc.NODE_ADMIN===!0}function lh(){try{return typeof indexedDB=="object"}catch{return!1}}function ch(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}function Pf(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}const Of="FirebaseError";class Pe extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=Of,Object.setPrototypeOf(this,Pe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qt.prototype.create)}}class Qt{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Df(o,i):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Pe(s,c,i)}}function Df(n,e){return n.replace(Mf,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const Mf=/\{\$([^}]+)}/g;function ri(n){return JSON.parse(n)}function re(n){return JSON.stringify(n)}const hh=function(n){let e={},t={},i={},s="";try{const o=n.split(".");e=ri(ss(o[0])||""),t=ri(ss(o[1])||""),s=o[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}},Lf=function(n){const e=hh(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},xf=function(n){const e=hh(n).claims;return typeof e=="object"&&e.admin===!0};function ze(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function _n(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function jr(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function rs(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function et(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const o=n[s],a=e[s];if(yl(o)&&yl(a)){if(!et(o,a))return!1}else if(o!==a)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function yl(n){return n!==null&&typeof n=="object"}function Cn(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}class Ff{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let _=0;_<16;_++)i[_]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let _=0;_<16;_++)i[_]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let _=16;_<80;_++){const v=i[_-3]^i[_-8]^i[_-14]^i[_-16];i[_]=(v<<1|v>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],u=this.chain_[4],d,m;for(let _=0;_<80;_++){_<40?_<20?(d=c^o&(a^c),m=1518500249):(d=o^a^c,m=1859775393):_<60?(d=o&a|c&(o|a),m=2400959708):(d=o^a^c,m=3395469782);const v=(s<<5|s>>>27)+d+u+m+i[_]&4294967295;u=c,c=a,a=(o<<30|o>>>2)&4294967295,o=s,s=v}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let s=0;const o=this.buf_;let a=this.inbuf_;for(;s<t;){if(a===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(o[a]=e.charCodeAt(s),++a,++s,a===this.blockSize){this.compress_(o),a=0;break}}else for(;s<t;)if(o[a]=e[s],++a,++s,a===this.blockSize){this.compress_(o),a=0;break}}this.inbuf_=a,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let o=24;o>=0;o-=8)e[i]=this.chain_[s]>>o&255,++i;return e}}function Uf(n,e){const t=new Vf(n,e);return t.subscribe.bind(t)}class Vf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let s;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");Bf(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:i},s.next===void 0&&(s.next=Cr),s.error===void 0&&(s.error=Cr),s.complete===void 0&&(s.complete=Cr);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Bf(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Cr(){}function Ds(n,e){return`${n} failed: ${e} argument `}const jf=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const o=s-55296;i++,b(i<n.length,"Surrogate pair missing trail surrogate.");const a=n.charCodeAt(i)-56320;s=65536+(o<<10)+a}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Ms=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};const Wf=1e3,Hf=2,$f=14400*1e3,qf=.5;function vl(n,e=Wf,t=Hf){const i=e*Math.pow(t,n),s=Math.round(qf*i*(Math.random()-.5)*2);return Math.min($f,i+s)}function ne(n){return n&&n._delegate?n._delegate:n}class Ae{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const xt="[DEFAULT]";class Gf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new mi;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Kf(e))try{this.getOrInitializeService({instanceIdentifier:xt})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});i.resolve(o)}catch{}}}}clearInstance(e=xt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=xt){return this.instances.has(e)}getOptions(e=xt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[o,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(o);i===c&&a.resolve(s)}return s}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(i)??new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:zf(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=xt){return this.component?this.component.multipleInstances?e:xt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function zf(n){return n===xt?void 0:n}function Kf(n){return n.instantiationMode==="EAGER"}class Yf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Gf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var W;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(W||(W={}));const Jf={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},Xf=W.INFO,Qf={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},Zf=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=Qf[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class yi{constructor(e){this.name=e,this._logLevel=Xf,this._logHandler=Zf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Jf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}}class ep{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(tp(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function tp(n){return n.getComponent()?.type==="VERSION"}const Wr="@firebase/app",wl="0.14.6";const tt=new yi("@firebase/app"),np="@firebase/app-compat",ip="@firebase/analytics-compat",sp="@firebase/analytics",rp="@firebase/app-check-compat",op="@firebase/app-check",ap="@firebase/auth",lp="@firebase/auth-compat",cp="@firebase/database",hp="@firebase/data-connect",up="@firebase/database-compat",dp="@firebase/functions",fp="@firebase/functions-compat",pp="@firebase/installations",gp="@firebase/installations-compat",_p="@firebase/messaging",mp="@firebase/messaging-compat",yp="@firebase/performance",vp="@firebase/performance-compat",wp="@firebase/remote-config",Ip="@firebase/remote-config-compat",Ep="@firebase/storage",Tp="@firebase/storage-compat",Cp="@firebase/firestore",Sp="@firebase/ai",Ap="@firebase/firestore-compat",bp="firebase",Rp="12.6.0";const Hr="[DEFAULT]",kp={[Wr]:"fire-core",[np]:"fire-core-compat",[sp]:"fire-analytics",[ip]:"fire-analytics-compat",[op]:"fire-app-check",[rp]:"fire-app-check-compat",[ap]:"fire-auth",[lp]:"fire-auth-compat",[cp]:"fire-rtdb",[hp]:"fire-data-connect",[up]:"fire-rtdb-compat",[dp]:"fire-fn",[fp]:"fire-fn-compat",[pp]:"fire-iid",[gp]:"fire-iid-compat",[_p]:"fire-fcm",[mp]:"fire-fcm-compat",[yp]:"fire-perf",[vp]:"fire-perf-compat",[wp]:"fire-rc",[Ip]:"fire-rc-compat",[Ep]:"fire-gcs",[Tp]:"fire-gcs-compat",[Cp]:"fire-fst",[Ap]:"fire-fst-compat",[Sp]:"fire-vertex","fire-js":"fire-js",[bp]:"fire-js-all"};const os=new Map,Np=new Map,$r=new Map;function Il(n,e){try{n.container.addComponent(e)}catch(t){tt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ke(n){const e=n.name;if($r.has(e))return tt.debug(`There were multiple attempts to register component ${e}.`),!1;$r.set(e,n);for(const t of os.values())Il(t,n);for(const t of Np.values())Il(t,n);return!0}function rt(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ce(n){return n==null?!1:n.settings!==void 0}const Pp={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vt=new Qt("app","Firebase",Pp);class Op{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Ae("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vt.create("app-deleted",{appName:this._name})}}const Nt=Rp;function Dp(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:Hr,automaticDataCollectionEnabled:!0,...e},s=i.name;if(typeof s!="string"||!s)throw vt.create("bad-app-name",{appName:String(s)});if(t||(t=sh()),!t)throw vt.create("no-options");const o=os.get(s);if(o){if(et(t,o.options)&&et(i,o.config))return o;throw vt.create("duplicate-app",{appName:s})}const a=new Yf(s);for(const u of $r.values())a.addComponent(u);const c=new Op(t,i,a);return os.set(s,c),c}function vi(n=Hr){const e=os.get(n);if(!e&&n===Hr&&sh())return Dp();if(!e)throw vt.create("no-app",{appName:n});return e}function fe(n,e,t){let i=kp[n]??n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tt.warn(a.join(" "));return}ke(new Ae(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const Mp="firebase-heartbeat-database",Lp=1,oi="firebase-heartbeat-store";let Sr=null;function uh(){return Sr||(Sr=Qc(Mp,Lp,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(oi)}catch(t){console.warn(t)}}}}).catch(n=>{throw vt.create("idb-open",{originalErrorMessage:n.message})})),Sr}async function xp(n){try{const t=(await uh()).transaction(oi),i=await t.objectStore(oi).get(dh(n));return await t.done,i}catch(e){if(e instanceof Pe)tt.warn(e.message);else{const t=vt.create("idb-get",{originalErrorMessage:e?.message});tt.warn(t.message)}}}async function El(n,e){try{const i=(await uh()).transaction(oi,"readwrite");await i.objectStore(oi).put(e,dh(n)),await i.done}catch(t){if(t instanceof Pe)tt.warn(t.message);else{const i=vt.create("idb-set",{originalErrorMessage:t?.message});tt.warn(i.message)}}}function dh(n){return`${n.name}!${n.options.appId}`}const Fp=1024,Up=30;class Vp{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new jp(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Tl();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:t}),this._heartbeatsCache.heartbeats.length>Up){const s=Wp(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){tt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Tl(),{heartbeatsToSend:t,unsentEntries:i}=Bp(this._heartbeatsCache.heartbeats),s=is(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return tt.warn(e),""}}}function Tl(){return new Date().toISOString().substring(0,10)}function Bp(n,e=Fp){const t=[];let i=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Cl(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Cl(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class jp{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lh()?ch().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await xp(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return El(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return El(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Cl(n){return is(JSON.stringify({version:2,heartbeats:n})).length}function Wp(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}function Hp(n){ke(new Ae("platform-logger",e=>new ep(e),"PRIVATE")),ke(new Ae("heartbeat",e=>new Vp(e),"PRIVATE")),fe(Wr,wl,n),fe(Wr,wl,"esm2020"),fe("fire-js","")}Hp("");var $p="firebase",qp="12.6.0";fe($p,qp,"app");function fh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Gp=fh,ph=new Qt("auth","Firebase",fh());const as=new yi("@firebase/auth");function zp(n,...e){as.logLevel<=W.WARN&&as.warn(`Auth (${Nt}): ${n}`,...e)}function Xi(n,...e){as.logLevel<=W.ERROR&&as.error(`Auth (${Nt}): ${n}`,...e)}function nt(n,...e){throw _o(n,...e)}function $e(n,...e){return _o(n,...e)}function gh(n,e,t){const i={...Gp(),[e]:t};return new Qt("auth","Firebase",i).create(e,{appName:n.name})}function wt(n){return gh(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function _o(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return ph.create(n,...e)}function D(n,e,...t){if(!n)throw _o(e,...t)}function Je(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xi(e),new Error(e)}function it(n,e){n||Je(e)}function qr(){return typeof self<"u"&&self.location?.href||""}function Kp(){return Sl()==="http:"||Sl()==="https:"}function Sl(){return typeof self<"u"&&self.location?.protocol||null}function Yp(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Kp()||oh()||"connection"in navigator)?navigator.onLine:!0}function Jp(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class wi{constructor(e,t){this.shortDelay=e,this.longDelay=t,it(t>e,"Short delay should be less than long delay!"),this.isMobile=go()||ah()}get(){return Yp()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function mo(n,e){it(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class _h{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Je("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Je("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Je("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Xp={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Qp=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Zp=new wi(3e4,6e4);function Ls(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Zt(n,e,t,i,s={}){return mh(n,s,async()=>{let o={},a={};i&&(e==="GET"?a=i:o={body:JSON.stringify(i)});const c=Cn({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:u,...o};return Rf()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&kt(n.emulatorConfig.host)&&(d.credentials="include"),_h.fetch()(await vh(n,n.config.apiHost,t,c),d)})}async function mh(n,e,t){n._canInitEmulator=!1;const i={...Xp,...e};try{const s=new eg(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw qi(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const c=o.ok?a.errorMessage:a.error.message,[u,d]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw qi(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw qi(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw qi(n,"user-disabled",a);const m=i[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw gh(n,m,d);nt(n,m)}}catch(s){if(s instanceof Pe)throw s;nt(n,"network-request-failed",{message:String(s)})}}async function yh(n,e,t,i,s={}){const o=await Zt(n,e,t,i,s);return"mfaPendingCredential"in o&&nt(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function vh(n,e,t,i){const s=`${e}${t}?${i}`,o=n,a=o.config.emulator?mo(n.config,s):`${n.config.apiScheme}://${s}`;return Qp.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}class eg{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i($e(this.auth,"network-request-failed")),Zp.get())})}}function qi(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=$e(n,e,i);return s.customData._tokenResponse=t,s}async function tg(n,e){return Zt(n,"POST","/v1/accounts:delete",e)}async function ls(n,e){return Zt(n,"POST","/v1/accounts:lookup",e)}function Jn(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ng(n,e=!1){const t=ne(n),i=await t.getIdToken(e),s=yo(i);D(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:i,authTime:Jn(Ar(s.auth_time)),issuedAtTime:Jn(Ar(s.iat)),expirationTime:Jn(Ar(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Ar(n){return Number(n)*1e3}function yo(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Xi("JWT malformed, contained fewer than 3 sections"),null;try{const s=ss(t);return s?JSON.parse(s):(Xi("Failed to decode base64 JWT payload"),null)}catch(s){return Xi("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Al(n){const e=yo(n);return D(e,"internal-error"),D(typeof e.exp<"u","internal-error"),D(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function mn(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Pe&&ig(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function ig({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class sg{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Gr{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jn(this.lastLoginAt),this.creationTime=Jn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function cs(n){const e=n.auth,t=await n.getIdToken(),i=await mn(n,ls(e,{idToken:t}));D(i?.users.length,e,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?wh(s.providerUserInfo):[],a=og(n.providerData,o),c=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=c?u:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Gr(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,m)}async function rg(n){const e=ne(n);await cs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function og(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function wh(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function ag(n,e){const t=await mh(n,{},async()=>{const i=Cn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await vh(n,s,"/v1/token",`key=${o}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:c,body:i};return n.emulatorConfig&&kt(n.emulatorConfig.host)&&(u.credentials="include"),_h.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function lg(n,e){return Zt(n,"POST","/v2/accounts:revokeToken",Ls(n,e))}class hn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){D(e.idToken,"internal-error"),D(typeof e.idToken<"u","internal-error"),D(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Al(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){D(e.length!==0,"internal-error");const t=Al(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(D(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:o}=await ag(e,t);this.updateTokensAndExpiration(i,s,Number(o))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:o}=t,a=new hn;return i&&(D(typeof i=="string","internal-error",{appName:e}),a.refreshToken=i),s&&(D(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(D(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new hn,this.toJSON())}_performRefresh(){return Je("not implemented")}}function ft(n,e){D(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Me{constructor({uid:e,auth:t,stsTokenManager:i,...s}){this.providerId="firebase",this.proactiveRefresh=new sg(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Gr(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await mn(this,this.stsTokenManager.getToken(this.auth,e));return D(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ng(this,e)}reload(){return rg(this)}_assign(e){this!==e&&(D(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Me({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){D(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await cs(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ce(this.auth.app))return Promise.reject(wt(this.auth));const e=await this.getIdToken();return await mn(this,tg(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,c=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,m=t.lastLoginAt??void 0,{uid:_,emailVerified:v,isAnonymous:A,providerData:R,stsTokenManager:N}=t;D(_&&N,e,"internal-error");const P=hn.fromJSON(this.name,N);D(typeof _=="string",e,"internal-error"),ft(i,e.name),ft(s,e.name),D(typeof v=="boolean",e,"internal-error"),D(typeof A=="boolean",e,"internal-error"),ft(o,e.name),ft(a,e.name),ft(c,e.name),ft(u,e.name),ft(d,e.name),ft(m,e.name);const z=new Me({uid:_,auth:e,email:s,emailVerified:v,displayName:i,isAnonymous:A,photoURL:a,phoneNumber:o,tenantId:c,stsTokenManager:P,createdAt:d,lastLoginAt:m});return R&&Array.isArray(R)&&(z.providerData=R.map(ee=>({...ee}))),u&&(z._redirectEventId=u),z}static async _fromIdTokenResponse(e,t,i=!1){const s=new hn;s.updateFromServerResponse(t);const o=new Me({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await cs(o),o}static async _fromGetAccountInfoResponse(e,t,i){const s=t.users[0];D(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?wh(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,c=new hn;c.updateFromIdToken(i);const u=new Me({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Gr(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(u,d),u}}const bl=new Map;function Xe(n){it(n instanceof Function,"Expected a class definition");let e=bl.get(n);return e?(it(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,bl.set(n,e),e)}class Ih{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ih.type="NONE";const Rl=Ih;function Qi(n,e,t){return`firebase:${n}:${e}:${t}`}class un{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:o}=this.auth;this.fullUserKey=Qi(this.userKey,s.apiKey,o),this.fullPersistenceKey=Qi("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ls(this.auth,{idToken:e}).catch(()=>{});return t?Me._fromGetAccountInfoResponse(this.auth,t,e):null}return Me._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new un(Xe(Rl),e,i);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||Xe(Rl);const a=Qi(i,e.config.apiKey,e.name);let c=null;for(const d of t)try{const m=await d._get(a);if(m){let _;if(typeof m=="string"){const v=await ls(e,{idToken:m}).catch(()=>{});if(!v)break;_=await Me._fromGetAccountInfoResponse(e,v,m)}else _=Me._fromJSON(e,m);d!==o&&(c=_),o=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!u.length?new un(o,e,i):(o=u[0],c&&await o._set(a,c.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new un(o,e,i))}}function kl(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Sh(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Eh(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(bh(e))return"Blackberry";if(Rh(e))return"Webos";if(Th(e))return"Safari";if((e.includes("chrome/")||Ch(e))&&!e.includes("edge/"))return"Chrome";if(Ah(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function Eh(n=we()){return/firefox\//i.test(n)}function Th(n=we()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ch(n=we()){return/crios\//i.test(n)}function Sh(n=we()){return/iemobile/i.test(n)}function Ah(n=we()){return/android/i.test(n)}function bh(n=we()){return/blackberry/i.test(n)}function Rh(n=we()){return/webos/i.test(n)}function vo(n=we()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function cg(n=we()){return vo(n)&&!!window.navigator?.standalone}function hg(){return kf()&&document.documentMode===10}function kh(n=we()){return vo(n)||Ah(n)||Rh(n)||bh(n)||/windows phone/i.test(n)||Sh(n)}function Nh(n,e=[]){let t;switch(n){case"Browser":t=kl(we());break;case"Worker":t=`${kl(we())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Nt}/${i}`}class ug{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=o=>new Promise((a,c)=>{try{const u=e(o);a(u)}catch(u){c(u)}});i.onAbort=t,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}async function dg(n,e={}){return Zt(n,"GET","/v2/passwordPolicy",Ls(n,e))}const fg=6;class pg{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??fg,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let s=0;s<e.length;s++)i=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class gg{constructor(e,t,i,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Nl(this),this.idTokenSubscription=new Nl(this),this.beforeStateQueue=new ug(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ph,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Xe(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await un.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ls(this,{idToken:e}),i=await Me._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ce(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=i?._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return D(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await cs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Jp()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ce(this.app))return Promise.reject(wt(this));const t=e?ne(e):null;return t&&D(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&D(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ce(this.app)?Promise.reject(wt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ce(this.app)?Promise.reject(wt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Xe(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await dg(this),t=new pg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Qt("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await lg(this,i)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Xe(e)||this._popupRedirectResolver;D(t,this,"argument-error"),this.redirectPersistenceManager=await un.create(this,[Xe(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(D(c,this,"internal-error"),c.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,i,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return D(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Nh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){if(Ce(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&zp(`Error while retrieving App Check token: ${e.error}`),e?.token}}function xs(n){return ne(n)}class Nl{constructor(e){this.auth=e,this.observer=null,this.addObserver=Uf(t=>this.observer=t)}get next(){return D(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let wo={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _g(n){wo=n}function mg(n){return wo.loadJS(n)}function yg(){return wo.gapiScript}function vg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function wg(n,e){const t=rt(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(et(o,e??{}))return s;nt(s,"already-initialized")}return t.initialize({options:e})}function Ig(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(Xe);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function Eg(n,e,t){const i=xs(n);D(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!1,o=Ph(e),{host:a,port:c}=Tg(e),u=c===null?"":`:${c}`,d={url:`${o}//${a}${u}/`},m=Object.freeze({host:a,port:c,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!i._canInitEmulator){D(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),D(et(d,i.config.emulator)&&et(m,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=d,i.emulatorConfig=m,i.settings.appVerificationDisabledForTesting=!0,kt(a)?(Ps(`${o}//${a}${u}`),Os("Auth",!0)):Cg()}function Ph(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Tg(n){const e=Ph(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const o=s[1];return{host:o,port:Pl(i.substr(o.length+1))}}else{const[o,a]=i.split(":");return{host:o,port:Pl(a)}}}function Pl(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Cg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Oh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Je("not implemented")}_getIdTokenResponse(e){return Je("not implemented")}_linkToIdToken(e,t){return Je("not implemented")}_getReauthenticationResolver(e){return Je("not implemented")}}async function dn(n,e){return yh(n,"POST","/v1/accounts:signInWithIdp",Ls(n,e))}const Sg="http://localhost";class qt extends Oh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new qt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):nt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s,...o}=t;if(!i||!s)return null;const a=new qt(i,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return dn(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,dn(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,dn(e,t)}buildRequest(){const e={requestUri:Sg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Cn(t)}return e}}class Dh{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ii extends Dh{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class pt extends Ii{constructor(){super("facebook.com")}static credential(e){return qt._fromParams({providerId:pt.PROVIDER_ID,signInMethod:pt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pt.credentialFromTaggedObject(e)}static credentialFromError(e){return pt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pt.credential(e.oauthAccessToken)}catch{return null}}}pt.FACEBOOK_SIGN_IN_METHOD="facebook.com";pt.PROVIDER_ID="facebook.com";class gt extends Ii{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return qt._fromParams({providerId:gt.PROVIDER_ID,signInMethod:gt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return gt.credentialFromTaggedObject(e)}static credentialFromError(e){return gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return gt.credential(t,i)}catch{return null}}}gt.GOOGLE_SIGN_IN_METHOD="google.com";gt.PROVIDER_ID="google.com";class _t extends Ii{constructor(){super("github.com")}static credential(e){return qt._fromParams({providerId:_t.PROVIDER_ID,signInMethod:_t.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _t.credentialFromTaggedObject(e)}static credentialFromError(e){return _t.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _t.credential(e.oauthAccessToken)}catch{return null}}}_t.GITHUB_SIGN_IN_METHOD="github.com";_t.PROVIDER_ID="github.com";class mt extends Ii{constructor(){super("twitter.com")}static credential(e,t){return qt._fromParams({providerId:mt.PROVIDER_ID,signInMethod:mt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return mt.credentialFromTaggedObject(e)}static credentialFromError(e){return mt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return mt.credential(t,i)}catch{return null}}}mt.TWITTER_SIGN_IN_METHOD="twitter.com";mt.PROVIDER_ID="twitter.com";async function Ag(n,e){return yh(n,"POST","/v1/accounts:signUp",Ls(n,e))}class Tt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const o=await Me._fromIdTokenResponse(e,i,s),a=Ol(i);return new Tt({user:o,providerId:a,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=Ol(i);return new Tt({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function Ol(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}async function DE(n){if(Ce(n.app))return Promise.reject(wt(n));const e=xs(n);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new Tt({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await Ag(e,{returnSecureToken:!0}),i=await Tt._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(i.user),i}class hs extends Pe{constructor(e,t,i,s){super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,hs.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new hs(e,t,i,s)}}function Mh(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?hs._fromErrorAndOperation(n,o,e,i):o})}async function bg(n,e,t=!1){const i=await mn(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Tt._forOperation(n,"link",i)}async function Rg(n,e,t=!1){const{auth:i}=n;if(Ce(i.app))return Promise.reject(wt(i));const s="reauthenticate";try{const o=await mn(n,Mh(i,s,e,n),t);D(o.idToken,i,"internal-error");const a=yo(o.idToken);D(a,i,"internal-error");const{sub:c}=a;return D(n.uid===c,i,"user-mismatch"),Tt._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&nt(i,"user-mismatch"),o}}async function kg(n,e,t=!1){if(Ce(n.app))return Promise.reject(wt(n));const i="signIn",s=await Mh(n,i,e),o=await Tt._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(o.user),o}async function Ng(n,e){return Zt(n,"POST","/v1/accounts:update",e)}async function ME(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const i=ne(n),o={idToken:await i.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await mn(i,Ng(i.auth,o));i.displayName=a.displayName||null,i.photoURL=a.photoUrl||null;const c=i.providerData.find(({providerId:u})=>u==="password");c&&(c.displayName=i.displayName,c.photoURL=i.photoURL),await i._updateTokensIfNecessary(a)}function Pg(n,e,t,i){return ne(n).onIdTokenChanged(e,t,i)}function Og(n,e,t){return ne(n).beforeAuthStateChanged(e,t)}function LE(n,e,t,i){return ne(n).onAuthStateChanged(e,t,i)}const us="__sak";class Lh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(us,"1"),this.storage.removeItem(us),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Dg=1e3,Mg=10;class xh extends Lh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=kh(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}const i=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(i);!t&&this.localCache[i]===a||this.notifyListeners(i,a)},o=this.storage.getItem(i);hg()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Mg):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},Dg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}xh.type="LOCAL";const Lg=xh;class Fh extends Lh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Fh.type="SESSION";const Uh=Fh;function xg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Fs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new Fs(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const c=Array.from(a).map(async d=>d(t.origin,o)),u=await xg(c);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Fs.receivers=[];function Io(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}class Fg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((c,u)=>{const d=Io("",20);s.port1.start();const m=setTimeout(()=>{u(new Error("unsupported_event"))},i);a={messageChannel:s,onMessage(_){const v=_;if(v.data.eventId===d)switch(v.data.status){case"ack":clearTimeout(m),o=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),c(v.data.response);break;default:clearTimeout(m),clearTimeout(o),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function qe(){return window}function Ug(n){qe().location.href=n}function Vh(){return typeof qe().WorkerGlobalScope<"u"&&typeof qe().importScripts=="function"}async function Vg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Bg(){return navigator?.serviceWorker?.controller||null}function jg(){return Vh()?self:null}const Bh="firebaseLocalStorageDb",Wg=1,ds="firebaseLocalStorage",jh="fbase_key";class Ei{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Us(n,e){return n.transaction([ds],e?"readwrite":"readonly").objectStore(ds)}function Hg(){const n=indexedDB.deleteDatabase(Bh);return new Ei(n).toPromise()}function zr(){const n=indexedDB.open(Bh,Wg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(ds,{keyPath:jh})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(ds)?e(i):(i.close(),await Hg(),e(await zr()))})})}async function Dl(n,e,t){const i=Us(n,!0).put({[jh]:e,value:t});return new Ei(i).toPromise()}async function $g(n,e){const t=Us(n,!1).get(e),i=await new Ei(t).toPromise();return i===void 0?null:i.value}function Ml(n,e){const t=Us(n,!0).delete(e);return new Ei(t).toPromise()}const qg=800,Gg=3;class Wh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await zr(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>Gg)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Vh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Fs._getInstance(jg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Vg(),!this.activeServiceWorker)return;this.sender=new Fg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Bg()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await zr();return await Dl(e,us,"1"),await Ml(e,us),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>Dl(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>$g(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Ml(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=Us(s,!1).getAll();return new Ei(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),qg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Wh.type="LOCAL";const zg=Wh;new wi(3e4,6e4);function Kg(n,e){return e?Xe(e):(D(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Eo extends Oh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return dn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return dn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return dn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Yg(n){return kg(n.auth,new Eo(n),n.bypassAuthState)}function Jg(n){const{auth:e,user:t}=n;return D(t,e,"internal-error"),Rg(t,new Eo(n),n.bypassAuthState)}async function Xg(n){const{auth:e,user:t}=n;return D(t,e,"internal-error"),bg(t,new Eo(n),n.bypassAuthState)}class Hh{constructor(e,t,i,s,o=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:o,error:a,type:c}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:i,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Yg;case"linkViaPopup":case"linkViaRedirect":return Xg;case"reauthViaPopup":case"reauthViaRedirect":return Jg;default:nt(this.auth,"internal-error")}}resolve(e){it(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){it(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Qg=new wi(2e3,1e4);class ln extends Hh{constructor(e,t,i,s,o){super(e,t,s,o),this.provider=i,this.authWindow=null,this.pollId=null,ln.currentPopupAction&&ln.currentPopupAction.cancel(),ln.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return D(e,this.auth,"internal-error"),e}async onExecution(){it(this.filter.length===1,"Popup operations only handle one event");const e=Io();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject($e(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject($e(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ln.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject($e(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Qg.get())};e()}}ln.currentPopupAction=null;const Zg="pendingRedirect",Zi=new Map;class e_ extends Hh{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Zi.get(this.auth._key());if(!e){try{const i=await t_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Zi.set(this.auth._key(),e)}return this.bypassAuthState||Zi.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function t_(n,e){const t=s_(e),i=i_(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}function n_(n,e){Zi.set(n._key(),e)}function i_(n){return Xe(n._redirectPersistence)}function s_(n){return Qi(Zg,n.config.apiKey,n.name)}async function r_(n,e,t=!1){if(Ce(n.app))return Promise.reject(wt(n));const i=xs(n),s=Kg(i,e),a=await new e_(i,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,e)),a}const o_=600*1e3;class a_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!l_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!$h(e)){const i=e.error.code?.split("auth/")[1]||"internal-error";t.onError($e(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=o_&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ll(e))}saveEventToCache(e){this.cachedEventUids.add(Ll(e)),this.lastProcessedEventTime=Date.now()}}function Ll(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $h({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function l_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $h(n);default:return!1}}async function c_(n,e={}){return Zt(n,"GET","/v1/projects",e)}const h_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,u_=/^https?/;async function d_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await c_(n);for(const t of e)try{if(f_(t))return}catch{}nt(n,"unauthorized-domain")}function f_(n){const e=qr(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===i}if(!u_.test(t))return!1;if(h_.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const p_=new wi(3e4,6e4);function xl(){const n=qe().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function g_(n){return new Promise((e,t)=>{function i(){xl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xl(),t($e(n,"network-request-failed"))},timeout:p_.get()})}if(qe().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(qe().gapi?.load)i();else{const s=vg("iframefcb");return qe()[s]=()=>{gapi.load?i():t($e(n,"network-request-failed"))},mg(`${yg()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw es=null,e})}let es=null;function __(n){return es=es||g_(n),es}const m_=new wi(5e3,15e3),y_="__/auth/iframe",v_="emulator/auth/iframe",w_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},I_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function E_(n){const e=n.config;D(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?mo(e,v_):`https://${n.config.authDomain}/${y_}`,i={apiKey:e.apiKey,appName:n.name,v:Nt},s=I_.get(n.config.apiHost);s&&(i.eid=s);const o=n._getFrameworks();return o.length&&(i.fw=o.join(",")),`${t}?${Cn(i).slice(1)}`}async function T_(n){const e=await __(n),t=qe().gapi;return D(t,n,"internal-error"),e.open({where:document.body,url:E_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:w_,dontclear:!0},i=>new Promise(async(s,o)=>{await i.restyle({setHideOnLeave:!1});const a=$e(n,"network-request-failed"),c=qe().setTimeout(()=>{o(a)},m_.get());function u(){qe().clearTimeout(c),s(i)}i.ping(u).then(u,()=>{o(a)})}))}const C_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},S_=500,A_=600,b_="_blank",R_="http://localhost";class Fl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function k_(n,e,t,i=S_,s=A_){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const u={...C_,width:i.toString(),height:s.toString(),top:o,left:a},d=we().toLowerCase();t&&(c=Ch(d)?b_:t),Eh(d)&&(e=e||R_,u.scrollbars="yes");const m=Object.entries(u).reduce((v,[A,R])=>`${v}${A}=${R},`,"");if(cg(d)&&c!=="_self")return N_(e||"",c),new Fl(null);const _=window.open(e||"",c,m);D(_,n,"popup-blocked");try{_.focus()}catch{}return new Fl(_)}function N_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}const P_="__/auth/handler",O_="emulator/auth/handler",D_=encodeURIComponent("fac");async function Ul(n,e,t,i,s,o){D(n.config.authDomain,n,"auth-domain-config-required"),D(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Nt,eventId:s};if(e instanceof Dh){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",jr(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,_]of Object.entries({}))a[m]=_}if(e instanceof Ii){const m=e.getScopes().filter(_=>_!=="");m.length>0&&(a.scopes=m.join(","))}n.tenantId&&(a.tid=n.tenantId);const c=a;for(const m of Object.keys(c))c[m]===void 0&&delete c[m];const u=await n._getAppCheckToken(),d=u?`#${D_}=${encodeURIComponent(u)}`:"";return`${M_(n)}?${Cn(c).slice(1)}${d}`}function M_({config:n}){return n.emulator?mo(n,O_):`https://${n.authDomain}/${P_}`}const br="webStorageSupport";class L_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Uh,this._completeRedirectFn=r_,this._overrideRedirectResult=n_}async _openPopup(e,t,i,s){it(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Ul(e,t,i,qr(),s);return k_(e,o,Io())}async _openRedirect(e,t,i,s){await this._originValidation(e);const o=await Ul(e,t,i,qr(),s);return Ug(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(it(o,"If manager is not set, promise should be"),o)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await T_(e),i=new a_(e);return t.register("authEvent",s=>(D(s?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(br,{type:br},s=>{const o=s?.[0]?.[br];o!==void 0&&t(!!o),nt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=d_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return kh()||Th()||vo()}}const x_=L_;var Vl="@firebase/auth",Bl="1.11.1";class F_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){D(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function U_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function V_(n){ke(new Ae("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=i.options;D(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const u={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Nh(n)},d=new gg(i,s,o,u);return Ig(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),ke(new Ae("auth-internal",e=>{const t=xs(e.getProvider("auth").getImmediate());return(i=>new F_(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),fe(Vl,Bl,U_(n)),fe(Vl,Bl,"esm2020")}const B_=300,j_=rh("authIdTokenMaxAge")||B_;let jl=null;const W_=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>j_)return;const s=t?.token;jl!==s&&(jl=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function xE(n=vi()){const e=rt(n,"auth");if(e.isInitialized())return e.getImmediate();const t=wg(n,{popupRedirectResolver:x_,persistence:[zg,Lg,Uh]}),i=rh("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(i,location.origin);if(location.origin===o.origin){const a=W_(o.toString());Og(t,a,()=>a(t.currentUser)),Pg(t,c=>a(c))}}const s=ih("auth");return s&&Eg(t,`http://${s}`),t}function H_(){return document.getElementsByTagName("head")?.[0]??document}_g({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const o=$e("internal-error");o.customData=s,t(o)},i.type="text/javascript",i.charset="UTF-8",H_().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});V_("Browser");var Wl={};const Hl="@firebase/database",$l="1.1.0";let qh="";function $_(n){qh=n}class q_{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),re(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ri(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class G_{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ze(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Gh=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new q_(e)}}catch{}return new G_},Vt=Gh("localStorage"),z_=Gh("sessionStorage");const fn=new yi("@firebase/database"),K_=(function(){let n=1;return function(){return n++}})(),zh=function(n){const e=jf(n),t=new Ff;t.update(e);const i=t.digest();return ho.encodeByteArray(i)},Ti=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Ti.apply(null,i):typeof i=="object"?e+=re(i):e+=i,e+=" "}return e};let Xn=null,ql=!0;const Y_=function(n,e){b(!0,"Can't turn on custom loggers persistently."),fn.logLevel=W.VERBOSE,Xn=fn.log.bind(fn)},ce=function(...n){if(ql===!0&&(ql=!1,Xn===null&&z_.get("logging_enabled")===!0&&Y_()),Xn){const e=Ti.apply(null,n);Xn(e)}},Ci=function(n){return function(...e){ce(n,...e)}},Kr=function(...n){const e="FIREBASE INTERNAL ERROR: "+Ti(...n);fn.error(e)},st=function(...n){const e=`FIREBASE FATAL ERROR: ${Ti(...n)}`;throw fn.error(e),new Error(e)},ye=function(...n){const e="FIREBASE WARNING: "+Ti(...n);fn.warn(e)},J_=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ye("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},To=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},X_=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Gt="[MIN_NAME]",Ct="[MAX_NAME]",en=function(n,e){if(n===e)return 0;if(n===Gt||e===Ct)return-1;if(e===Gt||n===Ct)return 1;{const t=Gl(n),i=Gl(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Q_=function(n,e){return n===e?0:n<e?-1:1},qn=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+re(e))},Co=function(n){if(typeof n!="object"||n===null)return re(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=re(e[i]),t+=":",t+=Co(n[e[i]]);return t+="}",t},Kh=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function he(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Yh=function(n){b(!To(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,o,a,c,u;n===0?(o=0,a=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(c=Math.min(Math.floor(Math.log(n)/Math.LN2),i),o=c+i,a=Math.round(n*Math.pow(2,t-c)-Math.pow(2,t))):(o=0,a=Math.round(n/Math.pow(2,1-i-t))));const d=[];for(u=t;u;u-=1)d.push(a%2?1:0),a=Math.floor(a/2);for(u=e;u;u-=1)d.push(o%2?1:0),o=Math.floor(o/2);d.push(s?1:0),d.reverse();const m=d.join("");let _="";for(u=0;u<64;u+=8){let v=parseInt(m.substr(u,8),2).toString(16);v.length===1&&(v="0"+v),_=_+v}return _.toLowerCase()},Z_=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},em=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function tm(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const nm=new RegExp("^-?(0*)\\d{1,10}$"),im=-2147483648,sm=2147483647,Gl=function(n){if(nm.test(n)){const e=Number(n);if(e>=im&&e<=sm)return e}return null},Sn=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw ye("Exception was thrown by user callback.",t),e},Math.floor(0))}},rm=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Qn=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class om{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Ce(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){ye(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class am{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(ce("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ye(e)}}class ts{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ts.OWNER="owner";const So="5",Jh="v",Xh="s",Qh="r",Zh="f",eu=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,tu="ls",nu="p",Yr="ac",iu="websocket",su="long_polling";class ru{constructor(e,t,i,s,o=!1,a="",c=!1,u=!1,d=null){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=o,this.persistenceKey=a,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=u,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Vt.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Vt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function lm(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ou(n,e,t){b(typeof e=="string","typeof type must == string"),b(typeof t=="object","typeof params must == object");let i;if(e===iu)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===su)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);lm(n)&&(t.ns=n.namespace);const s=[];return he(t,(o,a)=>{s.push(o+"="+a)}),i+s.join("&")}class cm{constructor(){this.counters_={}}incrementCounter(e,t=1){ze(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return wf(this.counters_)}}const Rr={},kr={};function Ao(n){const e=n.toString();return Rr[e]||(Rr[e]=new cm),Rr[e]}function hm(n,e){const t=n.toString();return kr[t]||(kr[t]=e()),kr[t]}class um{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Sn(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const zl="start",dm="close",fm="pLPCommand",pm="pRTLPCB",au="id",lu="pw",cu="ser",gm="cb",_m="seg",mm="ts",ym="d",vm="dframe",hu=1870,uu=30,wm=hu-uu,Im=25e3,Em=3e4;class cn{constructor(e,t,i,s,o,a,c){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.transportSessionId=a,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ci(e),this.stats_=Ao(t),this.urlFn=u=>(this.appCheckToken&&(u[Yr]=this.appCheckToken),ou(t,su,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new um(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Em)),X_(()=>{if(this.isClosed_)return;this.scriptTagHolder=new bo((...o)=>{const[a,c,u,d,m]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===zl)this.id=c,this.password=u;else if(a===dm)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...o)=>{const[a,c]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(a,c)},()=>{this.onClosed_()},this.urlFn);const i={};i[zl]="t",i[cu]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[gm]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Jh]=So,this.transportSessionId&&(i[Xh]=this.transportSessionId),this.lastSessionId&&(i[tu]=this.lastSessionId),this.applicationId&&(i[nu]=this.applicationId),this.appCheckToken&&(i[Yr]=this.appCheckToken),typeof location<"u"&&location.hostname&&eu.test(location.hostname)&&(i[Qh]=Zh);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){cn.forceAllow_=!0}static forceDisallow(){cn.forceDisallow_=!0}static isAvailable(){return cn.forceAllow_?!0:!cn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Z_()&&!em()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=re(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=th(t),s=Kh(i,wm);for(let o=0;o<s.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[o]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[vm]="t",i[au]=e,i[lu]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=re(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class bo{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=K_(),window[fm+this.uniqueCallbackIdentifier]=e,window[pm+this.uniqueCallbackIdentifier]=t,this.myIFrame=bo.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(c){ce("frame writing exception"),c.stack&&ce(c.stack),ce(c)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ce("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[au]=this.myID,e[lu]=this.myPW,e[cu]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+uu+i.length<=hu;){const a=this.pendingSegs.shift();i=i+"&"+_m+s+"="+a.seg+"&"+mm+s+"="+a.ts+"&"+ym+s+"="+a.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(Im)),o=()=>{clearTimeout(s),i()};this.addTag(e,o)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{ce("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const Tm=16384,Cm=45e3;let fs=null;typeof MozWebSocket<"u"?fs=MozWebSocket:typeof WebSocket<"u"&&(fs=WebSocket);class De{constructor(e,t,i,s,o,a,c){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ci(this.connId),this.stats_=Ao(t),this.connURL=De.connectionURL_(t,a,c,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,o){const a={};return a[Jh]=So,typeof location<"u"&&location.hostname&&eu.test(location.hostname)&&(a[Qh]=Zh),t&&(a[Xh]=t),i&&(a[tu]=i),s&&(a[Yr]=s),o&&(a[nu]=o),ou(e,iu,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Vt.set("previous_websocket_failure",!0);try{let i;Nf(),this.mySock=new fs(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){De.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&fs!==null&&!De.forceDisallow_}static previouslyFailed(){return Vt.isInMemoryStorage||Vt.get("previous_websocket_failure")===!0}markConnectionHealthy(){Vt.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=ri(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(b(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=re(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Kh(t,Tm);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Cm))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}De.responsesRequiredToBeHealthy=2;De.healthyTimeout=3e4;class ai{static get ALL_TRANSPORTS(){return[cn,De]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=De&&De.isAvailable();let i=t&&!De.previouslyFailed();if(e.webSocketOnly&&(t||ye("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[De];else{const s=this.transports_=[];for(const o of ai.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);ai.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ai.globalTransportInitialized_=!1;const Sm=6e4,Am=5e3,bm=10*1024,Rm=100*1024,Nr="t",Kl="d",km="s",Yl="r",Nm="e",Jl="o",Xl="a",Ql="n",Zl="p",Pm="h";class Om{constructor(e,t,i,s,o,a,c,u,d,m){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=o,this.onMessage_=a,this.onReady_=c,this.onDisconnect_=u,this.onKill_=d,this.lastSessionId=m,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ci("c:"+this.id+":"),this.transportManager_=new ai(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Qn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Rm?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>bm?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Nr in e){const t=e[Nr];t===Xl?this.upgradeIfSecondaryHealthy_():t===Yl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Jl&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=qn("t",e),i=qn("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Zl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Xl,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Ql,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=qn("t",e),i=qn("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=qn(Nr,e);if(Kl in e){const i=e[Kl];if(t===Pm){const s={...i};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Ql){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===km?this.onConnectionShutdown_(i):t===Yl?this.onReset_(i):t===Nm?Kr("Server Error: "+i):t===Jl?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Kr("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),So!==i&&ye("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),Qn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Sm))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Qn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Am))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Zl,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Vt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class du{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class fu{constructor(e){this.allowedEvents_=e,this.listeners_={},b(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let o=0;o<s.length;o++)if(s[o].callback===t&&(!i||i===s[o].context)){s.splice(o,1);return}}validateEventType_(e){b(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ps extends fu{static getInstance(){return new ps}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!go()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return b(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const ec=32,tc=768;class H{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function j(){return new H("")}function L(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function St(n){return n.pieces_.length-n.pieceNum_}function G(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new H(n.pieces_,e)}function Ro(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Dm(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function li(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function pu(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new H(e,0)}function Q(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof H)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new H(t,0)}function x(n){return n.pieceNum_>=n.pieces_.length}function me(n,e){const t=L(n),i=L(e);if(t===null)return e;if(t===i)return me(G(n),G(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Mm(n,e){const t=li(n,0),i=li(e,0);for(let s=0;s<t.length&&s<i.length;s++){const o=en(t[s],i[s]);if(o!==0)return o}return t.length===i.length?0:t.length<i.length?-1:1}function ko(n,e){if(St(n)!==St(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Re(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(St(n)>St(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class Lm{constructor(e,t){this.errorPrefix_=t,this.parts_=li(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ms(this.parts_[i]);gu(this)}}function xm(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ms(e),gu(n)}function Fm(n){const e=n.parts_.pop();n.byteLength_-=Ms(e),n.parts_.length>0&&(n.byteLength_-=1)}function gu(n){if(n.byteLength_>tc)throw new Error(n.errorPrefix_+"has a key path longer than "+tc+" bytes ("+n.byteLength_+").");if(n.parts_.length>ec)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ec+") or object contains a cycle "+Ft(n))}function Ft(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class No extends fu{static getInstance(){return new No}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return b(e==="visible","Unknown event type: "+e),[this.visible_]}}const Gn=1e3,Um=300*1e3,nc=30*1e3,Vm=1.3,Bm=3e4,jm="server_kill",ic=3;class Ze extends du{constructor(e,t,i,s,o,a,c,u){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=Ze.nextPersistentConnectionId_++,this.log_=Ci("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Gn,this.maxReconnectDelay_=Um,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");No.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ps.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,o={r:s,a:e,b:t};this.log_(re(o)),b(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new mi,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const c=a.d;a.s==="ok"?t.resolve(c):t.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),t.promise}listen(e,t,i,s){this.initConnection_();const o=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),b(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),b(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const c={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const o={p:i},a="q";e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest(a,o,c=>{const u=c.d,d=c.s;Ze.warnOnListenWarnings_(u,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(d,u))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&ze(e,"w")){const i=_n(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();ye(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||xf(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=nc)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Lf(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const o=s.s,a=s.d||"error";this.authToken_===e&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),b(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const o={p:e},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const o={p:t,d:i};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,o){this.initConnection_();const a={p:t,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:e,request:a,onComplete:s}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,o=>{this.log_(t+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+re(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Kr("Unrecognized action received from server: "+re(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){b(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Gn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Gn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Bm&&(this.reconnectDelay_=Gn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Vm)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Ze.nextConnectionId_++,o=this.lastSessionId;let a=!1,c=null;const u=function(){c?c.close():(a=!0,i())},d=function(_){b(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(_)};this.realtime_={close:u,sendRequest:d};const m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[_,v]=await Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);a?ce("getToken() completed but was canceled"):(ce("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=v&&v.token,c=new Om(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,A=>{ye(A+" ("+this.repoInfo_.toString()+")"),this.interrupt(jm)},o))}catch(_){this.log_("Failed to get token: "+_),a||(this.repoInfo_.nodeAdmin&&ye(_),u())}}}interrupt(e){ce("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ce("Resuming connection for reason: "+e),delete this.interruptReasons_[e],jr(this.interruptReasons_)&&(this.reconnectDelay_=Gn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(o=>Co(o)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new H(e).toString();let s;if(this.listens.has(i)){const o=this.listens.get(i);s=o.get(t),o.delete(t),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){ce("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ic&&(this.reconnectDelay_=nc,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){ce("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ic&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+qh.replace(/\./g,"-")]=1,go()?e["framework.cordova"]=1:ah()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ps.getInstance().currentlyOnline();return jr(this.interruptReasons_)&&e}}Ze.nextPersistentConnectionId_=0;Ze.nextConnectionId_=0;class F{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new F(e,t)}}class Vs{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new F(Gt,e),s=new F(Gt,t);return this.compare(i,s)!==0}minPost(){return F.MIN}}let Gi;class _u extends Vs{static get __EMPTY_NODE(){return Gi}static set __EMPTY_NODE(e){Gi=e}compare(e,t){return en(e.name,t.name)}isDefinedOn(e){throw Tn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return F.MIN}maxPost(){return new F(Ct,Gi)}makePost(e,t){return b(typeof e=="string","KeyIndex indexValue must always be a string."),new F(e,Gi)}toString(){return".key"}}const Wt=new _u;class zi{constructor(e,t,i,s,o=null){this.isReverse_=s,this.resultGenerator_=o,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?i(e.key,t):1,s&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class le{constructor(e,t,i,s,o){this.key=e,this.value=t,this.color=i??le.RED,this.left=s??Ee.EMPTY_NODE,this.right=o??Ee.EMPTY_NODE}copy(e,t,i,s,o){return new le(e??this.key,t??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const o=i(e,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):o===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ee.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return Ee.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,le.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,le.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}le.RED=!0;le.BLACK=!1;class Wm{copy(e,t,i,s,o){return this}insert(e,t,i){return new le(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ee{constructor(e,t=Ee.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ee(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,le.BLACK,null,null))}remove(e){return new Ee(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,le.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new zi(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new zi(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new zi(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new zi(this.root_,null,this.comparator_,!0,e)}}Ee.EMPTY_NODE=new Wm;function Hm(n,e){return en(n.name,e.name)}function Po(n,e){return en(n,e)}let Jr;function $m(n){Jr=n}const mu=function(n){return typeof n=="number"?"number:"+Yh(n):"string:"+n},yu=function(n){if(n.isLeafNode()){const e=n.val();b(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ze(e,".sv"),"Priority must be a string or number.")}else b(n===Jr||n.isEmpty(),"priority of unexpected type.");b(n===Jr||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let sc;class ae{static set __childrenNodeConstructor(e){sc=e}static get __childrenNodeConstructor(){return sc}constructor(e,t=ae.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,b(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),yu(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ae(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ae.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return x(e)?this:L(e)===".priority"?this.priorityNode_:ae.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:ae.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=L(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(b(i!==".priority"||St(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,ae.__childrenNodeConstructor.EMPTY_NODE.updateChild(G(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+mu(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Yh(this.value_):e+=this.value_,this.lazyHash_=zh(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ae.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ae.__childrenNodeConstructor?-1:(b(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=ae.VALUE_TYPE_ORDER.indexOf(t),o=ae.VALUE_TYPE_ORDER.indexOf(i);return b(s>=0,"Unknown leaf type: "+t),b(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}ae.VALUE_TYPE_ORDER=["object","boolean","number","string"];let vu,wu;function qm(n){vu=n}function Gm(n){wu=n}class zm extends Vs{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),o=i.compareTo(s);return o===0?en(e.name,t.name):o}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return F.MIN}maxPost(){return new F(Ct,new ae("[PRIORITY-POST]",wu))}makePost(e,t){const i=vu(e);return new F(t,new ae("[PRIORITY-POST]",i))}toString(){return".priority"}}const J=new zm;const Km=Math.log(2);class Ym{constructor(e){const t=o=>parseInt(Math.log(o)/Km,10),i=o=>parseInt(Array(o+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const gs=function(n,e,t,i){n.sort(e);const s=function(u,d){const m=d-u;let _,v;if(m===0)return null;if(m===1)return _=n[u],v=t?t(_):_,new le(v,_.node,le.BLACK,null,null);{const A=parseInt(m/2,10)+u,R=s(u,A),N=s(A+1,d);return _=n[A],v=t?t(_):_,new le(v,_.node,le.BLACK,R,N)}},o=function(u){let d=null,m=null,_=n.length;const v=function(R,N){const P=_-R,z=_;_-=R;const ee=s(P+1,z),Y=n[P],X=t?t(Y):Y;A(new le(X,Y.node,N,null,ee))},A=function(R){d?(d.left=R,d=R):(m=R,d=R)};for(let R=0;R<u.count;++R){const N=u.nextBitIsOne(),P=Math.pow(2,u.count-(R+1));N?v(P,le.BLACK):(v(P,le.BLACK),v(P,le.RED))}return m},a=new Ym(n.length),c=o(a);return new Ee(i||e,c)};let Pr;const an={};class Qe{static get Default(){return b(an&&J,"ChildrenNode.ts has not been loaded"),Pr=Pr||new Qe({".priority":an},{".priority":J}),Pr}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=_n(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ee?t:null}hasIndex(e){return ze(this.indexSet_,e.toString())}addIndex(e,t){b(e!==Wt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const o=t.getIterator(F.Wrap);let a=o.getNext();for(;a;)s=s||e.isDefinedOn(a.node),i.push(a),a=o.getNext();let c;s?c=gs(i,e.getCompare()):c=an;const u=e.toString(),d={...this.indexSet_};d[u]=e;const m={...this.indexes_};return m[u]=c,new Qe(m,d)}addToIndexes(e,t){const i=rs(this.indexes_,(s,o)=>{const a=_n(this.indexSet_,o);if(b(a,"Missing index implementation for "+o),s===an)if(a.isDefinedOn(e.node)){const c=[],u=t.getIterator(F.Wrap);let d=u.getNext();for(;d;)d.name!==e.name&&c.push(d),d=u.getNext();return c.push(e),gs(c,a.getCompare())}else return an;else{const c=t.get(e.name);let u=s;return c&&(u=u.remove(new F(e.name,c))),u.insert(e,e.node)}});return new Qe(i,this.indexSet_)}removeFromIndexes(e,t){const i=rs(this.indexes_,s=>{if(s===an)return s;{const o=t.get(e.name);return o?s.remove(new F(e.name,o)):s}});return new Qe(i,this.indexSet_)}}let zn;class O{static get EMPTY_NODE(){return zn||(zn=new O(new Ee(Po),null,Qe.Default))}constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&yu(this.priorityNode_),this.children_.isEmpty()&&b(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||zn}updatePriority(e){return this.children_.isEmpty()?this:new O(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?zn:t}}getChild(e){const t=L(e);return t===null?this:this.getImmediateChild(t).getChild(G(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(b(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new F(e,t);let s,o;t.isEmpty()?(s=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(i,this.children_));const a=s.isEmpty()?zn:this.priorityNode_;return new O(s,a,o)}}updateChild(e,t){const i=L(e);if(i===null)return t;{b(L(e)!==".priority"||St(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(G(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,o=!0;if(this.forEachChild(J,(a,c)=>{t[a]=c.val(e),i++,o&&O.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!e&&o&&s<2*i){const a=[];for(const c in t)a[c]=t[c];return a}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+mu(this.getPriority().val())+":"),this.forEachChild(J,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":zh(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const o=s.getPredecessorKey(new F(e,t));return o?o.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new F(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new F(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,F.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,e)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,F.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,e)>0;)s.getNext(),o=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Si?-1:0}withIndex(e){if(e===Wt||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new O(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Wt||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(J),s=t.getIterator(J);let o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Wt?null:this.indexMap_.get(e.toString())}}O.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Jm extends O{constructor(){super(new Ee(Po),O.EMPTY_NODE,Qe.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return O.EMPTY_NODE}isEmpty(){return!1}}const Si=new Jm;Object.defineProperties(F,{MIN:{value:new F(Gt,O.EMPTY_NODE)},MAX:{value:new F(Ct,Si)}});_u.__EMPTY_NODE=O.EMPTY_NODE;ae.__childrenNodeConstructor=O;$m(Si);Gm(Si);const Xm=!0;function se(n,e=null){if(n===null)return O.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),b(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new ae(t,se(e))}if(!(n instanceof Array)&&Xm){const t=[];let i=!1;if(he(n,(a,c)=>{if(a.substring(0,1)!=="."){const u=se(c);u.isEmpty()||(i=i||!u.getPriority().isEmpty(),t.push(new F(a,u)))}}),t.length===0)return O.EMPTY_NODE;const o=gs(t,Hm,a=>a.name,Po);if(i){const a=gs(t,J.getCompare());return new O(o,se(e),new Qe({".priority":a},{".priority":J}))}else return new O(o,se(e),Qe.Default)}else{let t=O.EMPTY_NODE;return he(n,(i,s)=>{if(ze(n,i)&&i.substring(0,1)!=="."){const o=se(s);(o.isLeafNode()||!o.isEmpty())&&(t=t.updateImmediateChild(i,o))}}),t.updatePriority(se(e))}}qm(se);class Oo extends Vs{constructor(e){super(),this.indexPath_=e,b(!x(e)&&L(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),o=i.compareTo(s);return o===0?en(e.name,t.name):o}makePost(e,t){const i=se(e),s=O.EMPTY_NODE.updateChild(this.indexPath_,i);return new F(t,s)}maxPost(){const e=O.EMPTY_NODE.updateChild(this.indexPath_,Si);return new F(Ct,e)}toString(){return li(this.indexPath_,0).join("/")}}class Qm extends Vs{compare(e,t){const i=e.node.compareTo(t.node);return i===0?en(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return F.MIN}maxPost(){return F.MAX}makePost(e,t){const i=se(e);return new F(t,i)}toString(){return".value"}}const Iu=new Qm;function Eu(n){return{type:"value",snapshotNode:n}}function yn(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ci(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function hi(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Zm(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Do{constructor(e){this.index_=e}updateChild(e,t,i,s,o,a){b(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const c=e.getImmediateChild(t);return c.getChild(s).equals(i.getChild(s))&&c.isEmpty()===i.isEmpty()||(a!=null&&(i.isEmpty()?e.hasChild(t)?a.trackChildChange(ci(t,c)):b(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?a.trackChildChange(yn(t,i)):a.trackChildChange(hi(t,i,c))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(J,(s,o)=>{t.hasChild(s)||i.trackChildChange(ci(s,o))}),t.isLeafNode()||t.forEachChild(J,(s,o)=>{if(e.hasChild(s)){const a=e.getImmediateChild(s);a.equals(o)||i.trackChildChange(hi(s,o,a))}else i.trackChildChange(yn(s,o))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?O.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class ui{constructor(e){this.indexedFilter_=new Do(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ui.getStartPost_(e),this.endPost_=ui.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,o,a){return this.matches(new F(t,i))||(i=O.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,o,a)}updateFullNode(e,t,i){t.isLeafNode()&&(t=O.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(O.EMPTY_NODE);const o=this;return t.forEachChild(J,(a,c)=>{o.matches(new F(a,c))||(s=s.updateImmediateChild(a,O.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class ey{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new ui(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,o,a){return this.rangedFilter_.matches(new F(t,i))||(i=O.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,o,a):this.fullLimitUpdateChild_(e,t,i,o,a)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=O.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=O.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;o.hasNext()&&a<this.limit_;){const c=o.getNext();if(this.withinDirectionalStart(c))if(this.withinDirectionalEnd(c))s=s.updateImmediateChild(c.name,c.node),a++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(O.EMPTY_NODE);let o;this.reverse_?o=s.getReverseIterator(this.index_):o=s.getIterator(this.index_);let a=0;for(;o.hasNext();){const c=o.getNext();a<this.limit_&&this.withinDirectionalStart(c)&&this.withinDirectionalEnd(c)?a++:s=s.updateImmediateChild(c.name,O.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,o){let a;if(this.reverse_){const _=this.index_.getCompare();a=(v,A)=>_(A,v)}else a=this.index_.getCompare();const c=e;b(c.numChildren()===this.limit_,"");const u=new F(t,i),d=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),m=this.rangedFilter_.matches(u);if(c.hasChild(t)){const _=c.getImmediateChild(t);let v=s.getChildAfterChild(this.index_,d,this.reverse_);for(;v!=null&&(v.name===t||c.hasChild(v.name));)v=s.getChildAfterChild(this.index_,v,this.reverse_);const A=v==null?1:a(v,u);if(m&&!i.isEmpty()&&A>=0)return o?.trackChildChange(hi(t,i,_)),c.updateImmediateChild(t,i);{o?.trackChildChange(ci(t,_));const N=c.updateImmediateChild(t,O.EMPTY_NODE);return v!=null&&this.rangedFilter_.matches(v)?(o?.trackChildChange(yn(v.name,v.node)),N.updateImmediateChild(v.name,v.node)):N}}else return i.isEmpty()?e:m&&a(d,u)>=0?(o!=null&&(o.trackChildChange(ci(d.name,d.node)),o.trackChildChange(yn(t,i))),c.updateImmediateChild(t,i).updateImmediateChild(d.name,O.EMPTY_NODE)):e}}class Mo{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=J}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return b(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return b(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Gt}hasEnd(){return this.endSet_}getIndexEndValue(){return b(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return b(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ct}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return b(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===J}copy(){const e=new Mo;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ty(n){return n.loadsAllData()?new Do(n.getIndex()):n.hasLimit()?new ey(n):new ui(n)}function ny(n,e,t){const i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function iy(n,e,t){const i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function sy(n,e){const t=n.copy();return t.index_=e,t}function rc(n){const e={};if(n.isDefault())return e;let t;if(n.index_===J?t="$priority":n.index_===Iu?t="$value":n.index_===Wt?t="$key":(b(n.index_ instanceof Oo,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=re(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=re(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+re(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=re(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+re(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function oc(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==J&&(e.i=n.index_.toString()),e}class _s extends du{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(b(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Ci("p:rest:"),this.listens_={}}listen(e,t,i,s){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const a=_s.getListenId_(e,i),c={};this.listens_[a]=c;const u=rc(e._queryParams);this.restRequest_(o+".json",u,(d,m)=>{let _=m;if(d===404&&(_=null,d=null),d===null&&this.onDataUpdate_(o,_,!1,i),_n(this.listens_,a)===c){let v;d?d===401?v="permission_denied":v="rest_error:"+d:v="ok",s(v,null)}})}unlisten(e,t){const i=_s.getListenId_(e,t);delete this.listens_[i]}get(e){const t=rc(e._queryParams),i=e._path.toString(),s=new mi;return this.restRequest_(i+".json",t,(o,a)=>{let c=a;o===404&&(c=null,o=null),o===null?(this.onDataUpdate_(i,c,!1,null),s.resolve(c)):s.reject(new Error(c))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,o])=>{s&&s.accessToken&&(t.auth=s.accessToken),o&&o.token&&(t.ac=o.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Cn(t);this.log_("Sending REST request for "+a);const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(i&&c.readyState===4){this.log_("REST Response for "+a+" received. status:",c.status,"response:",c.responseText);let u=null;if(c.status>=200&&c.status<300){try{u=ri(c.responseText)}catch{ye("Failed to parse JSON response for "+a+": "+c.responseText)}i(null,u)}else c.status!==401&&c.status!==404&&ye("Got unsuccessful REST response for "+a+" Status: "+c.status),i(c.status);i=null}},c.open("GET",a,!0),c.send()})}}class ry{constructor(){this.rootNode_=O.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ms(){return{value:null,children:new Map}}function Tu(n,e,t){if(x(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=L(e);n.children.has(i)||n.children.set(i,ms());const s=n.children.get(i);e=G(e),Tu(s,e,t)}}function Xr(n,e,t){n.value!==null?t(e,n.value):oy(n,(i,s)=>{const o=new H(e.toString()+"/"+i);Xr(s,o,t)})}function oy(n,e){n.children.forEach((t,i)=>{e(i,t)})}class ay{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&he(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}const ac=10*1e3,ly=30*1e3,cy=300*1e3;class hy{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ay(e);const i=ac+(ly-ac)*Math.random();Qn(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;he(e,(s,o)=>{o>0&&ze(this.statsToReport_,s)&&(t[s]=o,i=!0)}),i&&this.server_.reportStats(t),Qn(this.reportStats_.bind(this),Math.floor(Math.random()*2*cy))}}var Le;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Le||(Le={}));function Lo(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function xo(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Fo(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class ys{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Le.ACK_USER_WRITE,this.source=Lo()}operationForChild(e){if(x(this.path)){if(this.affectedTree.value!=null)return b(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new H(e));return new ys(j(),t,this.revert)}}else return b(L(this.path)===e,"operationForChild called for unrelated child."),new ys(G(this.path),this.affectedTree,this.revert)}}class di{constructor(e,t){this.source=e,this.path=t,this.type=Le.LISTEN_COMPLETE}operationForChild(e){return x(this.path)?new di(this.source,j()):new di(this.source,G(this.path))}}class zt{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Le.OVERWRITE}operationForChild(e){return x(this.path)?new zt(this.source,j(),this.snap.getImmediateChild(e)):new zt(this.source,G(this.path),this.snap)}}class vn{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Le.MERGE}operationForChild(e){if(x(this.path)){const t=this.children.subtree(new H(e));return t.isEmpty()?null:t.value?new zt(this.source,j(),t.value):new vn(this.source,j(),t)}else return b(L(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new vn(this.source,G(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class At{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(x(e))return this.isFullyInitialized()&&!this.filtered_;const t=L(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class uy{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function dy(n,e,t,i){const s=[],o=[];return e.forEach(a=>{a.type==="child_changed"&&n.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&o.push(Zm(a.childName,a.snapshotNode))}),Kn(n,s,"child_removed",e,i,t),Kn(n,s,"child_added",e,i,t),Kn(n,s,"child_moved",o,i,t),Kn(n,s,"child_changed",e,i,t),Kn(n,s,"value",e,i,t),s}function Kn(n,e,t,i,s,o){const a=i.filter(c=>c.type===t);a.sort((c,u)=>py(n,c,u)),a.forEach(c=>{const u=fy(n,c,o);s.forEach(d=>{d.respondsTo(c.type)&&e.push(d.createEvent(u,n.query_))})})}function fy(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function py(n,e,t){if(e.childName==null||t.childName==null)throw Tn("Should only compare child_ events.");const i=new F(e.childName,e.snapshotNode),s=new F(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function Bs(n,e){return{eventCache:n,serverCache:e}}function Zn(n,e,t,i){return Bs(new At(e,t,i),n.serverCache)}function Cu(n,e,t,i){return Bs(n.eventCache,new At(e,t,i))}function vs(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Kt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Or;const gy=()=>(Or||(Or=new Ee(Q_)),Or);class q{static fromObject(e){let t=new q(null);return he(e,(i,s)=>{t=t.set(new H(i),s)}),t}constructor(e,t=gy()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:j(),value:this.value};if(x(e))return null;{const i=L(e),s=this.children.get(i);if(s!==null){const o=s.findRootMostMatchingPathAndValue(G(e),t);return o!=null?{path:Q(new H(i),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(x(e))return this;{const t=L(e),i=this.children.get(t);return i!==null?i.subtree(G(e)):new q(null)}}set(e,t){if(x(e))return new q(t,this.children);{const i=L(e),o=(this.children.get(i)||new q(null)).set(G(e),t),a=this.children.insert(i,o);return new q(this.value,a)}}remove(e){if(x(e))return this.children.isEmpty()?new q(null):new q(null,this.children);{const t=L(e),i=this.children.get(t);if(i){const s=i.remove(G(e));let o;return s.isEmpty()?o=this.children.remove(t):o=this.children.insert(t,s),this.value===null&&o.isEmpty()?new q(null):new q(this.value,o)}else return this}}get(e){if(x(e))return this.value;{const t=L(e),i=this.children.get(t);return i?i.get(G(e)):null}}setTree(e,t){if(x(e))return t;{const i=L(e),o=(this.children.get(i)||new q(null)).setTree(G(e),t);let a;return o.isEmpty()?a=this.children.remove(i):a=this.children.insert(i,o),new q(this.value,a)}}fold(e){return this.fold_(j(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,o)=>{i[s]=o.fold_(Q(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,j(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(x(e))return null;{const o=L(e),a=this.children.get(o);return a?a.findOnPath_(G(e),Q(t,o),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,j(),t)}foreachOnPath_(e,t,i){if(x(e))return this;{this.value&&i(t,this.value);const s=L(e),o=this.children.get(s);return o?o.foreachOnPath_(G(e),Q(t,s),i):new q(null)}}foreach(e){this.foreach_(j(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(Q(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class Ue{constructor(e){this.writeTree_=e}static empty(){return new Ue(new q(null))}}function ei(n,e,t){if(x(e))return new Ue(new q(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let o=i.value;const a=me(s,e);return o=o.updateChild(a,t),new Ue(n.writeTree_.set(s,o))}else{const s=new q(t),o=n.writeTree_.setTree(e,s);return new Ue(o)}}}function Qr(n,e,t){let i=n;return he(t,(s,o)=>{i=ei(i,Q(e,s),o)}),i}function lc(n,e){if(x(e))return Ue.empty();{const t=n.writeTree_.setTree(e,new q(null));return new Ue(t)}}function Zr(n,e){return tn(n,e)!=null}function tn(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(me(t.path,e)):null}function cc(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(J,(i,s)=>{e.push(new F(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new F(i,s.value))}),e}function It(n,e){if(x(e))return n;{const t=tn(n,e);return t!=null?new Ue(new q(t)):new Ue(n.writeTree_.subtree(e))}}function eo(n){return n.writeTree_.isEmpty()}function wn(n,e){return Su(j(),n.writeTree_,e)}function Su(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,o)=>{s===".priority"?(b(o.value!==null,"Priority writes must always be leaf nodes"),i=o.value):t=Su(Q(n,s),o,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(Q(n,".priority"),i)),t}}function js(n,e){return ku(e,n)}function _y(n,e,t,i,s){b(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=ei(n.visibleWrites,e,t)),n.lastWriteId=i}function my(n,e,t,i){b(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Qr(n.visibleWrites,e,t),n.lastWriteId=i}function yy(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function vy(n,e){const t=n.allWrites.findIndex(c=>c.writeId===e);b(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,o=!1,a=n.allWrites.length-1;for(;s&&a>=0;){const c=n.allWrites[a];c.visible&&(a>=t&&wy(c,i.path)?s=!1:Re(i.path,c.path)&&(o=!0)),a--}if(s){if(o)return Iy(n),!0;if(i.snap)n.visibleWrites=lc(n.visibleWrites,i.path);else{const c=i.children;he(c,u=>{n.visibleWrites=lc(n.visibleWrites,Q(i.path,u))})}return!0}else return!1}function wy(n,e){if(n.snap)return Re(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Re(Q(n.path,t),e))return!0;return!1}function Iy(n){n.visibleWrites=Au(n.allWrites,Ey,j()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Ey(n){return n.visible}function Au(n,e,t){let i=Ue.empty();for(let s=0;s<n.length;++s){const o=n[s];if(e(o)){const a=o.path;let c;if(o.snap)Re(t,a)?(c=me(t,a),i=ei(i,c,o.snap)):Re(a,t)&&(c=me(a,t),i=ei(i,j(),o.snap.getChild(c)));else if(o.children){if(Re(t,a))c=me(t,a),i=Qr(i,c,o.children);else if(Re(a,t))if(c=me(a,t),x(c))i=Qr(i,j(),o.children);else{const u=_n(o.children,L(c));if(u){const d=u.getChild(G(c));i=ei(i,j(),d)}}}else throw Tn("WriteRecord should have .snap or .children")}}return i}function bu(n,e,t,i,s){if(!i&&!s){const o=tn(n.visibleWrites,e);if(o!=null)return o;{const a=It(n.visibleWrites,e);if(eo(a))return t;if(t==null&&!Zr(a,j()))return null;{const c=t||O.EMPTY_NODE;return wn(a,c)}}}else{const o=It(n.visibleWrites,e);if(!s&&eo(o))return t;if(!s&&t==null&&!Zr(o,j()))return null;{const a=function(d){return(d.visible||s)&&(!i||!~i.indexOf(d.writeId))&&(Re(d.path,e)||Re(e,d.path))},c=Au(n.allWrites,a,e),u=t||O.EMPTY_NODE;return wn(c,u)}}}function Ty(n,e,t){let i=O.EMPTY_NODE;const s=tn(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(J,(o,a)=>{i=i.updateImmediateChild(o,a)}),i;if(t){const o=It(n.visibleWrites,e);return t.forEachChild(J,(a,c)=>{const u=wn(It(o,new H(a)),c);i=i.updateImmediateChild(a,u)}),cc(o).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}else{const o=It(n.visibleWrites,e);return cc(o).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}}function Cy(n,e,t,i,s){b(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=Q(e,t);if(Zr(n.visibleWrites,o))return null;{const a=It(n.visibleWrites,o);return eo(a)?s.getChild(t):wn(a,s.getChild(t))}}function Sy(n,e,t,i){const s=Q(e,t),o=tn(n.visibleWrites,s);if(o!=null)return o;if(i.isCompleteForChild(t)){const a=It(n.visibleWrites,s);return wn(a,i.getNode().getImmediateChild(t))}else return null}function Ay(n,e){return tn(n.visibleWrites,e)}function by(n,e,t,i,s,o,a){let c;const u=It(n.visibleWrites,e),d=tn(u,j());if(d!=null)c=d;else if(t!=null)c=wn(u,t);else return[];if(c=c.withIndex(a),!c.isEmpty()&&!c.isLeafNode()){const m=[],_=a.getCompare(),v=o?c.getReverseIteratorFrom(i,a):c.getIteratorFrom(i,a);let A=v.getNext();for(;A&&m.length<s;)_(A,i)!==0&&m.push(A),A=v.getNext();return m}else return[]}function Ry(){return{visibleWrites:Ue.empty(),allWrites:[],lastWriteId:-1}}function ws(n,e,t,i){return bu(n.writeTree,n.treePath,e,t,i)}function Uo(n,e){return Ty(n.writeTree,n.treePath,e)}function hc(n,e,t,i){return Cy(n.writeTree,n.treePath,e,t,i)}function Is(n,e){return Ay(n.writeTree,Q(n.treePath,e))}function ky(n,e,t,i,s,o){return by(n.writeTree,n.treePath,e,t,i,s,o)}function Vo(n,e,t){return Sy(n.writeTree,n.treePath,e,t)}function Ru(n,e){return ku(Q(n.treePath,e),n.writeTree)}function ku(n,e){return{treePath:n,writeTree:e}}class Ny{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;b(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),b(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const o=s.type;if(t==="child_added"&&o==="child_removed")this.changeMap.set(i,hi(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&o==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&o==="child_changed")this.changeMap.set(i,ci(i,s.oldSnap));else if(t==="child_changed"&&o==="child_added")this.changeMap.set(i,yn(i,e.snapshotNode));else if(t==="child_changed"&&o==="child_changed")this.changeMap.set(i,hi(i,e.snapshotNode,s.oldSnap));else throw Tn("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class Py{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const Nu=new Py;class Bo{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new At(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Vo(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Kt(this.viewCache_),o=ky(this.writes_,s,t,1,i,e);return o.length===0?null:o[0]}}function Oy(n){return{filter:n}}function Dy(n,e){b(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),b(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function My(n,e,t,i,s){const o=new Ny;let a,c;if(t.type===Le.OVERWRITE){const d=t;d.source.fromUser?a=to(n,e,d.path,d.snap,i,s,o):(b(d.source.fromServer,"Unknown source."),c=d.source.tagged||e.serverCache.isFiltered()&&!x(d.path),a=Es(n,e,d.path,d.snap,i,s,c,o))}else if(t.type===Le.MERGE){const d=t;d.source.fromUser?a=xy(n,e,d.path,d.children,i,s,o):(b(d.source.fromServer,"Unknown source."),c=d.source.tagged||e.serverCache.isFiltered(),a=no(n,e,d.path,d.children,i,s,c,o))}else if(t.type===Le.ACK_USER_WRITE){const d=t;d.revert?a=Vy(n,e,d.path,i,s,o):a=Fy(n,e,d.path,d.affectedTree,i,s,o)}else if(t.type===Le.LISTEN_COMPLETE)a=Uy(n,e,t.path,i,o);else throw Tn("Unknown operation type: "+t.type);const u=o.getChanges();return Ly(e,a,u),{viewCache:a,changes:u}}function Ly(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),o=vs(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(o)||!i.getNode().getPriority().equals(o.getPriority()))&&t.push(Eu(vs(e)))}}function Pu(n,e,t,i,s,o){const a=e.eventCache;if(Is(i,t)!=null)return e;{let c,u;if(x(t))if(b(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Kt(e),m=d instanceof O?d:O.EMPTY_NODE,_=Uo(i,m);c=n.filter.updateFullNode(e.eventCache.getNode(),_,o)}else{const d=ws(i,Kt(e));c=n.filter.updateFullNode(e.eventCache.getNode(),d,o)}else{const d=L(t);if(d===".priority"){b(St(t)===1,"Can't have a priority with additional path components");const m=a.getNode();u=e.serverCache.getNode();const _=hc(i,t,m,u);_!=null?c=n.filter.updatePriority(m,_):c=a.getNode()}else{const m=G(t);let _;if(a.isCompleteForChild(d)){u=e.serverCache.getNode();const v=hc(i,t,a.getNode(),u);v!=null?_=a.getNode().getImmediateChild(d).updateChild(m,v):_=a.getNode().getImmediateChild(d)}else _=Vo(i,d,e.serverCache);_!=null?c=n.filter.updateChild(a.getNode(),d,_,m,s,o):c=a.getNode()}}return Zn(e,c,a.isFullyInitialized()||x(t),n.filter.filtersNodes())}}function Es(n,e,t,i,s,o,a,c){const u=e.serverCache;let d;const m=a?n.filter:n.filter.getIndexedFilter();if(x(t))d=m.updateFullNode(u.getNode(),i,null);else if(m.filtersNodes()&&!u.isFiltered()){const A=u.getNode().updateChild(t,i);d=m.updateFullNode(u.getNode(),A,null)}else{const A=L(t);if(!u.isCompleteForPath(t)&&St(t)>1)return e;const R=G(t),P=u.getNode().getImmediateChild(A).updateChild(R,i);A===".priority"?d=m.updatePriority(u.getNode(),P):d=m.updateChild(u.getNode(),A,P,R,Nu,null)}const _=Cu(e,d,u.isFullyInitialized()||x(t),m.filtersNodes()),v=new Bo(s,_,o);return Pu(n,_,t,s,v,c)}function to(n,e,t,i,s,o,a){const c=e.eventCache;let u,d;const m=new Bo(s,e,o);if(x(t))d=n.filter.updateFullNode(e.eventCache.getNode(),i,a),u=Zn(e,d,!0,n.filter.filtersNodes());else{const _=L(t);if(_===".priority")d=n.filter.updatePriority(e.eventCache.getNode(),i),u=Zn(e,d,c.isFullyInitialized(),c.isFiltered());else{const v=G(t),A=c.getNode().getImmediateChild(_);let R;if(x(v))R=i;else{const N=m.getCompleteChild(_);N!=null?Ro(v)===".priority"&&N.getChild(pu(v)).isEmpty()?R=N:R=N.updateChild(v,i):R=O.EMPTY_NODE}if(A.equals(R))u=e;else{const N=n.filter.updateChild(c.getNode(),_,R,v,m,a);u=Zn(e,N,c.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function uc(n,e){return n.eventCache.isCompleteForChild(e)}function xy(n,e,t,i,s,o,a){let c=e;return i.foreach((u,d)=>{const m=Q(t,u);uc(e,L(m))&&(c=to(n,c,m,d,s,o,a))}),i.foreach((u,d)=>{const m=Q(t,u);uc(e,L(m))||(c=to(n,c,m,d,s,o,a))}),c}function dc(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function no(n,e,t,i,s,o,a,c){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,d;x(t)?d=i:d=new q(null).setTree(t,i);const m=e.serverCache.getNode();return d.children.inorderTraversal((_,v)=>{if(m.hasChild(_)){const A=e.serverCache.getNode().getImmediateChild(_),R=dc(n,A,v);u=Es(n,u,new H(_),R,s,o,a,c)}}),d.children.inorderTraversal((_,v)=>{const A=!e.serverCache.isCompleteForChild(_)&&v.value===null;if(!m.hasChild(_)&&!A){const R=e.serverCache.getNode().getImmediateChild(_),N=dc(n,R,v);u=Es(n,u,new H(_),N,s,o,a,c)}}),u}function Fy(n,e,t,i,s,o,a){if(Is(s,t)!=null)return e;const c=e.serverCache.isFiltered(),u=e.serverCache;if(i.value!=null){if(x(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return Es(n,e,t,u.getNode().getChild(t),s,o,c,a);if(x(t)){let d=new q(null);return u.getNode().forEachChild(Wt,(m,_)=>{d=d.set(new H(m),_)}),no(n,e,t,d,s,o,c,a)}else return e}else{let d=new q(null);return i.foreach((m,_)=>{const v=Q(t,m);u.isCompleteForPath(v)&&(d=d.set(m,u.getNode().getChild(v)))}),no(n,e,t,d,s,o,c,a)}}function Uy(n,e,t,i,s){const o=e.serverCache,a=Cu(e,o.getNode(),o.isFullyInitialized()||x(t),o.isFiltered());return Pu(n,a,t,i,Nu,s)}function Vy(n,e,t,i,s,o){let a;if(Is(i,t)!=null)return e;{const c=new Bo(i,e,s),u=e.eventCache.getNode();let d;if(x(t)||L(t)===".priority"){let m;if(e.serverCache.isFullyInitialized())m=ws(i,Kt(e));else{const _=e.serverCache.getNode();b(_ instanceof O,"serverChildren would be complete if leaf node"),m=Uo(i,_)}m=m,d=n.filter.updateFullNode(u,m,o)}else{const m=L(t);let _=Vo(i,m,e.serverCache);_==null&&e.serverCache.isCompleteForChild(m)&&(_=u.getImmediateChild(m)),_!=null?d=n.filter.updateChild(u,m,_,G(t),c,o):e.eventCache.getNode().hasChild(m)?d=n.filter.updateChild(u,m,O.EMPTY_NODE,G(t),c,o):d=u,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=ws(i,Kt(e)),a.isLeafNode()&&(d=n.filter.updateFullNode(d,a,o)))}return a=e.serverCache.isFullyInitialized()||Is(i,j())!=null,Zn(e,d,a,n.filter.filtersNodes())}}class By{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Do(i.getIndex()),o=ty(i);this.processor_=Oy(o);const a=t.serverCache,c=t.eventCache,u=s.updateFullNode(O.EMPTY_NODE,a.getNode(),null),d=o.updateFullNode(O.EMPTY_NODE,c.getNode(),null),m=new At(u,a.isFullyInitialized(),s.filtersNodes()),_=new At(d,c.isFullyInitialized(),o.filtersNodes());this.viewCache_=Bs(_,m),this.eventGenerator_=new uy(this.query_)}get query(){return this.query_}}function jy(n){return n.viewCache_.serverCache.getNode()}function Wy(n){return vs(n.viewCache_)}function Hy(n,e){const t=Kt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!x(e)&&!t.getImmediateChild(L(e)).isEmpty())?t.getChild(e):null}function fc(n){return n.eventRegistrations_.length===0}function $y(n,e){n.eventRegistrations_.push(e)}function pc(n,e,t){const i=[];if(t){b(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(o=>{const a=o.createCancelEvent(t,s);a&&i.push(a)})}if(e){let s=[];for(let o=0;o<n.eventRegistrations_.length;++o){const a=n.eventRegistrations_[o];if(!a.matches(e))s.push(a);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(o+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function gc(n,e,t,i){e.type===Le.MERGE&&e.source.queryId!==null&&(b(Kt(n.viewCache_),"We should always have a full cache before handling merges"),b(vs(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,o=My(n.processor_,s,e,t,i);return Dy(n.processor_,o.viewCache),b(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=o.viewCache,Ou(n,o.changes,o.viewCache.eventCache.getNode(),null)}function qy(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(J,(o,a)=>{i.push(yn(o,a))}),t.isFullyInitialized()&&i.push(Eu(t.getNode())),Ou(n,i,t.getNode(),e)}function Ou(n,e,t,i){const s=i?[i]:n.eventRegistrations_;return dy(n.eventGenerator_,e,t,s)}let Ts;class Du{constructor(){this.views=new Map}}function Gy(n){b(!Ts,"__referenceConstructor has already been defined"),Ts=n}function zy(){return b(Ts,"Reference.ts has not been loaded"),Ts}function Ky(n){return n.views.size===0}function jo(n,e,t,i){const s=e.source.queryId;if(s!==null){const o=n.views.get(s);return b(o!=null,"SyncTree gave us an op for an invalid query."),gc(o,e,t,i)}else{let o=[];for(const a of n.views.values())o=o.concat(gc(a,e,t,i));return o}}function Mu(n,e,t,i,s){const o=e._queryIdentifier,a=n.views.get(o);if(!a){let c=ws(t,s?i:null),u=!1;c?u=!0:i instanceof O?(c=Uo(t,i),u=!1):(c=O.EMPTY_NODE,u=!1);const d=Bs(new At(c,u,!1),new At(i,s,!1));return new By(e,d)}return a}function Yy(n,e,t,i,s,o){const a=Mu(n,e,i,s,o);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,a),$y(a,t),qy(a,t)}function Jy(n,e,t,i){const s=e._queryIdentifier,o=[];let a=[];const c=bt(n);if(s==="default")for(const[u,d]of n.views.entries())a=a.concat(pc(d,t,i)),fc(d)&&(n.views.delete(u),d.query._queryParams.loadsAllData()||o.push(d.query));else{const u=n.views.get(s);u&&(a=a.concat(pc(u,t,i)),fc(u)&&(n.views.delete(s),u.query._queryParams.loadsAllData()||o.push(u.query)))}return c&&!bt(n)&&o.push(new(zy())(e._repo,e._path)),{removed:o,events:a}}function Lu(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Et(n,e){let t=null;for(const i of n.views.values())t=t||Hy(i,e);return t}function xu(n,e){if(e._queryParams.loadsAllData())return Ws(n);{const i=e._queryIdentifier;return n.views.get(i)}}function Fu(n,e){return xu(n,e)!=null}function bt(n){return Ws(n)!=null}function Ws(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Cs;function Xy(n){b(!Cs,"__referenceConstructor has already been defined"),Cs=n}function Qy(){return b(Cs,"Reference.ts has not been loaded"),Cs}let Zy=1;class _c{constructor(e){this.listenProvider_=e,this.syncPointTree_=new q(null),this.pendingWriteTree_=Ry(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Uu(n,e,t,i,s){return _y(n.pendingWriteTree_,e,t,i,s),s?An(n,new zt(Lo(),e,t)):[]}function ev(n,e,t,i){my(n.pendingWriteTree_,e,t,i);const s=q.fromObject(t);return An(n,new vn(Lo(),e,s))}function yt(n,e,t=!1){const i=yy(n.pendingWriteTree_,e);if(vy(n.pendingWriteTree_,e)){let o=new q(null);return i.snap!=null?o=o.set(j(),!0):he(i.children,a=>{o=o.set(new H(a),!0)}),An(n,new ys(i.path,o,t))}else return[]}function Ai(n,e,t){return An(n,new zt(xo(),e,t))}function tv(n,e,t){const i=q.fromObject(t);return An(n,new vn(xo(),e,i))}function nv(n,e){return An(n,new di(xo(),e))}function iv(n,e,t){const i=Ho(n,t);if(i){const s=$o(i),o=s.path,a=s.queryId,c=me(o,e),u=new di(Fo(a),c);return qo(n,o,u)}else return[]}function Ss(n,e,t,i,s=!1){const o=e._path,a=n.syncPointTree_.get(o);let c=[];if(a&&(e._queryIdentifier==="default"||Fu(a,e))){const u=Jy(a,e,t,i);Ky(a)&&(n.syncPointTree_=n.syncPointTree_.remove(o));const d=u.removed;if(c=u.events,!s){const m=d.findIndex(v=>v._queryParams.loadsAllData())!==-1,_=n.syncPointTree_.findOnPath(o,(v,A)=>bt(A));if(m&&!_){const v=n.syncPointTree_.subtree(o);if(!v.isEmpty()){const A=ov(v);for(let R=0;R<A.length;++R){const N=A[R],P=N.query,z=Wu(n,N);n.listenProvider_.startListening(ti(P),fi(n,P),z.hashFn,z.onComplete)}}}!_&&d.length>0&&!i&&(m?n.listenProvider_.stopListening(ti(e),null):d.forEach(v=>{const A=n.queryToTagMap.get(Hs(v));n.listenProvider_.stopListening(ti(v),A)}))}av(n,d)}return c}function Vu(n,e,t,i){const s=Ho(n,i);if(s!=null){const o=$o(s),a=o.path,c=o.queryId,u=me(a,e),d=new zt(Fo(c),u,t);return qo(n,a,d)}else return[]}function sv(n,e,t,i){const s=Ho(n,i);if(s){const o=$o(s),a=o.path,c=o.queryId,u=me(a,e),d=q.fromObject(t),m=new vn(Fo(c),u,d);return qo(n,a,m)}else return[]}function io(n,e,t,i=!1){const s=e._path;let o=null,a=!1;n.syncPointTree_.foreachOnPath(s,(v,A)=>{const R=me(v,s);o=o||Et(A,R),a=a||bt(A)});let c=n.syncPointTree_.get(s);c?(a=a||bt(c),o=o||Et(c,j())):(c=new Du,n.syncPointTree_=n.syncPointTree_.set(s,c));let u;o!=null?u=!0:(u=!1,o=O.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((A,R)=>{const N=Et(R,j());N&&(o=o.updateImmediateChild(A,N))}));const d=Fu(c,e);if(!d&&!e._queryParams.loadsAllData()){const v=Hs(e);b(!n.queryToTagMap.has(v),"View does not exist, but we have a tag");const A=lv();n.queryToTagMap.set(v,A),n.tagToQueryMap.set(A,v)}const m=js(n.pendingWriteTree_,s);let _=Yy(c,e,t,m,o,u);if(!d&&!a&&!i){const v=xu(c,e);_=_.concat(cv(n,e,v))}return _}function Wo(n,e,t){const s=n.pendingWriteTree_,o=n.syncPointTree_.findOnPath(e,(a,c)=>{const u=me(a,e),d=Et(c,u);if(d)return d});return bu(s,e,o,t,!0)}function rv(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(d,m)=>{const _=me(d,t);i=i||Et(m,_)});let s=n.syncPointTree_.get(t);s?i=i||Et(s,j()):(s=new Du,n.syncPointTree_=n.syncPointTree_.set(t,s));const o=i!=null,a=o?new At(i,!0,!1):null,c=js(n.pendingWriteTree_,e._path),u=Mu(s,e,c,o?a.getNode():O.EMPTY_NODE,o);return Wy(u)}function An(n,e){return Bu(e,n.syncPointTree_,null,js(n.pendingWriteTree_,j()))}function Bu(n,e,t,i){if(x(n.path))return ju(n,e,t,i);{const s=e.get(j());t==null&&s!=null&&(t=Et(s,j()));let o=[];const a=L(n.path),c=n.operationForChild(a),u=e.children.get(a);if(u&&c){const d=t?t.getImmediateChild(a):null,m=Ru(i,a);o=o.concat(Bu(c,u,d,m))}return s&&(o=o.concat(jo(s,n,i,t))),o}}function ju(n,e,t,i){const s=e.get(j());t==null&&s!=null&&(t=Et(s,j()));let o=[];return e.children.inorderTraversal((a,c)=>{const u=t?t.getImmediateChild(a):null,d=Ru(i,a),m=n.operationForChild(a);m&&(o=o.concat(ju(m,c,u,d)))}),s&&(o=o.concat(jo(s,n,i,t))),o}function Wu(n,e){const t=e.query,i=fi(n,t);return{hashFn:()=>(jy(e)||O.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?iv(n,t._path,i):nv(n,t._path);{const o=tm(s,t);return Ss(n,t,null,o)}}}}function fi(n,e){const t=Hs(e);return n.queryToTagMap.get(t)}function Hs(n){return n._path.toString()+"$"+n._queryIdentifier}function Ho(n,e){return n.tagToQueryMap.get(e)}function $o(n){const e=n.indexOf("$");return b(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new H(n.substr(0,e))}}function qo(n,e,t){const i=n.syncPointTree_.get(e);b(i,"Missing sync point for query tag that we're tracking");const s=js(n.pendingWriteTree_,e);return jo(i,t,s,null)}function ov(n){return n.fold((e,t,i)=>{if(t&&bt(t))return[Ws(t)];{let s=[];return t&&(s=Lu(t)),he(i,(o,a)=>{s=s.concat(a)}),s}})}function ti(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Qy())(n._repo,n._path):n}function av(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=Hs(i),o=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(o)}}}function lv(){return Zy++}function cv(n,e,t){const i=e._path,s=fi(n,e),o=Wu(n,t),a=n.listenProvider_.startListening(ti(e),s,o.hashFn,o.onComplete),c=n.syncPointTree_.subtree(i);if(s)b(!bt(c.value),"If we're adding a query, it shouldn't be shadowed");else{const u=c.fold((d,m,_)=>{if(!x(d)&&m&&bt(m))return[Ws(m).query];{let v=[];return m&&(v=v.concat(Lu(m).map(A=>A.query))),he(_,(A,R)=>{v=v.concat(R)}),v}});for(let d=0;d<u.length;++d){const m=u[d];n.listenProvider_.stopListening(ti(m),fi(n,m))}}return a}class Go{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Go(t)}node(){return this.node_}}class zo{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Q(this.path_,e);return new zo(this.syncTree_,t)}node(){return Wo(this.syncTree_,this.path_)}}const hv=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},mc=function(n,e,t){if(!n||typeof n!="object")return n;if(b(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return uv(n[".sv"],e,t);if(typeof n[".sv"]=="object")return dv(n[".sv"],e);b(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},uv=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:b(!1,"Unexpected server value: "+n)}},dv=function(n,e,t){n.hasOwnProperty("increment")||b(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&b(!1,"Unexpected increment value: "+i);const s=e.node();if(b(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const a=s.getValue();return typeof a!="number"?i:a+i},Hu=function(n,e,t,i){return Ko(e,new zo(t,n),i)},$u=function(n,e,t){return Ko(n,new Go(e),t)};function Ko(n,e,t){const i=n.getPriority().val(),s=mc(i,e.getImmediateChild(".priority"),t);let o;if(n.isLeafNode()){const a=n,c=mc(a.getValue(),e,t);return c!==a.getValue()||s!==a.getPriority().val()?new ae(c,se(s)):n}else{const a=n;return o=a,s!==a.getPriority().val()&&(o=o.updatePriority(new ae(s))),a.forEachChild(J,(c,u)=>{const d=Ko(u,e.getImmediateChild(c),t);d!==u&&(o=o.updateImmediateChild(c,d))}),o}}class Yo{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function Jo(n,e){let t=e instanceof H?e:new H(e),i=n,s=L(t);for(;s!==null;){const o=_n(i.node.children,s)||{children:{},childCount:0};i=new Yo(s,i,o),t=G(t),s=L(t)}return i}function bn(n){return n.node.value}function qu(n,e){n.node.value=e,so(n)}function Gu(n){return n.node.childCount>0}function fv(n){return bn(n)===void 0&&!Gu(n)}function $s(n,e){he(n.node.children,(t,i)=>{e(new Yo(t,n,i))})}function zu(n,e,t,i){t&&e(n),$s(n,s=>{zu(s,e,!0)})}function pv(n,e,t){let i=n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function bi(n){return new H(n.parent===null?n.name:bi(n.parent)+"/"+n.name)}function so(n){n.parent!==null&&gv(n.parent,n.name,n)}function gv(n,e,t){const i=fv(t),s=ze(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,so(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,so(n))}const _v=/[\[\].#$\/\u0000-\u001F\u007F]/,mv=/[\[\].#$\u0000-\u001F\u007F]/,Dr=10*1024*1024,Xo=function(n){return typeof n=="string"&&n.length!==0&&!_v.test(n)},Ku=function(n){return typeof n=="string"&&n.length!==0&&!mv.test(n)},yv=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ku(n)},ro=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!To(n)||n&&typeof n=="object"&&ze(n,".sv")},Ri=function(n,e,t,i){i&&e===void 0||qs(Ds(n,"value"),e,t)},qs=function(n,e,t){const i=t instanceof H?new Lm(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Ft(i));if(typeof e=="function")throw new Error(n+"contains a function "+Ft(i)+" with contents = "+e.toString());if(To(e))throw new Error(n+"contains "+e.toString()+" "+Ft(i));if(typeof e=="string"&&e.length>Dr/3&&Ms(e)>Dr)throw new Error(n+"contains a string greater than "+Dr+" utf8 bytes "+Ft(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,o=!1;if(he(e,(a,c)=>{if(a===".value")s=!0;else if(a!==".priority"&&a!==".sv"&&(o=!0,!Xo(a)))throw new Error(n+" contains an invalid key ("+a+") "+Ft(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);xm(i,a),qs(n,c,i),Fm(i)}),s&&o)throw new Error(n+' contains ".value" child '+Ft(i)+" in addition to actual children.")}},vv=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const o=li(i);for(let a=0;a<o.length;a++)if(!(o[a]===".priority"&&a===o.length-1)){if(!Xo(o[a]))throw new Error(n+"contains an invalid key ("+o[a]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Mm);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&Re(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},wv=function(n,e,t,i){const s=Ds(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const o=[];he(e,(a,c)=>{const u=new H(a);if(qs(s,c,Q(t,u)),Ro(u)===".priority"&&!ro(c))throw new Error(s+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(u)}),vv(s,o)},Qo=function(n,e,t,i){if(!Ku(t))throw new Error(Ds(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Iv=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Qo(n,e,t)},Zo=function(n,e){if(L(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Ev=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Xo(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!yv(t))throw new Error(Ds(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class Tv{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Gs(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],o=s.getPath();t!==null&&!ko(o,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:o}),t.events.push(s)}t&&n.eventLists_.push(t)}function Yu(n,e,t){Gs(n,t),Ju(n,i=>ko(i,e))}function Ne(n,e,t){Gs(n,t),Ju(n,i=>Re(i,e)||Re(e,i))}function Ju(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const o=s.path;e(o)?(Cv(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Cv(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();Xn&&ce("event: "+t.toString()),Sn(i)}}}const Sv="repo_interrupt",Av=25;class bv{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Tv,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ms(),this.transactionQueueTree_=new Yo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Rv(n,e,t){if(n.stats_=Ao(n.repoInfo_),n.forceRestClient_||rm())n.server_=new _s(n.repoInfo_,(i,s,o,a)=>{yc(n,i,s,o,a)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>vc(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{re(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Ze(n.repoInfo_,e,(i,s,o,a)=>{yc(n,i,s,o,a)},i=>{vc(n,i)},i=>{kv(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=hm(n.repoInfo_,()=>new hy(n.stats_,n.server_)),n.infoData_=new ry,n.infoSyncTree_=new _c({startListening:(i,s,o,a)=>{let c=[];const u=n.infoData_.getNode(i._path);return u.isEmpty()||(c=Ai(n.infoSyncTree_,i._path,u),setTimeout(()=>{a("ok")},0)),c},stopListening:()=>{}}),ea(n,"connected",!1),n.serverSyncTree_=new _c({startListening:(i,s,o,a)=>(n.server_.listen(i,o,s,(c,u)=>{const d=a(c,u);Ne(n.eventQueue_,i._path,d)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function Xu(n){const t=n.infoData_.getNode(new H(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function zs(n){return hv({timestamp:Xu(n)})}function yc(n,e,t,i,s){n.dataUpdateCount++;const o=new H(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let a=[];if(s)if(i){const u=rs(t,d=>se(d));a=sv(n.serverSyncTree_,o,u,s)}else{const u=se(t);a=Vu(n.serverSyncTree_,o,u,s)}else if(i){const u=rs(t,d=>se(d));a=tv(n.serverSyncTree_,o,u)}else{const u=se(t);a=Ai(n.serverSyncTree_,o,u)}let c=o;a.length>0&&(c=In(n,o)),Ne(n.eventQueue_,c,a)}function vc(n,e){ea(n,"connected",e),e===!1&&Dv(n)}function kv(n,e){he(e,(t,i)=>{ea(n,t,i)})}function ea(n,e,t){const i=new H("/.info/"+e),s=se(t);n.infoData_.updateSnapshot(i,s);const o=Ai(n.infoSyncTree_,i,s);Ne(n.eventQueue_,i,o)}function ta(n){return n.nextWriteId_++}function Nv(n,e,t){const i=rv(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{const o=se(s).withIndex(e._queryParams.getIndex());io(n.serverSyncTree_,e,t,!0);let a;if(e._queryParams.loadsAllData())a=Ai(n.serverSyncTree_,e._path,o);else{const c=fi(n.serverSyncTree_,e);a=Vu(n.serverSyncTree_,e._path,o,c)}return Ne(n.eventQueue_,e._path,a),Ss(n.serverSyncTree_,e,t,null,!0),o},s=>(ki(n,"get for query "+re(e)+" failed: "+s),Promise.reject(new Error(s))))}function Pv(n,e,t,i,s){ki(n,"set",{path:e.toString(),value:t,priority:i});const o=zs(n),a=se(t,i),c=Wo(n.serverSyncTree_,e),u=$u(a,c,o),d=ta(n),m=Uu(n.serverSyncTree_,e,u,d,!0);Gs(n.eventQueue_,m),n.server_.put(e.toString(),a.val(!0),(v,A)=>{const R=v==="ok";R||ye("set at "+e+" failed: "+v);const N=yt(n.serverSyncTree_,d,!R);Ne(n.eventQueue_,e,N),oo(n,s,v,A)});const _=ia(n,e);In(n,_),Ne(n.eventQueue_,_,[])}function Ov(n,e,t,i){ki(n,"update",{path:e.toString(),value:t});let s=!0;const o=zs(n),a={};if(he(t,(c,u)=>{s=!1,a[c]=Hu(Q(e,c),se(u),n.serverSyncTree_,o)}),s)ce("update() called with empty data.  Don't do anything."),oo(n,i,"ok",void 0);else{const c=ta(n),u=ev(n.serverSyncTree_,e,a,c);Gs(n.eventQueue_,u),n.server_.merge(e.toString(),t,(d,m)=>{const _=d==="ok";_||ye("update at "+e+" failed: "+d);const v=yt(n.serverSyncTree_,c,!_),A=v.length>0?In(n,e):e;Ne(n.eventQueue_,A,v),oo(n,i,d,m)}),he(t,d=>{const m=ia(n,Q(e,d));In(n,m)}),Ne(n.eventQueue_,e,[])}}function Dv(n){ki(n,"onDisconnectEvents");const e=zs(n),t=ms();Xr(n.onDisconnect_,j(),(s,o)=>{const a=Hu(s,o,n.serverSyncTree_,e);Tu(t,s,a)});let i=[];Xr(t,j(),(s,o)=>{i=i.concat(Ai(n.serverSyncTree_,s,o));const a=ia(n,s);In(n,a)}),n.onDisconnect_=ms(),Ne(n.eventQueue_,j(),i)}function Mv(n,e,t){let i;L(e._path)===".info"?i=io(n.infoSyncTree_,e,t):i=io(n.serverSyncTree_,e,t),Yu(n.eventQueue_,e._path,i)}function Qu(n,e,t){let i;L(e._path)===".info"?i=Ss(n.infoSyncTree_,e,t):i=Ss(n.serverSyncTree_,e,t),Yu(n.eventQueue_,e._path,i)}function Lv(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Sv)}function ki(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),ce(t,...e)}function oo(n,e,t,i){e&&Sn(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let o=s;i&&(o+=": "+i);const a=new Error(o);a.code=s,e(a)}})}function Zu(n,e,t){return Wo(n.serverSyncTree_,e,t)||O.EMPTY_NODE}function na(n,e=n.transactionQueueTree_){if(e||Ks(n,e),bn(e)){const t=td(n,e);b(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&xv(n,bi(e),t)}else Gu(e)&&$s(e,t=>{na(n,t)})}function xv(n,e,t){const i=t.map(d=>d.currentWriteId),s=Zu(n,e,i);let o=s;const a=s.hash();for(let d=0;d<t.length;d++){const m=t[d];b(m.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),m.status=1,m.retryCount++;const _=me(e,m.path);o=o.updateChild(_,m.currentOutputSnapshotRaw)}const c=o.val(!0),u=e;n.server_.put(u.toString(),c,d=>{ki(n,"transaction put response",{path:u.toString(),status:d});let m=[];if(d==="ok"){const _=[];for(let v=0;v<t.length;v++)t[v].status=2,m=m.concat(yt(n.serverSyncTree_,t[v].currentWriteId)),t[v].onComplete&&_.push(()=>t[v].onComplete(null,!0,t[v].currentOutputSnapshotResolved)),t[v].unwatcher();Ks(n,Jo(n.transactionQueueTree_,e)),na(n,n.transactionQueueTree_),Ne(n.eventQueue_,e,m);for(let v=0;v<_.length;v++)Sn(_[v])}else{if(d==="datastale")for(let _=0;_<t.length;_++)t[_].status===3?t[_].status=4:t[_].status=0;else{ye("transaction at "+u.toString()+" failed: "+d);for(let _=0;_<t.length;_++)t[_].status=4,t[_].abortReason=d}In(n,e)}},a)}function In(n,e){const t=ed(n,e),i=bi(t),s=td(n,t);return Fv(n,s,i),i}function Fv(n,e,t){if(e.length===0)return;const i=[];let s=[];const a=e.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<e.length;c++){const u=e[c],d=me(t,u.path);let m=!1,_;if(b(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)m=!0,_=u.abortReason,s=s.concat(yt(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=Av)m=!0,_="maxretry",s=s.concat(yt(n.serverSyncTree_,u.currentWriteId,!0));else{const v=Zu(n,u.path,a);u.currentInputSnapshot=v;const A=e[c].update(v.val());if(A!==void 0){qs("transaction failed: Data returned ",A,u.path);let R=se(A);typeof A=="object"&&A!=null&&ze(A,".priority")||(R=R.updatePriority(v.getPriority()));const P=u.currentWriteId,z=zs(n),ee=$u(R,v,z);u.currentOutputSnapshotRaw=R,u.currentOutputSnapshotResolved=ee,u.currentWriteId=ta(n),a.splice(a.indexOf(P),1),s=s.concat(Uu(n.serverSyncTree_,u.path,ee,u.currentWriteId,u.applyLocally)),s=s.concat(yt(n.serverSyncTree_,P,!0))}else m=!0,_="nodata",s=s.concat(yt(n.serverSyncTree_,u.currentWriteId,!0))}Ne(n.eventQueue_,t,s),s=[],m&&(e[c].status=2,(function(v){setTimeout(v,Math.floor(0))})(e[c].unwatcher),e[c].onComplete&&(_==="nodata"?i.push(()=>e[c].onComplete(null,!1,e[c].currentInputSnapshot)):i.push(()=>e[c].onComplete(new Error(_),!1,null))))}Ks(n,n.transactionQueueTree_);for(let c=0;c<i.length;c++)Sn(i[c]);na(n,n.transactionQueueTree_)}function ed(n,e){let t,i=n.transactionQueueTree_;for(t=L(e);t!==null&&bn(i)===void 0;)i=Jo(i,t),e=G(e),t=L(e);return i}function td(n,e){const t=[];return nd(n,e,t),t.sort((i,s)=>i.order-s.order),t}function nd(n,e,t){const i=bn(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);$s(e,s=>{nd(n,s,t)})}function Ks(n,e){const t=bn(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,qu(e,t.length>0?t:void 0)}$s(e,i=>{Ks(n,i)})}function ia(n,e){const t=bi(ed(n,e)),i=Jo(n.transactionQueueTree_,e);return pv(i,s=>{Mr(n,s)}),Mr(n,i),zu(i,s=>{Mr(n,s)}),t}function Mr(n,e){const t=bn(e);if(t){const i=[];let s=[],o=-1;for(let a=0;a<t.length;a++)t[a].status===3||(t[a].status===1?(b(o===a-1,"All SENT items should be at beginning of queue."),o=a,t[a].status=3,t[a].abortReason="set"):(b(t[a].status===0,"Unexpected transaction status in abort"),t[a].unwatcher(),s=s.concat(yt(n.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&i.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));o===-1?qu(e,void 0):t.length=o+1,Ne(n.eventQueue_,bi(e),s);for(let a=0;a<i.length;a++)Sn(i[a])}}function Uv(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function Vv(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):ye(`Invalid query segment '${t}' in query '${n}'`)}return e}const wc=function(n,e){const t=Bv(n),i=t.namespace;t.domain==="firebase.com"&&st(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&st("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||J_();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new ru(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new H(t.pathString)}},Bv=function(n){let e="",t="",i="",s="",o="",a=!0,c="https",u=443;if(typeof n=="string"){let d=n.indexOf("//");d>=0&&(c=n.substring(0,d-1),n=n.substring(d+2));let m=n.indexOf("/");m===-1&&(m=n.length);let _=n.indexOf("?");_===-1&&(_=n.length),e=n.substring(0,Math.min(m,_)),m<_&&(s=Uv(n.substring(m,_)));const v=Vv(n.substring(Math.min(n.length,_)));d=e.indexOf(":"),d>=0?(a=c==="https"||c==="wss",u=parseInt(e.substring(d+1),10)):d=e.length;const A=e.slice(0,d);if(A.toLowerCase()==="localhost")t="localhost";else if(A.split(".").length<=2)t=A;else{const R=e.indexOf(".");i=e.substring(0,R).toLowerCase(),t=e.substring(R+1),o=i}"ns"in v&&(o=v.ns)}return{host:e,port:u,domain:t,subdomain:i,secure:a,scheme:c,pathString:s,namespace:o}};const Ic="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",jv=(function(){let n=0;const e=[];return function(t){const i=t===n;n=t;let s;const o=new Array(8);for(s=7;s>=0;s--)o[s]=Ic.charAt(t%64),t=Math.floor(t/64);b(t===0,"Cannot push at time == 0");let a=o.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)a+=Ic.charAt(e[s]);return b(a.length===20,"nextPushId: Length should be 20."),a}})();class Wv{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+re(this.snapshot.exportVal())}}class Hv{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class sa{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return b(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Rn{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return x(this._path)?null:Ro(this._path)}get ref(){return new ot(this._repo,this._path)}get _queryIdentifier(){const e=oc(this._queryParams),t=Co(e);return t==="{}"?"default":t}get _queryObject(){return oc(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof Rn))return!1;const t=this._repo===e._repo,i=ko(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Dm(this._path)}}function $v(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function ra(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Wt){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Gt)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Ct)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===J){if(e!=null&&!ro(e)||t!=null&&!ro(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(b(n.getIndex()instanceof Oo||n.getIndex()===Iu,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function id(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class ot extends Rn{constructor(e,t){super(e,t,new Mo,!1)}get parent(){const e=pu(this._path);return e===null?null:new ot(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class pi{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new H(e),i=gi(this.ref,e);return new pi(this._node.getChild(t),i,J)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new pi(s,gi(this.ref,i),J)))}hasChild(e){const t=new H(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function FE(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?gi(n._root,e):n._root}function gi(n,e){return n=ne(n),L(n._path)===null?Iv("child","path",e):Qo("child","path",e),new ot(n._repo,Q(n._path,e))}function UE(n,e){n=ne(n),Zo("push",n._path),Ri("push",e,n._path,!0);const t=Xu(n._repo),i=jv(t),s=gi(n,i),o=gi(n,i);let a;return a=Promise.resolve(o),s.then=a.then.bind(a),s.catch=a.then.bind(a,void 0),s}function VE(n){return Zo("remove",n._path),qv(n,null)}function qv(n,e){n=ne(n),Zo("set",n._path),Ri("set",e,n._path,!1);const t=new mi;return Pv(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function BE(n,e){wv("update",e,n._path);const t=new mi;return Ov(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function jE(n){n=ne(n);const e=new sa(()=>{}),t=new Ni(e);return Nv(n._repo,n,t).then(i=>new pi(i,new ot(n._repo,n._path),n._queryParams.getIndex()))}class Ni{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new Wv("value",this,new pi(e.snapshotNode,new ot(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Hv(this,e,t):null}matches(e){return e instanceof Ni?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function Gv(n,e,t,i,s){const o=new sa(t,void 0),a=new Ni(o);return Mv(n._repo,n,a),()=>Qu(n._repo,n,a)}function WE(n,e,t,i){return Gv(n,"value",e)}function HE(n,e,t){let i=null;const s=t?new sa(t):null;i=new Ni(s),Qu(n._repo,n,i)}class Ys{}class zv extends Ys{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Ri("endAt",this._value,e._path,!0);const t=iy(e._queryParams,this._value,this._key);if(id(t),ra(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Rn(e._repo,e._path,t,e._orderByCalled)}}class Kv extends Ys{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Ri("startAt",this._value,e._path,!0);const t=ny(e._queryParams,this._value,this._key);if(id(t),ra(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Rn(e._repo,e._path,t,e._orderByCalled)}}function $E(n){throw new Error("limitToFirst: First argument must be a positive integer.")}class Yv extends Ys{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){$v(e,"orderByChild");const t=new H(this._path);if(x(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new Oo(t),s=sy(e._queryParams,i);return ra(s),new Rn(e._repo,e._path,s,!0)}}function qE(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Qo("orderByChild","path",n),new Yv(n)}class Jv extends Ys{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Ri("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new zv(this._value,this._key)._apply(new Kv(this._value,this._key)._apply(e))}}function GE(n,e){return new Jv(n,e)}function zE(n,...e){let t=ne(n);for(const i of e)t=i._apply(t);return t}Gy(ot);Xy(ot);const Xv="FIREBASE_DATABASE_EMULATOR_HOST",ao={};let Qv=!1;function Zv(n,e,t,i){const s=e.lastIndexOf(":"),o=e.substring(0,s),a=kt(o);n.repoInfo_=new ru(e,a,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function ew(n,e,t,i,s){let o=i||n.options.databaseURL;o===void 0&&(n.options.projectId||st("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ce("Using default host for project ",n.options.projectId),o=`${n.options.projectId}-default-rtdb.firebaseio.com`);let a=wc(o,s),c=a.repoInfo,u;typeof process<"u"&&Wl&&(u=Wl[Xv]),u?(o=`http://${u}?ns=${c.namespace}`,a=wc(o,s),c=a.repoInfo):a.repoInfo.secure;const d=new am(n.name,n.options,e);Ev("Invalid Firebase Database URL",a),x(a.path)||st("Database URL must point to the root of a Firebase Database (not including a child path).");const m=nw(c,n,d,new om(n,t));return new iw(m,n)}function tw(n,e){const t=ao[e];(!t||t[n.key]!==n)&&st(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Lv(n),delete t[n.key]}function nw(n,e,t,i){let s=ao[e.name];s||(s={},ao[e.name]=s);let o=s[n.toURLString()];return o&&st("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new bv(n,Qv,t,i),s[n.toURLString()]=o,o}class iw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Rv(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ot(this._repo,j())),this._rootInternal}_delete(){return this._rootInternal!==null&&(tw(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&st("Cannot call "+e+" on a deleted database.")}}function KE(n=vi(),e){const t=rt(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const i=fo("database");i&&sw(t,...i)}return t}function sw(n,e,t,i={}){n=ne(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,o=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&et(i,o.repoInfo_.emulatorOptions))return;st("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&st('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new ts(ts.OWNER);else if(i.mockUserToken){const c=typeof i.mockUserToken=="string"?i.mockUserToken:po(i.mockUserToken,n.app.options.projectId);a=new ts(c)}kt(e)&&(Ps(e),Os("Database",!0)),Zv(o,s,i,a)}function rw(n){$_(Nt),ke(new Ae("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return ew(i,s,o,t)},"PUBLIC").setMultipleInstances(!0)),fe(Hl,$l,n),fe(Hl,$l,"esm2020")}const ow={".sv":"timestamp"};function YE(){return ow}Ze.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ze.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};rw();const sd="firebasestorage.googleapis.com",aw="storageBucket",lw=120*1e3,cw=600*1e3;class Ke extends Pe{constructor(e,t,i=0){super(Lr(e),`Firebase Storage: ${t} (${Lr(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ke.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Lr(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ge;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ge||(Ge={}));function Lr(n){return"storage/"+n}function hw(){const n="An unknown error occurred, please check the error payload for server response.";return new Ke(Ge.UNKNOWN,n)}function uw(){return new Ke(Ge.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function dw(){return new Ke(Ge.CANCELED,"User canceled the upload/download.")}function fw(n){return new Ke(Ge.INVALID_URL,"Invalid URL '"+n+"'.")}function pw(n){return new Ke(Ge.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Ec(n){return new Ke(Ge.INVALID_ARGUMENT,n)}function rd(){return new Ke(Ge.APP_DELETED,"The Firebase app was deleted.")}function gw(n){return new Ke(Ge.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class xe{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=xe.makeFromUrl(e,t)}catch{return new xe(e,"")}if(i.path==="")return i;throw pw(e)}static makeFromUrl(e,t){let i=null;const s="([A-Za-z0-9.\\-_]+)";function o(X){X.path.charAt(X.path.length-1)==="/"&&(X.path_=X.path_.slice(0,-1))}const a="(/(.*))?$",c=new RegExp("^gs://"+s+a,"i"),u={bucket:1,path:3};function d(X){X.path_=decodeURIComponent(X.path)}const m="v[A-Za-z0-9_]+",_=t.replace(/[.]/g,"\\."),v="(/([^?#]*).*)?$",A=new RegExp(`^https?://${_}/${m}/b/${s}/o${v}`,"i"),R={bucket:1,path:3},N=t===sd?"(?:storage.googleapis.com|storage.cloud.google.com)":t,P="([^?#]*)",z=new RegExp(`^https?://${N}/${s}/${P}`,"i"),Y=[{regex:c,indices:u,postModify:o},{regex:A,indices:R,postModify:d},{regex:z,indices:{bucket:1,path:2},postModify:d}];for(let X=0;X<Y.length;X++){const Te=Y[X],ue=Te.regex.exec(e);if(ue){const I=ue[Te.indices.bucket];let p=ue[Te.indices.path];p||(p=""),i=new xe(I,p),Te.postModify(i);break}}if(i==null)throw fw(e);return i}}class _w{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function mw(n,e,t){let i=1,s=null,o=null,a=!1,c=0;function u(){return c===2}let d=!1;function m(...P){d||(d=!0,e.apply(null,P))}function _(P){s=setTimeout(()=>{s=null,n(A,u())},P)}function v(){o&&clearTimeout(o)}function A(P,...z){if(d){v();return}if(P){v(),m.call(null,P,...z);return}if(u()||a){v(),m.call(null,P,...z);return}i<64&&(i*=2);let Y;c===1?(c=2,Y=0):Y=(i+Math.random())*1e3,_(Y)}let R=!1;function N(P){R||(R=!0,v(),!d&&(s!==null?(P||(c=2),clearTimeout(s),_(0)):P||(c=1)))}return _(0),o=setTimeout(()=>{a=!0,N(!0)},t),N}function yw(n){n(!1)}function vw(n){return n!==void 0}function Tc(n,e,t,i){if(i<e)throw Ec(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw Ec(`Invalid value for '${n}'. Expected ${t} or less.`)}function ww(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const s=e(i)+"="+e(n[i]);t=t+s+"&"}return t=t.slice(0,-1),t}var As;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(As||(As={}));function Iw(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,o=e.indexOf(n)!==-1;return t||s||o}class Ew{constructor(e,t,i,s,o,a,c,u,d,m,_,v=!0,A=!1){this.url_=e,this.method_=t,this.headers_=i,this.body_=s,this.successCodes_=o,this.additionalRetryCodes_=a,this.callback_=c,this.errorCallback_=u,this.timeout_=d,this.progressCallback_=m,this.connectionFactory_=_,this.retry=v,this.isUsingEmulator=A,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,N)=>{this.resolve_=R,this.reject_=N,this.start_()})}start_(){const e=(i,s)=>{if(s){i(!1,new Ki(!1,null,!0));return}const o=this.connectionFactory_();this.pendingConnection_=o;const a=c=>{const u=c.loaded,d=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,d)};this.progressCallback_!==null&&o.addUploadProgressListener(a),o.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(a),this.pendingConnection_=null;const c=o.getErrorCode()===As.NO_ERROR,u=o.getStatus();if(!c||Iw(u,this.additionalRetryCodes_)&&this.retry){const m=o.getErrorCode()===As.ABORT;i(!1,new Ki(!1,null,m));return}const d=this.successCodes_.indexOf(u)!==-1;i(!0,new Ki(d,o))})},t=(i,s)=>{const o=this.resolve_,a=this.reject_,c=s.connection;if(s.wasSuccessCode)try{const u=this.callback_(c,c.getResponse());vw(u)?o(u):o()}catch(u){a(u)}else if(c!==null){const u=hw();u.serverResponse=c.getErrorText(),this.errorCallback_?a(this.errorCallback_(c,u)):a(u)}else if(s.canceled){const u=this.appDelete_?rd():dw();a(u)}else{const u=uw();a(u)}};this.canceled_?t(!1,new Ki(!1,null,!0)):this.backoffId_=mw(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&yw(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ki{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function Tw(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function Cw(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Sw(n,e){e&&(n["X-Firebase-GMPID"]=e)}function Aw(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function bw(n,e,t,i,s,o,a=!0,c=!1){const u=ww(n.urlParams),d=n.url+u,m=Object.assign({},n.headers);return Sw(m,e),Tw(m,t),Cw(m,o),Aw(m,i),new Ew(d,n.method,m,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,a,c)}function Rw(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function kw(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}class bs{constructor(e,t){this._service=e,t instanceof xe?this._location=t:this._location=xe.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new bs(e,t)}get root(){const e=new xe(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return kw(this._location.path)}get storage(){return this._service}get parent(){const e=Rw(this._location.path);if(e===null)return null;const t=new xe(this._location.bucket,e);return new bs(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw gw(e)}}function Cc(n,e){const t=e?.[aw];return t==null?null:xe.makeFromBucketSpec(t,n)}function Nw(n,e,t,i={}){n.host=`${e}:${t}`;const s=kt(e);s&&(Ps(`https://${n.host}/b`),Os("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";const{mockUserToken:o}=i;o&&(n._overrideAuthToken=typeof o=="string"?o:po(o,n.app.options.projectId))}class Pw{constructor(e,t,i,s,o,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=s,this._firebaseVersion=o,this._isUsingEmulator=a,this._bucket=null,this._host=sd,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=lw,this._maxUploadRetryTime=cw,this._requests=new Set,s!=null?this._bucket=xe.makeFromBucketSpec(s,this._host):this._bucket=Cc(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=xe.makeFromBucketSpec(this._url,e):this._bucket=Cc(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Tc("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Tc("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Ce(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new bs(this,e)}_makeRequest(e,t,i,s,o=!0){if(this._deleted)return new _w(rd());{const a=bw(e,this._appId,i,s,t,this._firebaseVersion,o,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[i,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,s).getPromise()}}const Sc="@firebase/storage",Ac="0.14.0";const od="storage";function JE(n=vi(),e){n=ne(n);const i=rt(n,od).getImmediate({identifier:e}),s=fo("storage");return s&&Ow(i,...s),i}function Ow(n,e,t,i={}){Nw(n,e,t,i)}function Dw(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Pw(t,i,s,e,Nt)}function Mw(){ke(new Ae(od,Dw,"PUBLIC").setMultipleInstances(!0)),fe(Sc,Ac,""),fe(Sc,Ac,"esm2020")}Mw();const ad="@firebase/installations",oa="0.6.19";const ld=1e4,cd=`w:${oa}`,hd="FIS_v2",Lw="https://firebaseinstallations.googleapis.com/v1",xw=3600*1e3,Fw="installations",Uw="Installations";const Vw={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Yt=new Qt(Fw,Uw,Vw);function ud(n){return n instanceof Pe&&n.code.includes("request-failed")}function dd({projectId:n}){return`${Lw}/projects/${n}/installations`}function fd(n){return{token:n.token,requestStatus:2,expiresIn:jw(n.expiresIn),creationTime:Date.now()}}async function pd(n,e){const i=(await e.json()).error;return Yt.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function gd({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Bw(n,{refreshToken:e}){const t=gd(n);return t.append("Authorization",Ww(e)),t}async function _d(n){const e=await n();return e.status>=500&&e.status<600?n():e}function jw(n){return Number(n.replace("s","000"))}function Ww(n){return`${hd} ${n}`}async function Hw({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const i=dd(n),s=gd(n),o=e.getImmediate({optional:!0});if(o){const d=await o.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={fid:t,authVersion:hd,appId:n.appId,sdkVersion:cd},c={method:"POST",headers:s,body:JSON.stringify(a)},u=await _d(()=>fetch(i,c));if(u.ok){const d=await u.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:fd(d.authToken)}}else throw await pd("Create Installation",u)}function md(n){return new Promise(e=>{setTimeout(e,n)})}function $w(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}const qw=/^[cdef][\w-]{21}$/,lo="";function Gw(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=zw(n);return qw.test(t)?t:lo}catch{return lo}}function zw(n){return $w(n).substr(0,22)}function Js(n){return`${n.appName}!${n.appId}`}const yd=new Map;function vd(n,e){const t=Js(n);wd(t,e),Kw(t,e)}function wd(n,e){const t=yd.get(n);if(t)for(const i of t)i(e)}function Kw(n,e){const t=Yw();t&&t.postMessage({key:n,fid:e}),Jw()}let Bt=null;function Yw(){return!Bt&&"BroadcastChannel"in self&&(Bt=new BroadcastChannel("[Firebase] FID Change"),Bt.onmessage=n=>{wd(n.data.key,n.data.fid)}),Bt}function Jw(){yd.size===0&&Bt&&(Bt.close(),Bt=null)}const Xw="firebase-installations-database",Qw=1,Jt="firebase-installations-store";let xr=null;function aa(){return xr||(xr=Qc(Xw,Qw,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Jt)}}})),xr}async function Rs(n,e){const t=Js(n),s=(await aa()).transaction(Jt,"readwrite"),o=s.objectStore(Jt),a=await o.get(t);return await o.put(e,t),await s.done,(!a||a.fid!==e.fid)&&vd(n,e.fid),e}async function Id(n){const e=Js(n),i=(await aa()).transaction(Jt,"readwrite");await i.objectStore(Jt).delete(e),await i.done}async function Xs(n,e){const t=Js(n),s=(await aa()).transaction(Jt,"readwrite"),o=s.objectStore(Jt),a=await o.get(t),c=e(a);return c===void 0?await o.delete(t):await o.put(c,t),await s.done,c&&(!a||a.fid!==c.fid)&&vd(n,c.fid),c}async function la(n){let e;const t=await Xs(n.appConfig,i=>{const s=Zw(i),o=eI(n,s);return e=o.registrationPromise,o.installationEntry});return t.fid===lo?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function Zw(n){const e=n||{fid:Gw(),registrationStatus:0};return Ed(e)}function eI(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Yt.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=tI(n,t);return{installationEntry:t,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:nI(n)}:{installationEntry:e}}async function tI(n,e){try{const t=await Hw(n,e);return Rs(n.appConfig,t)}catch(t){throw ud(t)&&t.customData.serverCode===409?await Id(n.appConfig):await Rs(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function nI(n){let e=await bc(n.appConfig);for(;e.registrationStatus===1;)await md(100),e=await bc(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:i}=await la(n);return i||t}return e}function bc(n){return Xs(n,e=>{if(!e)throw Yt.create("installation-not-found");return Ed(e)})}function Ed(n){return iI(n)?{fid:n.fid,registrationStatus:0}:n}function iI(n){return n.registrationStatus===1&&n.registrationTime+ld<Date.now()}async function sI({appConfig:n,heartbeatServiceProvider:e},t){const i=rI(n,t),s=Bw(n,t),o=e.getImmediate({optional:!0});if(o){const d=await o.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={installation:{sdkVersion:cd,appId:n.appId}},c={method:"POST",headers:s,body:JSON.stringify(a)},u=await _d(()=>fetch(i,c));if(u.ok){const d=await u.json();return fd(d)}else throw await pd("Generate Auth Token",u)}function rI(n,{fid:e}){return`${dd(n)}/${e}/authTokens:generate`}async function ca(n,e=!1){let t;const i=await Xs(n.appConfig,o=>{if(!Td(o))throw Yt.create("not-registered");const a=o.authToken;if(!e&&lI(a))return o;if(a.requestStatus===1)return t=oI(n,e),o;{if(!navigator.onLine)throw Yt.create("app-offline");const c=hI(o);return t=aI(n,c),c}});return t?await t:i.authToken}async function oI(n,e){let t=await Rc(n.appConfig);for(;t.authToken.requestStatus===1;)await md(100),t=await Rc(n.appConfig);const i=t.authToken;return i.requestStatus===0?ca(n,e):i}function Rc(n){return Xs(n,e=>{if(!Td(e))throw Yt.create("not-registered");const t=e.authToken;return uI(t)?{...e,authToken:{requestStatus:0}}:e})}async function aI(n,e){try{const t=await sI(n,e),i={...e,authToken:t};return await Rs(n.appConfig,i),t}catch(t){if(ud(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Id(n.appConfig);else{const i={...e,authToken:{requestStatus:0}};await Rs(n.appConfig,i)}throw t}}function Td(n){return n!==void 0&&n.registrationStatus===2}function lI(n){return n.requestStatus===2&&!cI(n)}function cI(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+xw}function hI(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function uI(n){return n.requestStatus===1&&n.requestTime+ld<Date.now()}async function dI(n){const e=n,{installationEntry:t,registrationPromise:i}=await la(e);return i?i.catch(console.error):ca(e).catch(console.error),t.fid}async function fI(n,e=!1){const t=n;return await pI(t),(await ca(t,e)).token}async function pI(n){const{registrationPromise:e}=await la(n);e&&await e}function gI(n){if(!n||!n.options)throw Fr("App Configuration");if(!n.name)throw Fr("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Fr(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Fr(n){return Yt.create("missing-app-config-values",{valueName:n})}const Cd="installations",_I="installations-internal",mI=n=>{const e=n.getProvider("app").getImmediate(),t=gI(e),i=rt(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},yI=n=>{const e=n.getProvider("app").getImmediate(),t=rt(e,Cd).getImmediate();return{getId:()=>dI(t),getToken:s=>fI(t,s)}};function vI(){ke(new Ae(Cd,mI,"PUBLIC")),ke(new Ae(_I,yI,"PRIVATE"))}vI();fe(ad,oa);fe(ad,oa,"esm2020");const ks="analytics",wI="firebase_id",II="origin",EI=60*1e3,TI="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ha="https://www.googletagmanager.com/gtag/js";const ve=new yi("@firebase/analytics");const CI={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Se=new Qt("analytics","Analytics",CI);function SI(n){if(!n.startsWith(ha)){const e=Se.create("invalid-gtag-resource",{gtagURL:n});return ve.warn(e.message),""}return n}function Sd(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function AI(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function bI(n,e){const t=AI("firebase-js-sdk-policy",{createScriptURL:SI}),i=document.createElement("script"),s=`${ha}?l=${n}&id=${e}`;i.src=t?t?.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}function RI(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function kI(n,e,t,i,s,o){const a=i[s];try{if(a)await e[a];else{const u=(await Sd(t)).find(d=>d.measurementId===s);u&&await e[u.appId]}}catch(c){ve.error(c)}n("config",s,o)}async function NI(n,e,t,i,s){try{let o=[];if(s&&s.send_to){let a=s.send_to;Array.isArray(a)||(a=[a]);const c=await Sd(t);for(const u of a){const d=c.find(_=>_.measurementId===u),m=d&&e[d.appId];if(m)o.push(m);else{o=[];break}}}o.length===0&&(o=Object.values(e)),await Promise.all(o),n("event",i,s||{})}catch(o){ve.error(o)}}function PI(n,e,t,i){async function s(o,...a){try{if(o==="event"){const[c,u]=a;await NI(n,e,t,c,u)}else if(o==="config"){const[c,u]=a;await kI(n,e,t,i,c,u)}else if(o==="consent"){const[c,u]=a;n("consent",c,u)}else if(o==="get"){const[c,u,d]=a;n("get",c,u,d)}else if(o==="set"){const[c]=a;n("set",c)}else n(o,...a)}catch(c){ve.error(c)}}return s}function OI(n,e,t,i,s){let o=function(...a){window[i].push(arguments)};return window[s]&&typeof window[s]=="function"&&(o=window[s]),window[s]=PI(o,n,e,t),{gtagCore:o,wrappedGtag:window[s]}}function DI(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(ha)&&t.src.includes(n))return t;return null}const MI=30,LI=1e3;class xI{constructor(e={},t=LI){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Ad=new xI;function FI(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function UI(n){const{appId:e,apiKey:t}=n,i={method:"GET",headers:FI(t)},s=TI.replace("{app-id}",e),o=await fetch(s,i);if(o.status!==200&&o.status!==304){let a="";try{const c=await o.json();c.error?.message&&(a=c.error.message)}catch{}throw Se.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function VI(n,e=Ad,t){const{appId:i,apiKey:s,measurementId:o}=n.options;if(!i)throw Se.create("no-app-id");if(!s){if(o)return{measurementId:o,appId:i};throw Se.create("no-api-key")}const a=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new WI;return setTimeout(async()=>{c.abort()},EI),bd({appId:i,apiKey:s,measurementId:o},a,c,e)}async function bd(n,{throttleEndTimeMillis:e,backoffCount:t},i,s=Ad){const{appId:o,measurementId:a}=n;try{await BI(i,e)}catch(c){if(a)return ve.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c?.message}]`),{appId:o,measurementId:a};throw c}try{const c=await UI(n);return s.deleteThrottleMetadata(o),c}catch(c){const u=c;if(!jI(u)){if(s.deleteThrottleMetadata(o),a)return ve.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${u?.message}]`),{appId:o,measurementId:a};throw c}const d=Number(u?.customData?.httpStatus)===503?vl(t,s.intervalMillis,MI):vl(t,s.intervalMillis),m={throttleEndTimeMillis:Date.now()+d,backoffCount:t+1};return s.setThrottleMetadata(o,m),ve.debug(`Calling attemptFetch again in ${d} millis`),bd(n,m,i,s)}}function BI(n,e){return new Promise((t,i)=>{const s=Math.max(e-Date.now(),0),o=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(o),i(Se.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function jI(n){if(!(n instanceof Pe)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class WI{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function HI(n,e,t,i,s){if(s&&s.global){n("event",t,i);return}else{const o=await e,a={...i,send_to:o};n("event",t,a)}}async function $I(n,e,t,i){if(i&&i.global){const s={};for(const o of Object.keys(t))s[`user_properties.${o}`]=t[o];return n("set",s),Promise.resolve()}else{const s=await e;n("config",s,{update:!0,user_properties:t})}}async function qI(){if(lh())try{await ch()}catch(n){return ve.warn(Se.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return ve.warn(Se.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function GI(n,e,t,i,s,o,a){const c=VI(n);c.then(v=>{t[v.measurementId]=v.appId,n.options.measurementId&&v.measurementId!==n.options.measurementId&&ve.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${v.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(v=>ve.error(v)),e.push(c);const u=qI().then(v=>{if(v)return i.getId()}),[d,m]=await Promise.all([c,u]);DI(o)||bI(o,d.measurementId),s("js",new Date);const _=a?.config??{};return _[II]="firebase",_.update=!0,m!=null&&(_[wI]=m),s("config",d.measurementId,_),d.measurementId}class zI{constructor(e){this.app=e}_delete(){return delete pn[this.app.options.appId],Promise.resolve()}}let pn={},kc=[];const Nc={};let Ur="dataLayer",KI="gtag",Pc,ua,Oc=!1;function YI(){const n=[];if(oh()&&n.push("This is a browser extension environment."),Pf()||n.push("Cookies are not available."),n.length>0){const e=n.map((i,s)=>`(${s+1}) ${i}`).join(" "),t=Se.create("invalid-analytics-context",{errorInfo:e});ve.warn(t.message)}}function JI(n,e,t){YI();const i=n.options.appId;if(!i)throw Se.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)ve.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Se.create("no-api-key");if(pn[i]!=null)throw Se.create("already-exists",{id:i});if(!Oc){RI(Ur);const{wrappedGtag:o,gtagCore:a}=OI(pn,kc,Nc,Ur,KI);ua=o,Pc=a,Oc=!0}return pn[i]=GI(n,kc,Nc,e,Pc,Ur,t),new zI(n)}function XE(n=vi()){n=ne(n);const e=rt(n,ks);return e.isInitialized()?e.getImmediate():XI(n)}function XI(n,e={}){const t=rt(n,ks);if(t.isInitialized()){const s=t.getImmediate();if(et(e,t.getOptions()))return s;throw Se.create("already-initialized")}return t.initialize({options:e})}function QI(n,e,t){n=ne(n),$I(ua,pn[n.app.options.appId],e,t).catch(i=>ve.error(i))}function ZI(n,e,t,i){n=ne(n),HI(ua,pn[n.app.options.appId],e,t,i).catch(s=>ve.error(s))}const Dc="@firebase/analytics",Mc="0.10.19";function eE(){ke(new Ae(ks,(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return JI(i,s,t)},"PUBLIC")),ke(new Ae("analytics-internal",n,"PRIVATE")),fe(Dc,Mc),fe(Dc,Mc,"esm2020");function n(e){try{const t=e.getProvider(ks).getImmediate();return{logEvent:(i,s,o)=>ZI(t,i,s,o),setUserProperties:(i,s)=>QI(t,i,s)}}catch(t){throw Se.create("interop-component-reg-failed",{reason:t})}}}eE();var Lc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var da;(function(){var n;function e(I,p){function y(){}y.prototype=p.prototype,I.F=p.prototype,I.prototype=new y,I.prototype.constructor=I,I.D=function(E,w,C){for(var g=Array(arguments.length-2),Ie=2;Ie<arguments.length;Ie++)g[Ie-2]=arguments[Ie];return p.prototype[w].apply(E,g)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,p,y){y||(y=0);const E=Array(16);if(typeof p=="string")for(var w=0;w<16;++w)E[w]=p.charCodeAt(y++)|p.charCodeAt(y++)<<8|p.charCodeAt(y++)<<16|p.charCodeAt(y++)<<24;else for(w=0;w<16;++w)E[w]=p[y++]|p[y++]<<8|p[y++]<<16|p[y++]<<24;p=I.g[0],y=I.g[1],w=I.g[2];let C=I.g[3],g;g=p+(C^y&(w^C))+E[0]+3614090360&4294967295,p=y+(g<<7&4294967295|g>>>25),g=C+(w^p&(y^w))+E[1]+3905402710&4294967295,C=p+(g<<12&4294967295|g>>>20),g=w+(y^C&(p^y))+E[2]+606105819&4294967295,w=C+(g<<17&4294967295|g>>>15),g=y+(p^w&(C^p))+E[3]+3250441966&4294967295,y=w+(g<<22&4294967295|g>>>10),g=p+(C^y&(w^C))+E[4]+4118548399&4294967295,p=y+(g<<7&4294967295|g>>>25),g=C+(w^p&(y^w))+E[5]+1200080426&4294967295,C=p+(g<<12&4294967295|g>>>20),g=w+(y^C&(p^y))+E[6]+2821735955&4294967295,w=C+(g<<17&4294967295|g>>>15),g=y+(p^w&(C^p))+E[7]+4249261313&4294967295,y=w+(g<<22&4294967295|g>>>10),g=p+(C^y&(w^C))+E[8]+1770035416&4294967295,p=y+(g<<7&4294967295|g>>>25),g=C+(w^p&(y^w))+E[9]+2336552879&4294967295,C=p+(g<<12&4294967295|g>>>20),g=w+(y^C&(p^y))+E[10]+4294925233&4294967295,w=C+(g<<17&4294967295|g>>>15),g=y+(p^w&(C^p))+E[11]+2304563134&4294967295,y=w+(g<<22&4294967295|g>>>10),g=p+(C^y&(w^C))+E[12]+1804603682&4294967295,p=y+(g<<7&4294967295|g>>>25),g=C+(w^p&(y^w))+E[13]+4254626195&4294967295,C=p+(g<<12&4294967295|g>>>20),g=w+(y^C&(p^y))+E[14]+2792965006&4294967295,w=C+(g<<17&4294967295|g>>>15),g=y+(p^w&(C^p))+E[15]+1236535329&4294967295,y=w+(g<<22&4294967295|g>>>10),g=p+(w^C&(y^w))+E[1]+4129170786&4294967295,p=y+(g<<5&4294967295|g>>>27),g=C+(y^w&(p^y))+E[6]+3225465664&4294967295,C=p+(g<<9&4294967295|g>>>23),g=w+(p^y&(C^p))+E[11]+643717713&4294967295,w=C+(g<<14&4294967295|g>>>18),g=y+(C^p&(w^C))+E[0]+3921069994&4294967295,y=w+(g<<20&4294967295|g>>>12),g=p+(w^C&(y^w))+E[5]+3593408605&4294967295,p=y+(g<<5&4294967295|g>>>27),g=C+(y^w&(p^y))+E[10]+38016083&4294967295,C=p+(g<<9&4294967295|g>>>23),g=w+(p^y&(C^p))+E[15]+3634488961&4294967295,w=C+(g<<14&4294967295|g>>>18),g=y+(C^p&(w^C))+E[4]+3889429448&4294967295,y=w+(g<<20&4294967295|g>>>12),g=p+(w^C&(y^w))+E[9]+568446438&4294967295,p=y+(g<<5&4294967295|g>>>27),g=C+(y^w&(p^y))+E[14]+3275163606&4294967295,C=p+(g<<9&4294967295|g>>>23),g=w+(p^y&(C^p))+E[3]+4107603335&4294967295,w=C+(g<<14&4294967295|g>>>18),g=y+(C^p&(w^C))+E[8]+1163531501&4294967295,y=w+(g<<20&4294967295|g>>>12),g=p+(w^C&(y^w))+E[13]+2850285829&4294967295,p=y+(g<<5&4294967295|g>>>27),g=C+(y^w&(p^y))+E[2]+4243563512&4294967295,C=p+(g<<9&4294967295|g>>>23),g=w+(p^y&(C^p))+E[7]+1735328473&4294967295,w=C+(g<<14&4294967295|g>>>18),g=y+(C^p&(w^C))+E[12]+2368359562&4294967295,y=w+(g<<20&4294967295|g>>>12),g=p+(y^w^C)+E[5]+4294588738&4294967295,p=y+(g<<4&4294967295|g>>>28),g=C+(p^y^w)+E[8]+2272392833&4294967295,C=p+(g<<11&4294967295|g>>>21),g=w+(C^p^y)+E[11]+1839030562&4294967295,w=C+(g<<16&4294967295|g>>>16),g=y+(w^C^p)+E[14]+4259657740&4294967295,y=w+(g<<23&4294967295|g>>>9),g=p+(y^w^C)+E[1]+2763975236&4294967295,p=y+(g<<4&4294967295|g>>>28),g=C+(p^y^w)+E[4]+1272893353&4294967295,C=p+(g<<11&4294967295|g>>>21),g=w+(C^p^y)+E[7]+4139469664&4294967295,w=C+(g<<16&4294967295|g>>>16),g=y+(w^C^p)+E[10]+3200236656&4294967295,y=w+(g<<23&4294967295|g>>>9),g=p+(y^w^C)+E[13]+681279174&4294967295,p=y+(g<<4&4294967295|g>>>28),g=C+(p^y^w)+E[0]+3936430074&4294967295,C=p+(g<<11&4294967295|g>>>21),g=w+(C^p^y)+E[3]+3572445317&4294967295,w=C+(g<<16&4294967295|g>>>16),g=y+(w^C^p)+E[6]+76029189&4294967295,y=w+(g<<23&4294967295|g>>>9),g=p+(y^w^C)+E[9]+3654602809&4294967295,p=y+(g<<4&4294967295|g>>>28),g=C+(p^y^w)+E[12]+3873151461&4294967295,C=p+(g<<11&4294967295|g>>>21),g=w+(C^p^y)+E[15]+530742520&4294967295,w=C+(g<<16&4294967295|g>>>16),g=y+(w^C^p)+E[2]+3299628645&4294967295,y=w+(g<<23&4294967295|g>>>9),g=p+(w^(y|~C))+E[0]+4096336452&4294967295,p=y+(g<<6&4294967295|g>>>26),g=C+(y^(p|~w))+E[7]+1126891415&4294967295,C=p+(g<<10&4294967295|g>>>22),g=w+(p^(C|~y))+E[14]+2878612391&4294967295,w=C+(g<<15&4294967295|g>>>17),g=y+(C^(w|~p))+E[5]+4237533241&4294967295,y=w+(g<<21&4294967295|g>>>11),g=p+(w^(y|~C))+E[12]+1700485571&4294967295,p=y+(g<<6&4294967295|g>>>26),g=C+(y^(p|~w))+E[3]+2399980690&4294967295,C=p+(g<<10&4294967295|g>>>22),g=w+(p^(C|~y))+E[10]+4293915773&4294967295,w=C+(g<<15&4294967295|g>>>17),g=y+(C^(w|~p))+E[1]+2240044497&4294967295,y=w+(g<<21&4294967295|g>>>11),g=p+(w^(y|~C))+E[8]+1873313359&4294967295,p=y+(g<<6&4294967295|g>>>26),g=C+(y^(p|~w))+E[15]+4264355552&4294967295,C=p+(g<<10&4294967295|g>>>22),g=w+(p^(C|~y))+E[6]+2734768916&4294967295,w=C+(g<<15&4294967295|g>>>17),g=y+(C^(w|~p))+E[13]+1309151649&4294967295,y=w+(g<<21&4294967295|g>>>11),g=p+(w^(y|~C))+E[4]+4149444226&4294967295,p=y+(g<<6&4294967295|g>>>26),g=C+(y^(p|~w))+E[11]+3174756917&4294967295,C=p+(g<<10&4294967295|g>>>22),g=w+(p^(C|~y))+E[2]+718787259&4294967295,w=C+(g<<15&4294967295|g>>>17),g=y+(C^(w|~p))+E[9]+3951481745&4294967295,I.g[0]=I.g[0]+p&4294967295,I.g[1]=I.g[1]+(w+(g<<21&4294967295|g>>>11))&4294967295,I.g[2]=I.g[2]+w&4294967295,I.g[3]=I.g[3]+C&4294967295}i.prototype.v=function(I,p){p===void 0&&(p=I.length);const y=p-this.blockSize,E=this.C;let w=this.h,C=0;for(;C<p;){if(w==0)for(;C<=y;)s(this,I,C),C+=this.blockSize;if(typeof I=="string"){for(;C<p;)if(E[w++]=I.charCodeAt(C++),w==this.blockSize){s(this,E),w=0;break}}else for(;C<p;)if(E[w++]=I[C++],w==this.blockSize){s(this,E),w=0;break}}this.h=w,this.o+=p},i.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var p=1;p<I.length-8;++p)I[p]=0;p=this.o*8;for(var y=I.length-8;y<I.length;++y)I[y]=p&255,p/=256;for(this.v(I),I=Array(16),p=0,y=0;y<4;++y)for(let E=0;E<32;E+=8)I[p++]=this.g[y]>>>E&255;return I};function o(I,p){var y=c;return Object.prototype.hasOwnProperty.call(y,I)?y[I]:y[I]=p(I)}function a(I,p){this.h=p;const y=[];let E=!0;for(let w=I.length-1;w>=0;w--){const C=I[w]|0;E&&C==p||(y[w]=C,E=!1)}this.g=y}var c={};function u(I){return-128<=I&&I<128?o(I,function(p){return new a([p|0],p<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return _;if(I<0)return P(d(-I));const p=[];let y=1;for(let E=0;I>=y;E++)p[E]=I/y|0,y*=4294967296;return new a(p,0)}function m(I,p){if(I.length==0)throw Error("number format error: empty string");if(p=p||10,p<2||36<p)throw Error("radix out of range: "+p);if(I.charAt(0)=="-")return P(m(I.substring(1),p));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(p,8));let E=_;for(let C=0;C<I.length;C+=8){var w=Math.min(8,I.length-C);const g=parseInt(I.substring(C,C+w),p);w<8?(w=d(Math.pow(p,w)),E=E.j(w).add(d(g))):(E=E.j(y),E=E.add(d(g)))}return E}var _=u(0),v=u(1),A=u(16777216);n=a.prototype,n.m=function(){if(N(this))return-P(this).m();let I=0,p=1;for(let y=0;y<this.g.length;y++){const E=this.i(y);I+=(E>=0?E:4294967296+E)*p,p*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(R(this))return"0";if(N(this))return"-"+P(this).toString(I);const p=d(Math.pow(I,6));var y=this;let E="";for(;;){const w=X(y,p).g;y=z(y,w.j(p));let C=((y.g.length>0?y.g[0]:y.h)>>>0).toString(I);if(y=w,R(y))return C+E;for(;C.length<6;)C="0"+C;E=C+E}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function R(I){if(I.h!=0)return!1;for(let p=0;p<I.g.length;p++)if(I.g[p]!=0)return!1;return!0}function N(I){return I.h==-1}n.l=function(I){return I=z(this,I),N(I)?-1:R(I)?0:1};function P(I){const p=I.g.length,y=[];for(let E=0;E<p;E++)y[E]=~I.g[E];return new a(y,~I.h).add(v)}n.abs=function(){return N(this)?P(this):this},n.add=function(I){const p=Math.max(this.g.length,I.g.length),y=[];let E=0;for(let w=0;w<=p;w++){let C=E+(this.i(w)&65535)+(I.i(w)&65535),g=(C>>>16)+(this.i(w)>>>16)+(I.i(w)>>>16);E=g>>>16,C&=65535,g&=65535,y[w]=g<<16|C}return new a(y,y[y.length-1]&-2147483648?-1:0)};function z(I,p){return I.add(P(p))}n.j=function(I){if(R(this)||R(I))return _;if(N(this))return N(I)?P(this).j(P(I)):P(P(this).j(I));if(N(I))return P(this.j(P(I)));if(this.l(A)<0&&I.l(A)<0)return d(this.m()*I.m());const p=this.g.length+I.g.length,y=[];for(var E=0;E<2*p;E++)y[E]=0;for(E=0;E<this.g.length;E++)for(let w=0;w<I.g.length;w++){const C=this.i(E)>>>16,g=this.i(E)&65535,Ie=I.i(w)>>>16,Pt=I.i(w)&65535;y[2*E+2*w]+=g*Pt,ee(y,2*E+2*w),y[2*E+2*w+1]+=C*Pt,ee(y,2*E+2*w+1),y[2*E+2*w+1]+=g*Ie,ee(y,2*E+2*w+1),y[2*E+2*w+2]+=C*Ie,ee(y,2*E+2*w+2)}for(I=0;I<p;I++)y[I]=y[2*I+1]<<16|y[2*I];for(I=p;I<2*p;I++)y[I]=0;return new a(y,0)};function ee(I,p){for(;(I[p]&65535)!=I[p];)I[p+1]+=I[p]>>>16,I[p]&=65535,p++}function Y(I,p){this.g=I,this.h=p}function X(I,p){if(R(p))throw Error("division by zero");if(R(I))return new Y(_,_);if(N(I))return p=X(P(I),p),new Y(P(p.g),P(p.h));if(N(p))return p=X(I,P(p)),new Y(P(p.g),p.h);if(I.g.length>30){if(N(I)||N(p))throw Error("slowDivide_ only works with positive integers.");for(var y=v,E=p;E.l(I)<=0;)y=Te(y),E=Te(E);var w=ue(y,1),C=ue(E,1);for(E=ue(E,2),y=ue(y,2);!R(E);){var g=C.add(E);g.l(I)<=0&&(w=w.add(y),C=g),E=ue(E,1),y=ue(y,1)}return p=z(I,w.j(p)),new Y(w,p)}for(w=_;I.l(p)>=0;){for(y=Math.max(1,Math.floor(I.m()/p.m())),E=Math.ceil(Math.log(y)/Math.LN2),E=E<=48?1:Math.pow(2,E-48),C=d(y),g=C.j(p);N(g)||g.l(I)>0;)y-=E,C=d(y),g=C.j(p);R(C)&&(C=v),w=w.add(C),I=z(I,g)}return new Y(w,I)}n.B=function(I){return X(this,I).h},n.and=function(I){const p=Math.max(this.g.length,I.g.length),y=[];for(let E=0;E<p;E++)y[E]=this.i(E)&I.i(E);return new a(y,this.h&I.h)},n.or=function(I){const p=Math.max(this.g.length,I.g.length),y=[];for(let E=0;E<p;E++)y[E]=this.i(E)|I.i(E);return new a(y,this.h|I.h)},n.xor=function(I){const p=Math.max(this.g.length,I.g.length),y=[];for(let E=0;E<p;E++)y[E]=this.i(E)^I.i(E);return new a(y,this.h^I.h)};function Te(I){const p=I.g.length+1,y=[];for(let E=0;E<p;E++)y[E]=I.i(E)<<1|I.i(E-1)>>>31;return new a(y,I.h)}function ue(I,p){const y=p>>5;p%=32;const E=I.g.length-y,w=[];for(let C=0;C<E;C++)w[C]=p>0?I.i(C+y)>>>p|I.i(C+y+1)<<32-p:I.i(C+y);return new a(w,I.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=m,da=a}).apply(typeof Lc<"u"?Lc:typeof self<"u"?self:typeof window<"u"?window:{});var Yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var n,e=Object.defineProperty;function t(r){r=[typeof globalThis=="object"&&globalThis,r,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yi=="object"&&Yi];for(var l=0;l<r.length;++l){var h=r[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var i=t(this);function s(r,l){if(l)e:{var h=i;r=r.split(".");for(var f=0;f<r.length-1;f++){var T=r[f];if(!(T in h))break e;h=h[T]}r=r[r.length-1],f=h[r],l=l(f),l!=f&&l!=null&&e(h,r,{configurable:!0,writable:!0,value:l})}}s("Symbol.dispose",function(r){return r||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(r){return r||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(r){return r||function(l){var h=[],f;for(f in l)Object.prototype.hasOwnProperty.call(l,f)&&h.push([f,l[f]]);return h}});var o=o||{},a=this||self;function c(r){var l=typeof r;return l=="object"&&r!=null||l=="function"}function u(r,l,h){return r.call.apply(r.bind,arguments)}function d(r,l,h){return d=u,d.apply(null,arguments)}function m(r,l){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),r.apply(this,f)}}function _(r,l){function h(){}h.prototype=l.prototype,r.Z=l.prototype,r.prototype=new h,r.prototype.constructor=r,r.Ob=function(f,T,S){for(var k=Array(arguments.length-2),M=2;M<arguments.length;M++)k[M-2]=arguments[M];return l.prototype[T].apply(f,k)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?r=>r&&AsyncContext.Snapshot.wrap(r):r=>r;function A(r){const l=r.length;if(l>0){const h=Array(l);for(let f=0;f<l;f++)h[f]=r[f];return h}return[]}function R(r,l){for(let f=1;f<arguments.length;f++){const T=arguments[f];var h=typeof T;if(h=h!="object"?h:T?Array.isArray(T)?"array":h:"null",h=="array"||h=="object"&&typeof T.length=="number"){h=r.length||0;const S=T.length||0;r.length=h+S;for(let k=0;k<S;k++)r[h+k]=T[k]}else r.push(T)}}class N{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function P(r){a.setTimeout(()=>{throw r},0)}function z(){var r=I;let l=null;return r.g&&(l=r.g,r.g=r.g.next,r.g||(r.h=null),l.next=null),l}class ee{constructor(){this.h=this.g=null}add(l,h){const f=Y.get();f.set(l,h),this.h?this.h.next=f:this.g=f,this.h=f}}var Y=new N(()=>new X,r=>r.reset());class X{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Te,ue=!1,I=new ee,p=()=>{const r=Promise.resolve(void 0);Te=()=>{r.then(y)}};function y(){for(var r;r=z();){try{r.h.call(r.g)}catch(h){P(h)}var l=Y;l.j(r),l.h<100&&(l.h++,r.next=l.g,l.g=r)}ue=!1}function E(){this.u=this.u,this.C=this.C}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function w(r,l){this.type=r,this.g=this.target=l,this.defaultPrevented=!1}w.prototype.h=function(){this.defaultPrevented=!0};var C=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var r=!1,l=Object.defineProperty({},"passive",{get:function(){r=!0}});try{const h=()=>{};a.addEventListener("test",h,l),a.removeEventListener("test",h,l)}catch{}return r})();function g(r){return/^[\s\xa0]*$/.test(r)}function Ie(r,l){w.call(this,r?r.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,r&&this.init(r,l)}_(Ie,w),Ie.prototype.init=function(r,l){const h=this.type=r.type,f=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:null;this.target=r.target||r.srcElement,this.g=l,l=r.relatedTarget,l||(h=="mouseover"?l=r.fromElement:h=="mouseout"&&(l=r.toElement)),this.relatedTarget=l,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0),this.button=r.button,this.key=r.key||"",this.ctrlKey=r.ctrlKey,this.altKey=r.altKey,this.shiftKey=r.shiftKey,this.metaKey=r.metaKey,this.pointerId=r.pointerId||0,this.pointerType=r.pointerType,this.state=r.state,this.i=r,r.defaultPrevented&&Ie.Z.h.call(this)},Ie.prototype.h=function(){Ie.Z.h.call(this);const r=this.i;r.preventDefault?r.preventDefault():r.returnValue=!1};var Pt="closure_listenable_"+(Math.random()*1e6|0),xd=0;function Fd(r,l,h,f,T){this.listener=r,this.proxy=null,this.src=l,this.type=h,this.capture=!!f,this.ha=T,this.key=++xd,this.da=this.fa=!1}function Di(r){r.da=!0,r.listener=null,r.proxy=null,r.src=null,r.ha=null}function Mi(r,l,h){for(const f in r)l.call(h,r[f],f,r)}function Ud(r,l){for(const h in r)l.call(void 0,r[h],h,r)}function ma(r){const l={};for(const h in r)l[h]=r[h];return l}const ya="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function va(r,l){let h,f;for(let T=1;T<arguments.length;T++){f=arguments[T];for(h in f)r[h]=f[h];for(let S=0;S<ya.length;S++)h=ya[S],Object.prototype.hasOwnProperty.call(f,h)&&(r[h]=f[h])}}function Li(r){this.src=r,this.g={},this.h=0}Li.prototype.add=function(r,l,h,f,T){const S=r.toString();r=this.g[S],r||(r=this.g[S]=[],this.h++);const k=Zs(r,l,f,T);return k>-1?(l=r[k],h||(l.fa=!1)):(l=new Fd(l,this.src,S,!!f,T),l.fa=h,r.push(l)),l};function Qs(r,l){const h=l.type;if(h in r.g){var f=r.g[h],T=Array.prototype.indexOf.call(f,l,void 0),S;(S=T>=0)&&Array.prototype.splice.call(f,T,1),S&&(Di(l),r.g[h].length==0&&(delete r.g[h],r.h--))}}function Zs(r,l,h,f){for(let T=0;T<r.length;++T){const S=r[T];if(!S.da&&S.listener==l&&S.capture==!!h&&S.ha==f)return T}return-1}var er="closure_lm_"+(Math.random()*1e6|0),tr={};function wa(r,l,h,f,T){if(Array.isArray(l)){for(let S=0;S<l.length;S++)wa(r,l[S],h,f,T);return null}return h=Ta(h),r&&r[Pt]?r.J(l,h,c(f)?!!f.capture:!1,T):Vd(r,l,h,!1,f,T)}function Vd(r,l,h,f,T,S){if(!l)throw Error("Invalid event type");const k=c(T)?!!T.capture:!!T;let M=ir(r);if(M||(r[er]=M=new Li(r)),h=M.add(l,h,f,k,S),h.proxy)return h;if(f=Bd(),h.proxy=f,f.src=r,f.listener=h,r.addEventListener)C||(T=k),T===void 0&&(T=!1),r.addEventListener(l.toString(),f,T);else if(r.attachEvent)r.attachEvent(Ea(l.toString()),f);else if(r.addListener&&r.removeListener)r.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Bd(){function r(h){return l.call(r.src,r.listener,h)}const l=jd;return r}function Ia(r,l,h,f,T){if(Array.isArray(l))for(var S=0;S<l.length;S++)Ia(r,l[S],h,f,T);else f=c(f)?!!f.capture:!!f,h=Ta(h),r&&r[Pt]?(r=r.i,S=String(l).toString(),S in r.g&&(l=r.g[S],h=Zs(l,h,f,T),h>-1&&(Di(l[h]),Array.prototype.splice.call(l,h,1),l.length==0&&(delete r.g[S],r.h--)))):r&&(r=ir(r))&&(l=r.g[l.toString()],r=-1,l&&(r=Zs(l,h,f,T)),(h=r>-1?l[r]:null)&&nr(h))}function nr(r){if(typeof r!="number"&&r&&!r.da){var l=r.src;if(l&&l[Pt])Qs(l.i,r);else{var h=r.type,f=r.proxy;l.removeEventListener?l.removeEventListener(h,f,r.capture):l.detachEvent?l.detachEvent(Ea(h),f):l.addListener&&l.removeListener&&l.removeListener(f),(h=ir(l))?(Qs(h,r),h.h==0&&(h.src=null,l[er]=null)):Di(r)}}}function Ea(r){return r in tr?tr[r]:tr[r]="on"+r}function jd(r,l){if(r.da)r=!0;else{l=new Ie(l,this);const h=r.listener,f=r.ha||r.src;r.fa&&nr(r),r=h.call(f,l)}return r}function ir(r){return r=r[er],r instanceof Li?r:null}var sr="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ta(r){return typeof r=="function"?r:(r[sr]||(r[sr]=function(l){return r.handleEvent(l)}),r[sr])}function de(){E.call(this),this.i=new Li(this),this.M=this,this.G=null}_(de,E),de.prototype[Pt]=!0,de.prototype.removeEventListener=function(r,l,h,f){Ia(this,r,l,h,f)};function pe(r,l){var h,f=r.G;if(f)for(h=[];f;f=f.G)h.push(f);if(r=r.M,f=l.type||l,typeof l=="string")l=new w(l,r);else if(l instanceof w)l.target=l.target||r;else{var T=l;l=new w(f,r),va(l,T)}T=!0;let S,k;if(h)for(k=h.length-1;k>=0;k--)S=l.g=h[k],T=xi(S,f,!0,l)&&T;if(S=l.g=r,T=xi(S,f,!0,l)&&T,T=xi(S,f,!1,l)&&T,h)for(k=0;k<h.length;k++)S=l.g=h[k],T=xi(S,f,!1,l)&&T}de.prototype.N=function(){if(de.Z.N.call(this),this.i){var r=this.i;for(const l in r.g){const h=r.g[l];for(let f=0;f<h.length;f++)Di(h[f]);delete r.g[l],r.h--}}this.G=null},de.prototype.J=function(r,l,h,f){return this.i.add(String(r),l,!1,h,f)},de.prototype.K=function(r,l,h,f){return this.i.add(String(r),l,!0,h,f)};function xi(r,l,h,f){if(l=r.i.g[String(l)],!l)return!0;l=l.concat();let T=!0;for(let S=0;S<l.length;++S){const k=l[S];if(k&&!k.da&&k.capture==h){const M=k.listener,ie=k.ha||k.src;k.fa&&Qs(r.i,k),T=M.call(ie,f)!==!1&&T}}return T&&!f.defaultPrevented}function Wd(r,l){if(typeof r!="function")if(r&&typeof r.handleEvent=="function")r=d(r.handleEvent,r);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(r,l||0)}function Ca(r){r.g=Wd(()=>{r.g=null,r.i&&(r.i=!1,Ca(r))},r.l);const l=r.h;r.h=null,r.m.apply(null,l)}class Hd extends E{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Ca(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kn(r){E.call(this),this.h=r,this.g={}}_(kn,E);var Sa=[];function Aa(r){Mi(r.g,function(l,h){this.g.hasOwnProperty(h)&&nr(l)},r),r.g={}}kn.prototype.N=function(){kn.Z.N.call(this),Aa(this)},kn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rr=a.JSON.stringify,$d=a.JSON.parse,qd=class{stringify(r){return a.JSON.stringify(r,void 0)}parse(r){return a.JSON.parse(r,void 0)}};function ba(){}function Gd(){}var Nn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function or(){w.call(this,"d")}_(or,w);function ar(){w.call(this,"c")}_(ar,w);var nn={},Ra=null;function lr(){return Ra=Ra||new de}nn.Ia="serverreachability";function ka(r){w.call(this,nn.Ia,r)}_(ka,w);function Pn(r){const l=lr();pe(l,new ka(l))}nn.STAT_EVENT="statevent";function Na(r,l){w.call(this,nn.STAT_EVENT,r),this.stat=l}_(Na,w);function ge(r){const l=lr();pe(l,new Na(l,r))}nn.Ja="timingevent";function Pa(r,l){w.call(this,nn.Ja,r),this.size=l}_(Pa,w);function On(r,l){if(typeof r!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){r()},l)}function Dn(){this.g=!0}Dn.prototype.ua=function(){this.g=!1};function zd(r,l,h,f,T,S){r.info(function(){if(r.g)if(S){var k="",M=S.split("&");for(let $=0;$<M.length;$++){var ie=M[$].split("=");if(ie.length>1){const oe=ie[0];ie=ie[1];const Be=oe.split("_");k=Be.length>=2&&Be[1]=="type"?k+(oe+"="+ie+"&"):k+(oe+"=redacted&")}}}else k=null;else k=S;return"XMLHTTP REQ ("+f+") [attempt "+T+"]: "+l+`
`+h+`
`+k})}function Kd(r,l,h,f,T,S,k){r.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+T+"]: "+l+`
`+h+`
`+S+" "+k})}function sn(r,l,h,f){r.info(function(){return"XMLHTTP TEXT ("+l+"): "+Jd(r,h)+(f?" "+f:"")})}function Yd(r,l){r.info(function(){return"TIMEOUT: "+l})}Dn.prototype.info=function(){};function Jd(r,l){if(!r.g)return l;if(!l)return null;try{const S=JSON.parse(l);if(S){for(r=0;r<S.length;r++)if(Array.isArray(S[r])){var h=S[r];if(!(h.length<2)){var f=h[1];if(Array.isArray(f)&&!(f.length<1)){var T=f[0];if(T!="noop"&&T!="stop"&&T!="close")for(let k=1;k<f.length;k++)f[k]=""}}}}return rr(S)}catch{return l}}var cr={NO_ERROR:0,TIMEOUT:8},Xd={},Oa;function hr(){}_(hr,ba),hr.prototype.g=function(){return new XMLHttpRequest},Oa=new hr;function Mn(r){return encodeURIComponent(String(r))}function Qd(r){var l=1;r=r.split(":");const h=[];for(;l>0&&r.length;)h.push(r.shift()),l--;return r.length&&h.push(r.join(":")),h}function at(r,l,h,f){this.j=r,this.i=l,this.l=h,this.S=f||1,this.V=new kn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Da}function Da(){this.i=null,this.g="",this.h=!1}var Ma={},ur={};function dr(r,l,h){r.M=1,r.A=Ui(Ve(l)),r.u=h,r.R=!0,La(r,null)}function La(r,l){r.F=Date.now(),Fi(r),r.B=Ve(r.A);var h=r.B,f=r.S;Array.isArray(f)||(f=[String(f)]),Ka(h.i,"t",f),r.C=0,h=r.j.L,r.h=new Da,r.g=dl(r.j,h?l:null,!r.u),r.P>0&&(r.O=new Hd(d(r.Y,r,r.g),r.P)),l=r.V,h=r.g,f=r.ba;var T="readystatechange";Array.isArray(T)||(T&&(Sa[0]=T.toString()),T=Sa);for(let S=0;S<T.length;S++){const k=wa(h,T[S],f||l.handleEvent,!1,l.h||l);if(!k)break;l.g[k.key]=k}l=r.J?ma(r.J):{},r.u?(r.v||(r.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",r.g.ea(r.B,r.v,r.u,l)):(r.v="GET",r.g.ea(r.B,r.v,null,l)),Pn(),zd(r.i,r.v,r.B,r.l,r.S,r.u)}at.prototype.ba=function(r){r=r.target;const l=this.O;l&&ht(r)==3?l.j():this.Y(r)},at.prototype.Y=function(r){try{if(r==this.g)e:{const M=ht(this.g),ie=this.g.ya(),$=this.g.ca();if(!(M<3)&&(M!=3||this.g&&(this.h.h||this.g.la()||tl(this.g)))){this.K||M!=4||ie==7||(ie==8||$<=0?Pn(3):Pn(2)),fr(this);var l=this.g.ca();this.X=l;var h=Zd(this);if(this.o=l==200,Kd(this.i,this.v,this.B,this.l,this.S,M,l),this.o){if(this.U&&!this.L){t:{if(this.g){var f,T=this.g;if((f=T.g?T.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break t}}S=null}if(r=S)sn(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,pr(this,r);else{this.o=!1,this.m=3,ge(12),Ot(this),Ln(this);break e}}if(this.R){r=!0;let oe;for(;!this.K&&this.C<h.length;)if(oe=ef(this,h),oe==ur){M==4&&(this.m=4,ge(14),r=!1),sn(this.i,this.l,null,"[Incomplete Response]");break}else if(oe==Ma){this.m=4,ge(15),sn(this.i,this.l,h,"[Invalid Chunk]"),r=!1;break}else sn(this.i,this.l,oe,null),pr(this,oe);if(xa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),M!=4||h.length!=0||this.h.h||(this.m=1,ge(16),r=!1),this.o=this.o&&r,!r)sn(this.i,this.l,h,"[Invalid Chunked Response]"),Ot(this),Ln(this);else if(h.length>0&&!this.W){this.W=!0;var k=this.j;k.g==this&&k.aa&&!k.P&&(k.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),Er(k),k.P=!0,ge(11))}}else sn(this.i,this.l,h,null),pr(this,h);M==4&&Ot(this),this.o&&!this.K&&(M==4?ll(this.j,this):(this.o=!1,Fi(this)))}else gf(this.g),l==400&&h.indexOf("Unknown SID")>0?(this.m=3,ge(12)):(this.m=0,ge(13)),Ot(this),Ln(this)}}}catch{}finally{}};function Zd(r){if(!xa(r))return r.g.la();const l=tl(r.g);if(l==="")return"";let h="";const f=l.length,T=ht(r.g)==4;if(!r.h.i){if(typeof TextDecoder>"u")return Ot(r),Ln(r),"";r.h.i=new a.TextDecoder}for(let S=0;S<f;S++)r.h.h=!0,h+=r.h.i.decode(l[S],{stream:!(T&&S==f-1)});return l.length=0,r.h.g+=h,r.C=0,r.h.g}function xa(r){return r.g?r.v=="GET"&&r.M!=2&&r.j.Aa:!1}function ef(r,l){var h=r.C,f=l.indexOf(`
`,h);return f==-1?ur:(h=Number(l.substring(h,f)),isNaN(h)?Ma:(f+=1,f+h>l.length?ur:(l=l.slice(f,f+h),r.C=f+h,l)))}at.prototype.cancel=function(){this.K=!0,Ot(this)};function Fi(r){r.T=Date.now()+r.H,Fa(r,r.H)}function Fa(r,l){if(r.D!=null)throw Error("WatchDog timer not null");r.D=On(d(r.aa,r),l)}function fr(r){r.D&&(a.clearTimeout(r.D),r.D=null)}at.prototype.aa=function(){this.D=null;const r=Date.now();r-this.T>=0?(Yd(this.i,this.B),this.M!=2&&(Pn(),ge(17)),Ot(this),this.m=2,Ln(this)):Fa(this,this.T-r)};function Ln(r){r.j.I==0||r.K||ll(r.j,r)}function Ot(r){fr(r);var l=r.O;l&&typeof l.dispose=="function"&&l.dispose(),r.O=null,Aa(r.V),r.g&&(l=r.g,r.g=null,l.abort(),l.dispose())}function pr(r,l){try{var h=r.j;if(h.I!=0&&(h.g==r||gr(h.h,r))){if(!r.L&&gr(h.h,r)&&h.I==3){try{var f=h.Ba.g.parse(l)}catch{f=null}if(Array.isArray(f)&&f.length==3){var T=f;if(T[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<r.F)Hi(h),ji(h);else break e;Ir(h),ge(18)}}else h.xa=T[1],0<h.xa-h.K&&T[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=On(d(h.Va,h),6e3));Ba(h.h)<=1&&h.ta&&(h.ta=void 0)}else Mt(h,11)}else if((r.L||h.g==r)&&Hi(h),!g(l))for(T=h.Ba.g.parse(l),l=0;l<T.length;l++){let $=T[l];const oe=$[0];if(!(oe<=h.K))if(h.K=oe,$=$[1],h.I==2)if($[0]=="c"){h.M=$[1],h.ba=$[2];const Be=$[3];Be!=null&&(h.ka=Be,h.j.info("VER="+h.ka));const Lt=$[4];Lt!=null&&(h.za=Lt,h.j.info("SVER="+h.za));const ut=$[5];ut!=null&&typeof ut=="number"&&ut>0&&(f=1.5*ut,h.O=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;const dt=r.g;if(dt){const $i=dt.g?dt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($i){var S=f.h;S.g||$i.indexOf("spdy")==-1&&$i.indexOf("quic")==-1&&$i.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(_r(S,S.h),S.h=null))}if(f.G){const Tr=dt.g?dt.g.getResponseHeader("X-HTTP-Session-Id"):null;Tr&&(f.wa=Tr,K(f.J,f.G,Tr))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-r.F,h.j.info("Handshake RTT: "+h.T+"ms")),f=h;var k=r;if(f.na=ul(f,f.L?f.ba:null,f.W),k.L){ja(f.h,k);var M=k,ie=f.O;ie&&(M.H=ie),M.D&&(fr(M),Fi(M)),f.g=k}else ol(f);h.i.length>0&&Wi(h)}else $[0]!="stop"&&$[0]!="close"||Mt(h,7);else h.I==3&&($[0]=="stop"||$[0]=="close"?$[0]=="stop"?Mt(h,7):wr(h):$[0]!="noop"&&h.l&&h.l.qa($),h.A=0)}}Pn(4)}catch{}}var tf=class{constructor(r,l){this.g=r,this.map=l}};function Ua(r){this.l=r||10,a.PerformanceNavigationTiming?(r=a.performance.getEntriesByType("navigation"),r=r.length>0&&(r[0].nextHopProtocol=="hq"||r[0].nextHopProtocol=="h2")):r=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=r?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Va(r){return r.h?!0:r.g?r.g.size>=r.j:!1}function Ba(r){return r.h?1:r.g?r.g.size:0}function gr(r,l){return r.h?r.h==l:r.g?r.g.has(l):!1}function _r(r,l){r.g?r.g.add(l):r.h=l}function ja(r,l){r.h&&r.h==l?r.h=null:r.g&&r.g.has(l)&&r.g.delete(l)}Ua.prototype.cancel=function(){if(this.i=Wa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const r of this.g.values())r.cancel();this.g.clear()}};function Wa(r){if(r.h!=null)return r.i.concat(r.h.G);if(r.g!=null&&r.g.size!==0){let l=r.i;for(const h of r.g.values())l=l.concat(h.G);return l}return A(r.i)}var Ha=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function nf(r,l){if(r){r=r.split("&");for(let h=0;h<r.length;h++){const f=r[h].indexOf("=");let T,S=null;f>=0?(T=r[h].substring(0,f),S=r[h].substring(f+1)):T=r[h],l(T,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function lt(r){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;r instanceof lt?(this.l=r.l,xn(this,r.j),this.o=r.o,this.g=r.g,Fn(this,r.u),this.h=r.h,mr(this,Ya(r.i)),this.m=r.m):r&&(l=String(r).match(Ha))?(this.l=!1,xn(this,l[1]||"",!0),this.o=Un(l[2]||""),this.g=Un(l[3]||"",!0),Fn(this,l[4]),this.h=Un(l[5]||"",!0),mr(this,l[6]||"",!0),this.m=Un(l[7]||"")):(this.l=!1,this.i=new Bn(null,this.l))}lt.prototype.toString=function(){const r=[];var l=this.j;l&&r.push(Vn(l,$a,!0),":");var h=this.g;return(h||l=="file")&&(r.push("//"),(l=this.o)&&r.push(Vn(l,$a,!0),"@"),r.push(Mn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&r.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&r.push("/"),r.push(Vn(h,h.charAt(0)=="/"?of:rf,!0))),(h=this.i.toString())&&r.push("?",h),(h=this.m)&&r.push("#",Vn(h,lf)),r.join("")},lt.prototype.resolve=function(r){const l=Ve(this);let h=!!r.j;h?xn(l,r.j):h=!!r.o,h?l.o=r.o:h=!!r.g,h?l.g=r.g:h=r.u!=null;var f=r.h;if(h)Fn(l,r.u);else if(h=!!r.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var T=l.h.lastIndexOf("/");T!=-1&&(f=l.h.slice(0,T+1)+f)}if(T=f,T==".."||T==".")f="";else if(T.indexOf("./")!=-1||T.indexOf("/.")!=-1){f=T.lastIndexOf("/",0)==0,T=T.split("/");const S=[];for(let k=0;k<T.length;){const M=T[k++];M=="."?f&&k==T.length&&S.push(""):M==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&k==T.length&&S.push("")):(S.push(M),f=!0)}f=S.join("/")}else f=T}return h?l.h=f:h=r.i.toString()!=="",h?mr(l,Ya(r.i)):h=!!r.m,h&&(l.m=r.m),l};function Ve(r){return new lt(r)}function xn(r,l,h){r.j=h?Un(l,!0):l,r.j&&(r.j=r.j.replace(/:$/,""))}function Fn(r,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);r.u=l}else r.u=null}function mr(r,l,h){l instanceof Bn?(r.i=l,cf(r.i,r.l)):(h||(l=Vn(l,af)),r.i=new Bn(l,r.l))}function K(r,l,h){r.i.set(l,h)}function Ui(r){return K(r,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),r}function Un(r,l){return r?l?decodeURI(r.replace(/%25/g,"%2525")):decodeURIComponent(r):""}function Vn(r,l,h){return typeof r=="string"?(r=encodeURI(r).replace(l,sf),h&&(r=r.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),r):null}function sf(r){return r=r.charCodeAt(0),"%"+(r>>4&15).toString(16)+(r&15).toString(16)}var $a=/[#\/\?@]/g,rf=/[#\?:]/g,of=/[#\?]/g,af=/[#\?@]/g,lf=/#/g;function Bn(r,l){this.h=this.g=null,this.i=r||null,this.j=!!l}function Dt(r){r.g||(r.g=new Map,r.h=0,r.i&&nf(r.i,function(l,h){r.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}n=Bn.prototype,n.add=function(r,l){Dt(this),this.i=null,r=rn(this,r);let h=this.g.get(r);return h||this.g.set(r,h=[]),h.push(l),this.h+=1,this};function qa(r,l){Dt(r),l=rn(r,l),r.g.has(l)&&(r.i=null,r.h-=r.g.get(l).length,r.g.delete(l))}function Ga(r,l){return Dt(r),l=rn(r,l),r.g.has(l)}n.forEach=function(r,l){Dt(this),this.g.forEach(function(h,f){h.forEach(function(T){r.call(l,T,f,this)},this)},this)};function za(r,l){Dt(r);let h=[];if(typeof l=="string")Ga(r,l)&&(h=h.concat(r.g.get(rn(r,l))));else for(r=Array.from(r.g.values()),l=0;l<r.length;l++)h=h.concat(r[l]);return h}n.set=function(r,l){return Dt(this),this.i=null,r=rn(this,r),Ga(this,r)&&(this.h-=this.g.get(r).length),this.g.set(r,[l]),this.h+=1,this},n.get=function(r,l){return r?(r=za(this,r),r.length>0?String(r[0]):l):l};function Ka(r,l,h){qa(r,l),h.length>0&&(r.i=null,r.g.set(rn(r,l),A(h)),r.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const r=[],l=Array.from(this.g.keys());for(let f=0;f<l.length;f++){var h=l[f];const T=Mn(h);h=za(this,h);for(let S=0;S<h.length;S++){let k=T;h[S]!==""&&(k+="="+Mn(h[S])),r.push(k)}}return this.i=r.join("&")};function Ya(r){const l=new Bn;return l.i=r.i,r.g&&(l.g=new Map(r.g),l.h=r.h),l}function rn(r,l){return l=String(l),r.j&&(l=l.toLowerCase()),l}function cf(r,l){l&&!r.j&&(Dt(r),r.i=null,r.g.forEach(function(h,f){const T=f.toLowerCase();f!=T&&(qa(this,f),Ka(this,T,h))},r)),r.j=l}function hf(r,l){const h=new Dn;if(a.Image){const f=new Image;f.onload=m(ct,h,"TestLoadImage: loaded",!0,l,f),f.onerror=m(ct,h,"TestLoadImage: error",!1,l,f),f.onabort=m(ct,h,"TestLoadImage: abort",!1,l,f),f.ontimeout=m(ct,h,"TestLoadImage: timeout",!1,l,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=r}else l(!1)}function uf(r,l){const h=new Dn,f=new AbortController,T=setTimeout(()=>{f.abort(),ct(h,"TestPingServer: timeout",!1,l)},1e4);fetch(r,{signal:f.signal}).then(S=>{clearTimeout(T),S.ok?ct(h,"TestPingServer: ok",!0,l):ct(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(T),ct(h,"TestPingServer: error",!1,l)})}function ct(r,l,h,f,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),f(h)}catch{}}function df(){this.g=new qd}function yr(r){this.i=r.Sb||null,this.h=r.ab||!1}_(yr,ba),yr.prototype.g=function(){return new Vi(this.i,this.h)};function Vi(r,l){de.call(this),this.H=r,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(Vi,de),n=Vi.prototype,n.open=function(r,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=r,this.D=l,this.readyState=1,Wn(this)},n.send=function(r){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};r&&(l.body=r),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,jn(this)),this.readyState=0},n.Pa=function(r){if(this.g&&(this.l=r,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=r.headers,this.readyState=2,Wn(this)),this.g&&(this.readyState=3,Wn(this),this.g)))if(this.responseType==="arraybuffer")r.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in r){if(this.j=r.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ja(this)}else r.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ja(r){r.j.read().then(r.Ma.bind(r)).catch(r.ga.bind(r))}n.Ma=function(r){if(this.g){if(this.o&&r.value)this.response.push(r.value);else if(!this.o){var l=r.value?r.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!r.done}))&&(this.response=this.responseText+=l)}r.done?jn(this):Wn(this),this.readyState==3&&Ja(this)}},n.Oa=function(r){this.g&&(this.response=this.responseText=r,jn(this))},n.Na=function(r){this.g&&(this.response=r,jn(this))},n.ga=function(){this.g&&jn(this)};function jn(r){r.readyState=4,r.l=null,r.j=null,r.B=null,Wn(r)}n.setRequestHeader=function(r,l){this.A.append(r,l)},n.getResponseHeader=function(r){return this.h&&this.h.get(r.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const r=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,r.push(h[0]+": "+h[1]),h=l.next();return r.join(`\r
`)};function Wn(r){r.onreadystatechange&&r.onreadystatechange.call(r)}Object.defineProperty(Vi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(r){this.m=r?"include":"same-origin"}});function Xa(r){let l="";return Mi(r,function(h,f){l+=f,l+=":",l+=h,l+=`\r
`}),l}function vr(r,l,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=Xa(h),typeof r=="string"?h!=null&&Mn(h):K(r,l,h))}function Z(r){de.call(this),this.headers=new Map,this.L=r||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(Z,de);var ff=/^https?$/i,pf=["POST","PUT"];n=Z.prototype,n.Fa=function(r){this.H=r},n.ea=function(r,l,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+r);l=l?l.toUpperCase():"GET",this.D=r,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Oa.g(),this.g.onreadystatechange=v(d(this.Ca,this));try{this.B=!0,this.g.open(l,String(r),!0),this.B=!1}catch(S){Qa(this,S);return}if(r=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var T in f)h.set(T,f[T]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())h.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(S=>S.toLowerCase()=="content-type"),T=a.FormData&&r instanceof a.FormData,!(Array.prototype.indexOf.call(pf,l,void 0)>=0)||f||T||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,k]of h)this.g.setRequestHeader(S,k);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(r),this.v=!1}catch(S){Qa(this,S)}};function Qa(r,l){r.h=!1,r.g&&(r.j=!0,r.g.abort(),r.j=!1),r.l=l,r.o=5,Za(r),Bi(r)}function Za(r){r.A||(r.A=!0,pe(r,"complete"),pe(r,"error"))}n.abort=function(r){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=r||7,pe(this,"complete"),pe(this,"abort"),Bi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Bi(this,!0)),Z.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?el(this):this.Xa())},n.Xa=function(){el(this)};function el(r){if(r.h&&typeof o<"u"){if(r.v&&ht(r)==4)setTimeout(r.Ca.bind(r),0);else if(pe(r,"readystatechange"),ht(r)==4){r.h=!1;try{const S=r.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var f;if(f=S===0){let k=String(r.D).match(Ha)[1]||null;!k&&a.self&&a.self.location&&(k=a.self.location.protocol.slice(0,-1)),f=!ff.test(k?k.toLowerCase():"")}h=f}if(h)pe(r,"complete"),pe(r,"success");else{r.o=6;try{var T=ht(r)>2?r.g.statusText:""}catch{T=""}r.l=T+" ["+r.ca()+"]",Za(r)}}finally{Bi(r)}}}}function Bi(r,l){if(r.g){r.m&&(clearTimeout(r.m),r.m=null);const h=r.g;r.g=null,l||pe(r,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ht(r){return r.g?r.g.readyState:0}n.ca=function(){try{return ht(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(r){if(this.g){var l=this.g.responseText;return r&&l.indexOf(r)==0&&(l=l.substring(r.length)),$d(l)}};function tl(r){try{if(!r.g)return null;if("response"in r.g)return r.g.response;switch(r.F){case"":case"text":return r.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in r.g)return r.g.mozResponseArrayBuffer}return null}catch{return null}}function gf(r){const l={};r=(r.g&&ht(r)>=2&&r.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<r.length;f++){if(g(r[f]))continue;var h=Qd(r[f]);const T=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const S=l[T]||[];l[T]=S,S.push(h)}Ud(l,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Hn(r,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[r]||l}function nl(r){this.za=0,this.i=[],this.j=new Dn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Hn("failFast",!1,r),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Hn("baseRetryDelayMs",5e3,r),this.Za=Hn("retryDelaySeedMs",1e4,r),this.Ta=Hn("forwardChannelMaxRetries",2,r),this.va=Hn("forwardChannelRequestTimeoutMs",2e4,r),this.ma=r&&r.xmlHttpFactory||void 0,this.Ua=r&&r.Rb||void 0,this.Aa=r&&r.useFetchStreams||!1,this.O=void 0,this.L=r&&r.supportsCrossDomainXhr||!1,this.M="",this.h=new Ua(r&&r.concurrentRequestLimit),this.Ba=new df,this.S=r&&r.fastHandshake||!1,this.R=r&&r.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=r&&r.Pb||!1,r&&r.ua&&this.j.ua(),r&&r.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&r&&r.detectBufferingProxy||!1,this.ia=void 0,r&&r.longPollingTimeout&&r.longPollingTimeout>0&&(this.ia=r.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=nl.prototype,n.ka=8,n.I=1,n.connect=function(r,l,h,f){ge(0),this.W=r,this.H=l||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.J=ul(this,null,this.W),Wi(this)};function wr(r){if(il(r),r.I==3){var l=r.V++,h=Ve(r.J);if(K(h,"SID",r.M),K(h,"RID",l),K(h,"TYPE","terminate"),$n(r,h),l=new at(r,r.j,l),l.M=2,l.A=Ui(Ve(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=l.A,h=!0),h||(l.g=dl(l.j,null),l.g.ea(l.A)),l.F=Date.now(),Fi(l)}hl(r)}function ji(r){r.g&&(Er(r),r.g.cancel(),r.g=null)}function il(r){ji(r),r.v&&(a.clearTimeout(r.v),r.v=null),Hi(r),r.h.cancel(),r.m&&(typeof r.m=="number"&&a.clearTimeout(r.m),r.m=null)}function Wi(r){if(!Va(r.h)&&!r.m){r.m=!0;var l=r.Ea;Te||p(),ue||(Te(),ue=!0),I.add(l,r),r.D=0}}function _f(r,l){return Ba(r.h)>=r.h.j-(r.m?1:0)?!1:r.m?(r.i=l.G.concat(r.i),!0):r.I==1||r.I==2||r.D>=(r.Sa?0:r.Ta)?!1:(r.m=On(d(r.Ea,r,l),cl(r,r.D)),r.D++,!0)}n.Ea=function(r){if(this.m)if(this.m=null,this.I==1){if(!r){this.V=Math.floor(Math.random()*1e5),r=this.V++;const T=new at(this,this.j,r);let S=this.o;if(this.U&&(S?(S=ma(S),va(S,this.U)):S=this.U),this.u!==null||this.R||(T.J=S,S=null),this.S)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(l+=f,l>4096){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=rl(this,T,l),h=Ve(this.J),K(h,"RID",r),K(h,"CVER",22),this.G&&K(h,"X-HTTP-Session-Id",this.G),$n(this,h),S&&(this.R?l="headers="+Mn(Xa(S))+"&"+l:this.u&&vr(h,this.u,S)),_r(this.h,T),this.Ra&&K(h,"TYPE","init"),this.S?(K(h,"$req",l),K(h,"SID","null"),T.U=!0,dr(T,h,null)):dr(T,h,l),this.I=2}}else this.I==3&&(r?sl(this,r):this.i.length==0||Va(this.h)||sl(this))};function sl(r,l){var h;l?h=l.l:h=r.V++;const f=Ve(r.J);K(f,"SID",r.M),K(f,"RID",h),K(f,"AID",r.K),$n(r,f),r.u&&r.o&&vr(f,r.u,r.o),h=new at(r,r.j,h,r.D+1),r.u===null&&(h.J=r.o),l&&(r.i=l.G.concat(r.i)),l=rl(r,h,1e3),h.H=Math.round(r.va*.5)+Math.round(r.va*.5*Math.random()),_r(r.h,h),dr(h,f,l)}function $n(r,l){r.H&&Mi(r.H,function(h,f){K(l,f,h)}),r.l&&Mi({},function(h,f){K(l,f,h)})}function rl(r,l,h){h=Math.min(r.i.length,h);const f=r.l?d(r.l.Ka,r.l,r):null;e:{var T=r.i;let M=-1;for(;;){const ie=["count="+h];M==-1?h>0?(M=T[0].g,ie.push("ofs="+M)):M=0:ie.push("ofs="+M);let $=!0;for(let oe=0;oe<h;oe++){var S=T[oe].g;const Be=T[oe].map;if(S-=M,S<0)M=Math.max(0,T[oe].g-100),$=!1;else try{S="req"+S+"_"||"";try{var k=Be instanceof Map?Be:Object.entries(Be);for(const[Lt,ut]of k){let dt=ut;c(ut)&&(dt=rr(ut)),ie.push(S+Lt+"="+encodeURIComponent(dt))}}catch(Lt){throw ie.push(S+"type="+encodeURIComponent("_badmap")),Lt}}catch{f&&f(Be)}}if($){k=ie.join("&");break e}}k=void 0}return r=r.i.splice(0,h),l.G=r,k}function ol(r){if(!r.g&&!r.v){r.Y=1;var l=r.Da;Te||p(),ue||(Te(),ue=!0),I.add(l,r),r.A=0}}function Ir(r){return r.g||r.v||r.A>=3?!1:(r.Y++,r.v=On(d(r.Da,r),cl(r,r.A)),r.A++,!0)}n.Da=function(){if(this.v=null,al(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var r=4*this.T;this.j.info("BP detection timer enabled: "+r),this.B=On(d(this.Wa,this),r)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ge(10),ji(this),al(this))};function Er(r){r.B!=null&&(a.clearTimeout(r.B),r.B=null)}function al(r){r.g=new at(r,r.j,"rpc",r.Y),r.u===null&&(r.g.J=r.o),r.g.P=0;var l=Ve(r.na);K(l,"RID","rpc"),K(l,"SID",r.M),K(l,"AID",r.K),K(l,"CI",r.F?"0":"1"),!r.F&&r.ia&&K(l,"TO",r.ia),K(l,"TYPE","xmlhttp"),$n(r,l),r.u&&r.o&&vr(l,r.u,r.o),r.O&&(r.g.H=r.O);var h=r.g;r=r.ba,h.M=1,h.A=Ui(Ve(l)),h.u=null,h.R=!0,La(h,r)}n.Va=function(){this.C!=null&&(this.C=null,ji(this),Ir(this),ge(19))};function Hi(r){r.C!=null&&(a.clearTimeout(r.C),r.C=null)}function ll(r,l){var h=null;if(r.g==l){Hi(r),Er(r),r.g=null;var f=2}else if(gr(r.h,l))h=l.G,ja(r.h,l),f=1;else return;if(r.I!=0){if(l.o)if(f==1){h=l.u?l.u.length:0,l=Date.now()-l.F;var T=r.D;f=lr(),pe(f,new Pa(f,h)),Wi(r)}else ol(r);else if(T=l.m,T==3||T==0&&l.X>0||!(f==1&&_f(r,l)||f==2&&Ir(r)))switch(h&&h.length>0&&(l=r.h,l.i=l.i.concat(h)),T){case 1:Mt(r,5);break;case 4:Mt(r,10);break;case 3:Mt(r,6);break;default:Mt(r,2)}}}function cl(r,l){let h=r.Qa+Math.floor(Math.random()*r.Za);return r.isActive()||(h*=2),h*l}function Mt(r,l){if(r.j.info("Error code "+l),l==2){var h=d(r.bb,r),f=r.Ua;const T=!f;f=new lt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||xn(f,"https"),Ui(f),T?hf(f.toString(),h):uf(f.toString(),h)}else ge(2);r.I=0,r.l&&r.l.pa(l),hl(r),il(r)}n.bb=function(r){r?(this.j.info("Successfully pinged google.com"),ge(2)):(this.j.info("Failed to ping google.com"),ge(1))};function hl(r){if(r.I=0,r.ja=[],r.l){const l=Wa(r.h);(l.length!=0||r.i.length!=0)&&(R(r.ja,l),R(r.ja,r.i),r.h.i.length=0,A(r.i),r.i.length=0),r.l.oa()}}function ul(r,l,h){var f=h instanceof lt?Ve(h):new lt(h);if(f.g!="")l&&(f.g=l+"."+f.g),Fn(f,f.u);else{var T=a.location;f=T.protocol,l=l?l+"."+T.hostname:T.hostname,T=+T.port;const S=new lt(null);f&&xn(S,f),l&&(S.g=l),T&&Fn(S,T),h&&(S.h=h),f=S}return h=r.G,l=r.wa,h&&l&&K(f,h,l),K(f,"VER",r.ka),$n(r,f),f}function dl(r,l,h){if(l&&!r.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=r.Aa&&!r.ma?new Z(new yr({ab:h})):new Z(r.ma),l.Fa(r.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function fl(){}n=fl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function be(r,l){de.call(this),this.g=new nl(l),this.l=r,this.h=l&&l.messageUrlParams||null,r=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(r?r["X-Client-Protocol"]="webchannel":r={"X-Client-Protocol":"webchannel"}),this.g.o=r,r=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(r?r["X-WebChannel-Content-Type"]=l.messageContentType:r={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(r?r["X-WebChannel-Client-Profile"]=l.sa:r={"X-WebChannel-Client-Profile":l.sa}),this.g.U=r,(r=l&&l.Qb)&&!g(r)&&(this.g.u=r),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!g(l)&&(this.g.G=l,r=this.h,r!==null&&l in r&&(r=this.h,l in r&&delete r[l])),this.j=new on(this)}_(be,de),be.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},be.prototype.close=function(){wr(this.g)},be.prototype.o=function(r){var l=this.g;if(typeof r=="string"){var h={};h.__data__=r,r=h}else this.v&&(h={},h.__data__=rr(r),r=h);l.i.push(new tf(l.Ya++,r)),l.I==3&&Wi(l)},be.prototype.N=function(){this.g.l=null,delete this.j,wr(this.g),delete this.g,be.Z.N.call(this)};function pl(r){or.call(this),r.__headers__&&(this.headers=r.__headers__,this.statusCode=r.__status__,delete r.__headers__,delete r.__status__);var l=r.__sm__;if(l){e:{for(const h in l){r=h;break e}r=void 0}(this.i=r)&&(r=this.i,l=l!==null&&r in l?l[r]:void 0),this.data=l}else this.data=r}_(pl,or);function gl(){ar.call(this),this.status=1}_(gl,ar);function on(r){this.g=r}_(on,fl),on.prototype.ra=function(){pe(this.g,"a")},on.prototype.qa=function(r){pe(this.g,new pl(r))},on.prototype.pa=function(r){pe(this.g,new gl)},on.prototype.oa=function(){pe(this.g,"b")},be.prototype.send=be.prototype.o,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,cr.NO_ERROR=0,cr.TIMEOUT=8,cr.HTTP_ERROR=6,Xd.COMPLETE="complete",Gd.EventType=Nn,Nn.OPEN="a",Nn.CLOSE="b",Nn.ERROR="c",Nn.MESSAGE="d",de.prototype.listen=de.prototype.J,Z.prototype.listenOnce=Z.prototype.K,Z.prototype.getLastError=Z.prototype.Ha,Z.prototype.getLastErrorCode=Z.prototype.ya,Z.prototype.getStatus=Z.prototype.ca,Z.prototype.getResponseJson=Z.prototype.La,Z.prototype.getResponseText=Z.prototype.la,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Fa}).apply(typeof Yi<"u"?Yi:typeof self<"u"?self:typeof window<"u"?window:{});const xc="@firebase/firestore",Fc="4.9.2";class _e{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_e.UNAUTHENTICATED=new _e(null),_e.GOOGLE_CREDENTIALS=new _e("google-credentials-uid"),_e.FIRST_PARTY=new _e("first-party-uid"),_e.MOCK_USER=new _e("mock-user");let Pi="12.3.0";const En=new yi("@firebase/firestore");function Fe(n,...e){if(En.logLevel<=W.DEBUG){const t=e.map(fa);En.debug(`Firestore (${Pi}): ${n}`,...t)}}function Rd(n,...e){if(En.logLevel<=W.ERROR){const t=e.map(fa);En.error(`Firestore (${Pi}): ${n}`,...t)}}function tE(n,...e){if(En.logLevel<=W.WARN){const t=e.map(fa);En.warn(`Firestore (${Pi}): ${n}`,...t)}}function fa(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function _i(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,kd(n,i,t)}function kd(n,e,t){let i=`FIRESTORE (${Pi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw Rd(i),new Error(i)}function ni(n,e,t,i){let s="Unexpected state";typeof t=="string"?s=t:i=t,n||kd(e,s,i)}const V={CANCELLED:"cancelled",INVALID_ARGUMENT:"invalid-argument",FAILED_PRECONDITION:"failed-precondition"};class B extends Pe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ii{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Nd{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(_e.UNAUTHENTICATED)))}shutdown(){}}class iE{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class sE{constructor(e){this.t=e,this.currentUser=_e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ni(this.o===void 0,42304);let i=this.i;const s=u=>this.i!==i?(i=this.i,t(u)):Promise.resolve();let o=new ii;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ii,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=o;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},c=u=>{Fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>c(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(Fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ii)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(Fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ni(typeof i.accessToken=="string",31837,{l:i}),new Nd(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ni(e===null||typeof e=="string",2055,{h:e}),new _e(e)}}class rE{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=_e.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class oE{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new rE(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(_e.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Uc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class aE{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ce(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ni(this.o===void 0,3512);const i=o=>{o.error!=null&&Fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,Fe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>i(o)))};const s=o=>{Fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):Fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Uc(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ni(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Uc(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function lE(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}class cE{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const s=lE(40);for(let o=0;o<s.length;++o)i.length<20&&s[o]<t&&(i+=e.charAt(s[o]%62))}return i}}function Rt(n,e){return n<e?-1:n>e?1:0}function hE(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const s=n.charAt(i),o=e.charAt(i);if(s!==o)return Vr(s)===Vr(o)?Rt(s,o):Vr(s)?1:-1}return Rt(n.length,e.length)}const uE=55296,dE=57343;function Vr(n){const e=n.charCodeAt(0);return e>=uE&&e<=dE}const Vc="__name__";class je{constructor(e,t,i){t===void 0?t=0:t>e.length&&_i(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&_i(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return je.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof je?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const o=je.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return Rt(e.length,t.length)}static compareSegments(e,t){const i=je.isNumericId(e),s=je.isNumericId(t);return i&&!s?-1:!i&&s?1:i&&s?je.extractNumericId(e).compare(je.extractNumericId(t)):hE(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return da.fromString(e.substring(4,e.length-2))}}class Oe extends je{construct(e,t,i){return new Oe(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new B(V.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((s=>s.length>0)))}return new Oe(t)}static emptyPath(){return new Oe([])}}const fE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ut extends je{construct(e,t,i){return new Ut(e,t,i)}static isValidIdentifier(e){return fE.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ut.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Vc}static keyField(){return new Ut([Vc])}static fromServerFormat(e){const t=[];let i="",s=0;const o=()=>{if(i.length===0)throw new B(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new B(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new B(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(i+=c,s++):(o(),s++)}if(o(),a)throw new B(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ut(t)}static emptyPath(){return new Ut([])}}class jt{constructor(e){this.path=e}static fromPath(e){return new jt(Oe.fromString(e))}static fromName(e){return new jt(Oe.fromString(e).popFirst(5))}static empty(){return new jt(Oe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Oe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Oe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new jt(new Oe(e.slice()))}}function pE(n,e,t,i){if(e===!0&&i===!0)throw new B(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gE(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function _E(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":_i(12329,{type:typeof n})}function mE(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_E(n);throw new B(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function te(n,e){const t={typeString:n};return e&&(t.value=e),t}function Oi(n,e){if(!gE(n))throw new B(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const s=e[i].typeString,o="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const a=n[i];if(s&&typeof a!==s){t=`JSON field '${i}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${i}' field to equal '${o.value}'`;break}}if(t)throw new B(V.INVALID_ARGUMENT,t);return!0}const Bc=-62135596800,jc=1e6;class We{static now(){return We.fromMillis(Date.now())}static fromDate(e){return We.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*jc);return new We(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Bc)throw new B(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/jc}_compareTo(e){return this.seconds===e.seconds?Rt(this.nanoseconds,e.nanoseconds):Rt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:We._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Oi(e,We._jsonSchema))return new We(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Bc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}We._jsonSchemaVersion="firestore/timestamp/1.0",We._jsonSchema={type:te("string",We._jsonSchemaVersion),seconds:te("number"),nanoseconds:te("number")};function yE(n){return n.name==="IndexedDbTransactionError"}class vE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Xt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new vE("Invalid base64 string: "+o):o}})(e);return new Xt(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Xt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Rt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xt.EMPTY_BYTE_STRING=new Xt("");const co="(default)";class Ns{constructor(e,t){this.projectId=e,this.database=t||co}static empty(){return new Ns("","")}get isDefaultDatabase(){return this.database===co}isEqual(e){return e instanceof Ns&&e.projectId===this.projectId&&e.database===this.database}}class wE{constructor(e,t=null,i=[],s=[],o=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=o,this.limitType=a,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function IE(n){return new wE(n)}var Wc,U;(U=Wc||(Wc={}))[U.OK=0]="OK",U[U.CANCELLED=1]="CANCELLED",U[U.UNKNOWN=2]="UNKNOWN",U[U.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",U[U.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",U[U.NOT_FOUND=5]="NOT_FOUND",U[U.ALREADY_EXISTS=6]="ALREADY_EXISTS",U[U.PERMISSION_DENIED=7]="PERMISSION_DENIED",U[U.UNAUTHENTICATED=16]="UNAUTHENTICATED",U[U.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",U[U.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",U[U.ABORTED=10]="ABORTED",U[U.OUT_OF_RANGE=11]="OUT_OF_RANGE",U[U.UNIMPLEMENTED=12]="UNIMPLEMENTED",U[U.INTERNAL=13]="INTERNAL",U[U.UNAVAILABLE=14]="UNAVAILABLE",U[U.DATA_LOSS=15]="DATA_LOSS";new da([4294967295,4294967295],0);const EE=41943040;const TE=1048576;function Br(){return typeof document<"u"?document:null}class CE{constructor(e,t,i=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=i,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-i);s>0&&Fe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}class pa{constructor(e,t,i,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=o,this.deferred=new ii,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,s,o){const a=Date.now()+i,c=new pa(e,t,a,s,o);return c.start(i),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}var Hc,$c;($c=Hc||(Hc={})).Ma="default",$c.Cache="cache";function SE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const qc=new Map;const Pd="firestore.googleapis.com",Gc=!0;class zc{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Pd,this.ssl=Gc}else this.host=e.host,this.ssl=e.ssl??Gc;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=EE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<TE)throw new B(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}pE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=SE(e.experimentalLongPollingOptions??{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new B(V.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new B(V.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new B(V.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,s){return i.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Od{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new nE;switch(i.type){case"firstParty":return new oE(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new B(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=qc.get(t);i&&(Fe("ComponentProvider","Removing Datastore"),qc.delete(t),i.terminate())})(this),Promise.resolve()}}function AE(n,e,t,i={}){n=mE(n,Od);const s=kt(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;s&&(Ps(`https://${c}`),Os("Firestore",!0)),o.host!==Pd&&o.host!==c&&tE("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...o,host:c,ssl:s,emulatorOptions:i};if(!et(u,a)&&(n._setSettings(u),i.mockUserToken)){let d,m;if(typeof i.mockUserToken=="string")d=i.mockUserToken,m=_e.MOCK_USER;else{d=po(i.mockUserToken,n._app?.options.projectId);const _=i.mockUserToken.sub||i.mockUserToken.user_id;if(!_)throw new B(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new _e(_)}n._authCredentials=new iE(new Nd(d,m))}}class ga{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new ga(this.firestore,e,this._query)}}class He{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _a(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new He(this.firestore,e,this._key)}toJSON(){return{type:He._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(Oi(t,He._jsonSchema))return new He(e,i||null,new jt(Oe.fromString(t.referencePath)))}}He._jsonSchemaVersion="firestore/documentReference/1.0",He._jsonSchema={type:te("string",He._jsonSchemaVersion),referencePath:te("string")};class _a extends ga{constructor(e,t,i){super(e,t,IE(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new He(this.firestore,null,new jt(e))}withConverter(e){return new _a(this.firestore,e,this._path)}}const Kc="AsyncQueue";class Yc{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new CE(this,"async_queue_retry"),this._c=()=>{const i=Br();i&&Fe(Kc,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=Br();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Br();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new ii;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!yE(e))throw e;Fe(Kc,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((i=>{throw this.nc=i,this.rc=!1,Rd("INTERNAL UNHANDLED ERROR: ",Jc(i)),i})).then((i=>(this.rc=!1,i))))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=pa.createAndSchedule(this,e,t,i,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&_i(47125,{Pc:Jc(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Jc(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class bE extends Od{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=new Yc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Yc(e),this._firestoreClient=void 0,await e}}}function QE(n,e){const t=typeof n=="object"?n:vi(),i=typeof n=="string"?n:co,s=rt(t,"firestore").getImmediate({identifier:i});if(!s._initialized){const o=fo("firestore");o&&AE(s,...o)}return s}class Ye{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ye(Xt.fromBase64String(e))}catch(t){throw new B(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ye(Xt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ye._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Oi(e,Ye._jsonSchema))return Ye.fromBase64String(e.bytes)}}Ye._jsonSchemaVersion="firestore/bytes/1.0",Ye._jsonSchema={type:te("string",Ye._jsonSchemaVersion),bytes:te("string")};class Dd{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ut(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ht{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Rt(this._lat,e._lat)||Rt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ht._jsonSchemaVersion}}static fromJSON(e){if(Oi(e,Ht._jsonSchema))return new Ht(e.latitude,e.longitude)}}Ht._jsonSchemaVersion="firestore/geoPoint/1.0",Ht._jsonSchema={type:te("string",Ht._jsonSchemaVersion),latitude:te("number"),longitude:te("number")};class $t{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,s){if(i.length!==s.length)return!1;for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:$t._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Oi(e,$t._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new $t(e.vectorValues);throw new B(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$t._jsonSchemaVersion="firestore/vectorValue/1.0",$t._jsonSchema={type:te("string",$t._jsonSchemaVersion),vectorValues:te("object")};const RE=new RegExp("[~\\*/\\[\\]]");function kE(n,e,t){if(e.search(RE)>=0)throw Xc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n);try{return new Dd(...e.split("."))._internalPath}catch{throw Xc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n)}}function Xc(n,e,t,i,s){let o=`Function ${e}() called with invalid data`;o+=". ";let a="";return new B(V.INVALID_ARGUMENT,o+n+a)}class Md{constructor(e,t,i,s,o){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new He(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new NE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ld("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class NE extends Md{data(){return super.data()}}function Ld(n,e){return typeof e=="string"?kE(n,e):e instanceof Dd?e._internalPath:e._delegate._internalPath}class Ji{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class gn extends Md{constructor(e,t,i,s,o,a){super(e,t,i,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ns(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Ld("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=gn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}gn._jsonSchemaVersion="firestore/documentSnapshot/1.0",gn._jsonSchema={type:te("string",gn._jsonSchemaVersion),bundleSource:te("string","DocumentSnapshot"),bundleName:te("string"),bundle:te("string")};class ns extends gn{data(e={}){return super.data(e)}}class si{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ji(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new ns(this._firestore,this._userDataWriter,i.key,i,new Ji(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const u=new ns(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Ji(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>o||c.type!==3)).map((c=>{const u=new ns(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Ji(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,m=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),m=a.indexOf(c.doc.key)),{type:PE(c.type),doc:u,oldIndex:d,newIndex:m}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=si._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=cE.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),i.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function PE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _i(61501,{type:n})}}si._jsonSchemaVersion="firestore/querySnapshot/1.0",si._jsonSchema={type:te("string",si._jsonSchemaVersion),bundleSource:te("string","QuerySnapshot"),bundleName:te("string"),bundle:te("string")};(function(e,t=!0){(function(s){Pi=s})(Nt),ke(new Ae("firestore",((i,{instanceIdentifier:s,options:o})=>{const a=i.getProvider("app").getImmediate(),c=new bE(new sE(i.getProvider("auth-internal")),new aE(a,i.getProvider("app-check-internal")),(function(d,m){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new B(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ns(d.options.projectId,m)})(a,s),a);return o={useFetchStreams:t,...o},c._setSettings(o),c}),"PUBLIC").setMultipleInstances(!0)),fe(xc,Fc,e),fe(xc,Fc,"esm2020")})();export{KE as a,JE as b,XE as c,QE as d,BE as e,YE as f,xE as g,WE as h,Dp as i,HE as j,qE as k,GE as l,$E as m,jE as n,LE as o,UE as p,zE as q,FE as r,DE as s,qv as t,ME as u,VE as v};
